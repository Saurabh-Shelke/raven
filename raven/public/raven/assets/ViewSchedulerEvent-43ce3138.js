var $=Object.defineProperty,D=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var h=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var a=(e,r,o)=>r in e?$(e,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[r]=o,d=(e,r)=>{for(var o in r||(r={}))C.call(r,o)&&a(e,o,r[o]);if(h)for(var o of h(r))k.call(r,o)&&a(e,o,r[o]);return e},p=(e,r)=>D(e,q(r));import{bg as w,bh as P,j as s,E as f,F,r as x,u as R,ad as L,ae as B,at as I,ag as N,ah as V,q as O,b6 as H,aj as K,ak as v,cI as T,o as A,e as M,$ as b}from"./index-81db420b.js";import{D as Q}from"./DeleteAlert-72df79c6.js";import{S as z}from"./SchedulerEventsForm-7ae48337.js";import{P as G,S as J,a as U}from"./SettingsContentContainer-c8f50a15.js";import{a as W}from"./validations-18aa1769.js";import"./WebhookForm-4cfc7c6d.js";import"./ServerScriptNotEnabledForm-c4f27eef.js";const X=()=>{const{ID:e}=w(),{data:r,error:o,mutate:i,isLoading:c}=P("Raven Scheduler Event",e);return s.jsxs(G,{children:[o&&s.jsx(f,{error:o}),c&&s.jsx(F,{className:"h-64"}),r&&s.jsx(Y,{data:r,onUpdate:i})]})},Y=({data:e,onUpdate:r})=>{const[o,i]=x.useState(!1),c=R({defaultValues:{name:e.name,send_to:e.send_to,event_frequency:e.event_frequency,channel:e.channel,dm:e.dm,bot:e.bot,content:e.content,hour:e.cron_expression?e.cron_expression.split(" ")[1]:"",minute:e.cron_expression?e.cron_expression.split(" ")[0]:"",date:e.cron_expression?e.cron_expression.split(" ")[2]:"",month:e.cron_expression?e.cron_expression.split(" ")[3]:"",day:e.cron_expression?e.cron_expression.split(" ")[4]:""}}),{formState:{dirtyFields:y}}=c,j=!W(y),{updateDoc:u,error:S,loading:l}=L(),m=n=>{let t="";n.event_frequency==="Every Day"&&(t=`${n.minute} ${n.hour} * * *`),n.event_frequency==="Every Day of the week"&&(t=`${n.minute} ${n.hour} * * ${n.day}`),n.event_frequency==="Date of the month"&&(t=`${n.minute} ${n.hour} ${n.date} * *`),n.event_frequency==="Cron"&&(t=`${n.minute} ${n.hour} ${n.date} ${n.month} ${n.day}`),u("Raven Scheduler Event",n.name,{channel:n.channel,bot:n.bot,event_frequency:n.event_frequency,cron_expression:t,content:n.content}).then(()=>{r(),b.success("Scheduler Event updated")})},_=()=>{u("Raven Scheduler Event",e.name,{disabled:!e.disabled}).then(()=>{r(),b(`Scheduler Event ${e.name} ${e.disabled?"enabled":"disabled"}`)})},g=()=>{i(!1)};x.useEffect(()=>{const n=t=>{t.key==="s"&&(t.metaKey||t.ctrlKey)&&(t.preventDefault(),c.handleSubmit(m)())};return document.addEventListener("keydown",n),()=>document.removeEventListener("keydown",n)},[]);const E=e.disabled?[{label:"Disabled",color:"gray"}]:[{label:"Enabled",color:"green"}];return s.jsx(B,p(d({},c),{children:s.jsx("form",{onSubmit:c.handleSubmit(m),children:s.jsxs(J,{children:[s.jsx(U,{title:e.event_name,headerBadges:j?[{label:"Not Saved",color:"red"}]:E,actions:s.jsxs(I,{children:[s.jsxs(N,{children:[s.jsx(V,{children:s.jsx(O,{"aria-label":"Options",variant:"surface",color:"gray",children:s.jsx(H,{})})}),s.jsxs(K,{className:"min-w-32",children:[s.jsx(v,{onClick:_,children:e.disabled?"Enable":"Disable"}),s.jsx(T,{}),s.jsx(v,{color:"red",onClick:()=>i(!0),children:"Delete"})]})]}),s.jsxs(A,{type:"submit",disabled:l,children:[l&&s.jsx(M,{className:"text-white"}),l?"Saving":"Save"]})]}),breadcrumbs:[{label:"Scheduled Messages",href:"../"},{label:e.name,href:"",copyToClipboard:!0}]}),s.jsx(f,{error:S}),s.jsx(z,{edit:!0}),s.jsx(Q,{doctype:"Raven Scheduler Event",docname:e.name,isOpen:o,onClose:g,path:"../../scheduled-messages"})]})})}))},ie=X;export{ie as Component};
