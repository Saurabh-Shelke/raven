var pe=Object.defineProperty,me=Object.defineProperties;var fe=Object.getOwnPropertyDescriptors;var Y=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,ve=Object.prototype.propertyIsEnumerable;var Q=(a,r,t)=>r in a?pe(a,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[r]=t,p=(a,r)=>{for(var t in r||(r={}))ge.call(r,t)&&Q(a,t,r[t]);if(Y)for(var t of Y(r))ve.call(r,t)&&Q(a,t,r[t]);return a},g=(a,r)=>me(a,fe(r));import{aN as I,aO as _e,j as e,S as c,at as F,aw as ye,ax as be,az as Z,aA as w,ay as Se,aB as q,i as A,aC as R,bG as Ce,aW as G,a3 as De,q as ne,aR as Fe,o as E,r as le,a2 as H,a4 as U,a6 as W,K as ce,a7 as oe,aq as K,aQ as de,ar as X,bM as Te,u as ke,ae as we,p as m,L as v,b as D,d as j,aT as L,aI as $,aJ as M,aK as O,aL as n,bd as V,aP as z,aM as C,au as qe,bi as Le,bj as Ne,bk as ee,cJ as Ae,bN as Ve,bn as se,bT as B,aX as Ee,f as te,bC as ae,cL as Pe}from"./index-81db420b.js";import{u as $e}from"./useDoctypeMeta-749cfb81.js";import{a as Me}from"./DoctypeVariableDialogForm-2f0c0daa.js";import{C as Oe}from"./CodeBlock-5fc83e57.js";const Ie=a=>{const{control:r,watch:t}=I(),{fields:o,append:u,remove:d,update:x}=_e({control:r,name:"fields"}),l=s=>{u(s)},_=(s,y)=>{x(s,y)},b=t("action"),f=t("document_type");return e.jsxs(c,{children:[e.jsxs(F,{justify:"end",align:"center",children:[b==="Create Document"&&f&&e.jsx(ze,{append:l}),e.jsx(Be,{onAdd:l,doctype:f})]}),e.jsx(c,{children:e.jsxs(ye,{variant:"surface",className:"rounded-sm",children:[e.jsx(be,{children:e.jsxs(Z,{children:[e.jsx(w,{children:"Label"}),e.jsx(w,{children:"Fieldname"}),e.jsx(w,{children:"Required"}),e.jsx(w,{children:"Options"}),e.jsx(w,{children:"Default Value"}),e.jsx(w,{})]})}),e.jsx(Se,{children:o.map((s,y)=>e.jsxs(Z,{children:[e.jsxs(q,{children:[e.jsx(A,{as:"span",size:"2",weight:"medium",children:s.label})," ",e.jsx(R,{color:Re(s.type),className:"ml-2 rounded-md",children:s.type})]}),e.jsx(q,{children:e.jsx(Ce,{variant:"ghost",children:s.fieldname})}),e.jsx(q,{children:e.jsx(G,{checked:!!s.is_required})}),e.jsx(q,{children:s.options?s.type==="Select"?e.jsx(De,{content:s.options.split(`
`).join(", "),children:e.jsxs(R,{color:"blue",className:"rounded-md",children:[s.options.split(`
`).length," Options"]})}):e.jsx(R,{color:"iris",variant:"soft",className:"rounded-md",children:s.options}):null}),e.jsx(q,{children:s.default_value}),e.jsx(q,{children:e.jsxs(F,{align:"center",pr:"2",gap:"4",children:[e.jsx(Je,{onEdit:T=>_(y,T),field:s,doctype:f}),e.jsx(ne,{size:"2",color:"red",variant:"ghost",type:"button",onClick:()=>d(y),children:e.jsx(Fe,{size:"16"})})]})})]},s.id))})]})})]})},Re=a=>{switch(a){case"Select":return"blue";case"Number":return"purple";case"Date":return"violet";case"Datetime":return"violet";case"Time":return"violet";case"Data":return"green";case"Checkbox":return"pink";case"Small Text":return"orange";case"Link":return"sky";default:return"gray"}},ue=a=>{switch(a){case"Select":return"Select";case"Autocomplete":return"Link";case"Link":return"Link";case"Int":return"Number";case"Currency":return"Number";case"Float":return"Number";case"Date":return"Date";case"Datetime":return"Datetime";case"Time":return"Time";case"Data":return"Data";case"Small Text":return"Small Text";case"Long Text":return"Small Text";case"Check":return"Checkbox";default:return"Small Text"}},he=a=>a?a==="Email"?"email":a==="Phone"?"tel":a==="URL"?"url":"":"",ze=({append:a})=>{const{watch:r,getValues:t}=I(),o=r("document_type"),{doc:u,childDocs:d}=$e(o!=null?o:""),x=()=>{var f;const l=(t("fields")||[]).map(s=>s.fieldname),_=(f=u==null?void 0:u.fields)==null?void 0:f.filter(s=>s.reqd&&s.fieldtype!=="Table"&&s.fieldtype!=="Table MultiSelect"),b=_==null?void 0:_.filter(s=>{var y;return!l.includes((y=s.fieldname)!=null?y:"")});b==null||b.forEach(s=>{a({fieldname:s.fieldname,label:s.label,helper_text:s.description,type:ue(s.fieldtype),is_required:s.reqd,options:s.fieldtype==="Data"?he(s.options):s.options,default_value_type:"Static",default_value:s.default})})};return e.jsxs(E,{variant:"outline",type:"button",className:"not-cal",onClick:x,children:["Import fields from ",o]})},Be=({onAdd:a,doctype:r})=>{const[t,o]=le.useState(!1),u=d=>{a(d),o(!1)};return e.jsxs(H,{open:t,onOpenChange:o,children:[e.jsx(U,{children:e.jsx(E,{type:"button",className:"not-cal",children:"Add"})}),e.jsxs(W,{className:ce(oe,"static"),children:[e.jsx(K,{children:"Add Field"}),e.jsx(de,{children:e.jsx(X,{children:"Add a new field for this action."})}),e.jsx(xe,{doctype:r,onAdd:u})]})]})},Je=({onEdit:a,field:r,doctype:t})=>{const[o,u]=le.useState(!1),d=x=>{a(x),u(!1)};return e.jsxs(H,{open:o,onOpenChange:u,children:[e.jsx(U,{children:e.jsx(ne,{size:"2",color:"gray",variant:"ghost",type:"button",children:e.jsx(Te,{size:"16",className:"text-gray-10"})})}),e.jsxs(W,{className:ce(oe,"static"),children:[e.jsx(K,{children:"Edit Field"}),e.jsx(de,{children:e.jsxs(X,{children:["Edit field - ",r.fieldname," for this action."]})}),e.jsx(xe,{doctype:t,field:r,onAdd:d})]})]})},xe=({doctype:a,field:r,onAdd:t})=>{var N,h,k;const o=ke({defaultValues:r}),{register:u,watch:d,setValue:x,formState:{errors:l},control:_}=o,b=d("fieldname"),f=d("type"),s=d("default_value_type"),y=i=>{t(i)},T=i=>{var S;x("fieldname",(S=i.fieldname)!=null?S:""),i.label&&x("label",i.label),i.description&&x("helper_text",i.description),i.fieldtype&&x("type",ue(i.fieldtype)),i.options&&(i.fieldtype==="Data"?x("options",he(i.options)):(i.fieldtype==="Autocomplete"||i.fieldtype==="Link"||i.fieldtype==="Select")&&x("options",i.options))},P=i=>{i==="Link"&&x("options","")};return e.jsx(we,g(p({},o),{children:e.jsxs(c,{gap:"4",children:[e.jsxs(c,{gap:"4",children:[e.jsxs(F,{children:[a?e.jsx(Me,{doctype:a,value:b,onFieldSelect:T}):e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsx(v,{isRequired:!0,htmlFor:"fieldname",children:"Field Name"}),e.jsx(D,g(p({},u("fieldname",{required:"Field is required"})),{id:"fieldname"}))]}),l.fieldname&&e.jsx(j,{children:l.fieldname.message})]}),e.jsxs(c,{width:"50%",children:[e.jsxs(m,{children:[e.jsx(v,{isRequired:!0,htmlFor:"label",children:"Label"}),e.jsx(D,g(p({},u("label",{required:"Label is required"})),{id:"label"}))]}),l.label&&e.jsx(j,{children:l.label.message})]})]}),e.jsxs(F,{children:[e.jsxs(c,{width:"50%",children:[e.jsxs(m,{children:[e.jsx(v,{isRequired:!0,children:"Type"}),e.jsx(L,{control:_,name:"type",rules:{required:"Type is required",onChange:P},render:({field:{value:i,onChange:S}})=>e.jsxs($,{required:!0,value:i,onValueChange:je=>S(je),children:[e.jsx(M,{placeholder:"Select a type",className:"w-full"}),e.jsxs(O,{children:[e.jsx(n,{value:"Data",children:"Data"}),e.jsx(n,{value:"Number",children:"Number"}),e.jsx(n,{value:"Select",children:"Select"}),e.jsx(n,{value:"Link",children:"Link"}),e.jsx(n,{value:"Checkbox",children:"Checkbox"}),e.jsx(n,{value:"Date",children:"Date"}),e.jsx(n,{value:"Time",children:"Time"}),e.jsx(n,{value:"Datetime",children:"Datetime"}),e.jsx(n,{value:"Small Text",children:"Small Text"})]})]})})]}),l.type&&e.jsx(j,{children:(N=l.type)==null?void 0:N.message})]}),f==="Data"&&e.jsxs(c,{width:"50%",children:[e.jsxs(m,{children:[e.jsxs(v,{htmlFor:"options",children:["Validation ",e.jsx(A,{as:"span",weight:"regular",size:"2",color:"gray",children:" (optional)"})]}),e.jsx(D,g(p({},u("options",{required:!1,pattern:{value:/^("email"|"tel"|"url")$/,message:"Invalid validation"}})),{id:"options",placeholder:'"email", "tel", or "url"'}))]}),l.options&&e.jsx(j,{children:l.options.message})]})]}),e.jsx(m,{children:e.jsx(L,{control:_,name:"is_required",render:({field:i})=>e.jsx(A,{as:"label",size:"2",children:e.jsxs(F,{children:[e.jsx(G,{checked:!!i.value,onCheckedChange:S=>i.onChange(S?1:0)}),"Required"]})})})}),f==="Select"&&e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsx(v,{children:"Options"}),e.jsx(V,g(p({},u("options",{required:f==="Select"?"Options are required":!1})),{placeholder:"Add options in new lines",rows:8}))]}),l.options&&e.jsx(j,{children:(h=l.options)==null?void 0:h.message})]}),f==="Link"&&e.jsxs(c,{children:[e.jsx(z,{name:"options",doctype:"DocType",label:"Document Type",filters:[["istable","=",0],["issingle","=",0]],required:!0,rules:{required:f==="Link"?"Document Type is required":!1}}),l.options&&e.jsx(j,{children:(k=l.options)==null?void 0:k.message})]}),e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsx(v,{htmlFor:"default_value_type",children:"Default Value Type"}),e.jsx(L,{control:_,name:"default_value_type",render:({field:{value:i,onChange:S}})=>e.jsxs($,{value:i,onValueChange:S,children:[e.jsx(M,{placeholder:"Select a default value type",className:"w-full",id:"default_value_type"}),e.jsxs(O,{children:[e.jsx(n,{value:"Static",children:"Static"}),e.jsx(n,{value:"Message Field",children:"Message Field"}),e.jsx(n,{value:"Jinja",children:"Jinja"})]})]})})]}),e.jsxs(C,{children:["You can choose between a static default value, message field or jinja template.",e.jsx("br",{}),"Message field will allow you to set a default value from the message selected.",e.jsx("br",{}),"Jinja tags can be used with the message as context."]}),l.default_value_type&&e.jsx(j,{children:l.default_value_type.message})]}),e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsx(v,{htmlFor:"default_value",children:"Default Value"}),s==="Static"&&e.jsx(D,g(p({},u("default_value")),{id:"default_value"})),s==="Message Field"&&e.jsx(L,{control:_,name:"default_value",render:({field:{value:i,onChange:S}})=>e.jsxs($,{value:i,onValueChange:S,children:[e.jsx(M,{placeholder:"Select a message field",className:"w-full",id:"default_value"}),e.jsxs(O,{children:[e.jsx(n,{value:"text",children:"Text (with HTML tags)"}),e.jsx(n,{value:"file",children:"File"}),e.jsx(n,{value:"content",children:"Content (Text content without HTML tags)"}),e.jsx(n,{value:"owner",children:"Owner (User)"}),e.jsx(n,{value:"creation",children:"Creation (Datetime)"}),e.jsx(n,{value:"message_type",children:"Message Type"}),e.jsx(n,{value:"link_doctype",children:"Linked DocType"}),e.jsx(n,{value:"link_document",children:"Linked Document"}),e.jsx(n,{value:"channel_id",children:"Channel ID"}),e.jsx(n,{value:"workspace_id",children:"Workspace ID"}),e.jsx(n,{value:"message_url",children:"Message URL"})]})]})}),s==="Jinja"&&e.jsx(V,g(p({},u("default_value")),{placeholder:"This is the message: {{ message.content }}",id:"default_value",rows:8}))]}),l.default_value&&e.jsx(j,{children:l.default_value.message})]}),e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsxs(v,{htmlFor:"helper_text",children:["Description ",e.jsx(A,{as:"span",weight:"regular",size:"2",color:"gray",children:" (optional)"})]}),e.jsx(D,g(p({},u("helper_text")),{id:"helper_text"}))]}),l.helper_text&&e.jsx(j,{children:l.helper_text.message})]})]}),e.jsxs(F,{justify:"end",children:[e.jsx(qe,{children:e.jsx(E,{variant:"soft",color:"gray",children:"Close"})}),e.jsx(E,{type:"button",onClick:o.handleSubmit(y),children:"Add"})]})]})}))},re={size:18,className:"mr-1.5"},Ye=()=>e.jsxs(Le,{defaultValue:"general",children:[e.jsxs(Ne,{children:[e.jsxs(ee,{value:"general",children:[e.jsx(Ae,p({},re))," General"]}),e.jsxs(ee,{value:"fields",children:[e.jsx(Ve,p({},re))," Fields"]})]}),e.jsxs(m,{pt:"4",children:[e.jsx(se,{value:"general",children:e.jsx(Ge,{})}),e.jsx(se,{value:"fields",children:e.jsx(Ie,{})})]})]}),Ge=()=>{var _,b,f,s,y,T,P,N;const{register:a,control:r,formState:{errors:t},setValue:o,watch:u}=I(),d=B({control:r,name:"action"}),x=B({control:r,name:"server_script"}),l=h=>{h.target.value!=="Custom Function"&&o("custom_function_path",""),h.target.value!=="Create Document"&&o("document_type",""),h.target.value!=="Server Script"&&o("server_script","")};return e.jsxs(c,{gap:"4",children:[e.jsxs(Ee,{columns:"2",gap:"4",align:"center",children:[e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsx(v,{htmlFor:"action_name",isRequired:!0,children:"Name"}),e.jsx(D,g(p({id:"action_name"},a("action_name",{required:"Name is required",onBlur:h=>{o("title",h.target.value.trim())}})),{placeholder:"Create support ticket","aria-invalid":t.action_name?"true":"false"}))]}),t.action_name&&e.jsx(j,{children:(_=t.action_name)==null?void 0:_.message})]}),e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsx(v,{htmlFor:"action",isRequired:!0,children:"Action Type"}),e.jsx(L,{control:r,name:"action",rules:{required:"Action Type is required",onChange:l},render:({field:h})=>e.jsxs($,{value:h.value,name:h.name,onValueChange:k=>h.onChange(k),children:[e.jsx(M,{placeholder:"Pick an action type",className:"w-full",autoFocus:!0}),e.jsxs(O,{children:[e.jsx(n,{value:"Create Document",children:"Create Document"}),e.jsx(n,{value:"Custom Function",children:"Custom Function (API)"}),e.jsx(n,{value:"Server Script",children:"Server Script"})]})]})})]}),t.action&&e.jsx(j,{children:(b=t.action)==null?void 0:b.message})]}),d==="Create Document"&&e.jsxs(c,{children:[e.jsx(z,{name:"document_type",label:"Document Type",required:!0,filters:[["istable","=",0],["issingle","=",0]],doctype:"DocType",rules:{required:d==="Create Document"?"Document Type is required":!1}}),e.jsx(C,{children:"The document you want this action to create."}),t.document_type&&e.jsx(j,{children:(f=t.document_type)==null?void 0:f.message})]}),d==="Custom Function"&&e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsx(v,{htmlFor:"custom_function_path",isRequired:d==="Custom Function",children:"Custom Function Path"}),e.jsx(V,g(p({id:"custom_function_path"},a("custom_function_path",{required:d==="Custom Function"?"Path is required":!1,validate:h=>h!=null&&h.includes(" ")?"Path cannot contain spaces":!0})),{placeholder:"myapp.api.my_custom_function"}))]}),e.jsx(C,{children:"Dotted path to the custom function/API. Cannot contain spaces."}),t.custom_function_path&&e.jsx(j,{children:(s=t.custom_function_path)==null?void 0:s.message}),J[d]?e.jsx("div",{children:e.jsx(ie,{})}):null]}),d==="Server Script"&&e.jsxs(c,{children:[e.jsx(z,{name:"server_script",label:"Server Script",required:!0,filters:[["disabled","=",0],["script_type","=","API"]],doctype:"Server Script",rules:{required:d==="Server Script"?"Server Script is required":!1}}),e.jsxs(C,{className:"leading-6",children:['The Server Script you want this action to run. Server Scripts need to be of type "API".',e.jsx("br",{}),x?e.jsxs(te,{href:`/app/server-script/${x}`,target:"_blank",children:["Configure ",x," ",e.jsx(ae,{})]}):e.jsxs(te,{href:"/app/server-script/list",target:"_blank",children:["View Server Scripts ",e.jsx(ae,{})]})]}),t.server_script&&e.jsx(j,{children:(y=t.server_script)==null?void 0:y.message}),J[d]?e.jsx("div",{children:e.jsx(ie,{})}):null]})]}),e.jsx(c,{children:e.jsx(A,{as:"label",size:"2",children:e.jsxs(F,{children:[e.jsx(L,{control:r,name:"enabled",render:({field:h})=>e.jsx(G,{checked:!!h.value,onCheckedChange:k=>h.onChange(k?1:0)})}),"Enabled"]})})}),e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsx(v,{htmlFor:"title",isRequired:!0,children:"Title"}),e.jsx(D,g(p({id:"title"},a("title",{required:"Title is required"})),{placeholder:"Create support ticket","aria-invalid":t.title?"true":"false"}))]}),e.jsx(C,{children:"Title of the message action dialog."}),t.title&&e.jsx(j,{children:(T=t.title)==null?void 0:T.message})]}),e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsx(v,{htmlFor:"description",children:"Description"}),e.jsx(V,g(p({},a("description")),{id:"description",placeholder:"Create a support ticket from the message."}))]}),t.description&&e.jsx(j,{children:(P=t.description)==null?void 0:P.message}),e.jsx(C,{children:"This is shown on the message action dialog."})]}),e.jsxs(c,{children:[e.jsxs(m,{children:[e.jsx(v,{htmlFor:"success_message",children:"Success Message"}),e.jsx(V,g(p({},a("success_message")),{id:"success_message",placeholder:"Ticket created successfully."}))]}),t.success_message&&e.jsx(j,{children:(N=t.success_message)==null?void 0:N.message}),e.jsx(C,{children:"The message shown in the toast after performing the action."})]})]})},ie=()=>{const{control:a}=I(),r=B({control:a,name:"action"});return e.jsxs(H,{children:[e.jsx(U,{children:e.jsxs(E,{className:"not-cal",variant:"outline",children:[e.jsx(Pe,{})," View Docs"]})}),e.jsxs(W,{children:[e.jsx(K,{children:"Documentation"}),e.jsxs(X,{size:"2",children:["The following code sample shows how to use the message action values in a ",r,"."]}),e.jsx("div",{children:e.jsx(Oe,{code:J[r]})})]})]})},J={"Server Script":`# Server Scripts would get the values in "frappe.form_dict"
{
    "message_id": "123",
    "action_id": "abc",
    "values": {  
    # Values from the fields in the message action dialog
        "field1": "value1",
        "field2": "value2"
    }
}

# You can use the values to perform any action like this:
print(frappe.form_dict.values.field1)`,"Create Document":"","Custom Function":` # The API would be called directly with the values from the message action dialog.

# Example:
@frappe.whitelist()
def create_ticket(field1, field2):
    # Do something with the values
    frappe.get_doc({
        "doctype": "Ticket",
        "field1": field1,
        "field2": field2
    }).insert()
`};export{Ye as M};
