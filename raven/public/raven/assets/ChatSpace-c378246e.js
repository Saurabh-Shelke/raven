var ln=Object.defineProperty,tn=Object.defineProperties;var an=Object.getOwnPropertyDescriptors;var Ie=Object.getOwnPropertySymbols;var ts=Object.prototype.hasOwnProperty,as=Object.prototype.propertyIsEnumerable;var ls=(s,n,i)=>n in s?ln(s,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[n]=i,z=(s,n)=>{for(var i in n||(n={}))ts.call(n,i)&&ls(s,i,n[i]);if(Ie)for(var i of Ie(n))as.call(n,i)&&ls(s,i,n[i]);return s},G=(s,n)=>tn(s,an(n));var Ke=(s,n)=>{var i={};for(var r in s)ts.call(s,r)&&n.indexOf(r)<0&&(i[r]=s[r]);if(s!=null&&Ie)for(var r of Ie(s))n.indexOf(r)<0&&as.call(s,r)&&(i[r]=s[r]);return i};var ne=(s,n,i)=>new Promise((r,t)=>{var c=a=>{try{o(i.next(a))}catch(x){t(x)}},d=a=>{try{o(i.throw(a))}catch(x){t(x)}},o=a=>a.done?r(a.value):Promise.resolve(a.value).then(c,d);o((i=i.apply(s,n)).next())});import{j as e,a as l,S as ks,i as h,ad as Te,o as y,e as I,$ as U,aD as Ss,r as u,aZ as Ce,dm as Fs,bg as xe,p as k,dT as cn,L as ze,at as on,aW as ye,K as Xe,q as Le,dr as dn,u as Ms,M as A,ae as zs,aq as J,E as B,aT as Os,b as qe,m as de,b7 as Q,d as Me,au as Qe,a2 as H,a4 as Be,c0 as cs,a6 as Y,a7 as V,dw as E,dx as ue,dy as q,aG as hn,cF as De,W as _e,a_ as Ge,aI as ie,aJ as re,aK as le,bO as K,bP as X,aL as N,du as ve,aX as es,a0 as he,en as As,b0 as Ls,dt as xn,f as Ps,dn as un,b$ as Ts,b9 as We,b8 as ae,bi as Bs,bj as Rs,bk as Oe,bn as Ae,c as ss,ac as $s,V as Pe,Y as Je,Z as He,a8 as Ye,a9 as ns,ab as Ze,dW as jn,bL as mn,U as je,cT as is,J as oe,cq as gn,co as Is,bq as Us,ag as Vs,ah as Es,cg as pn,aj as qs,ak as ce,cp as vn,eo as os,ep as ds,eq as Ue,e9 as Ve,er as Ee,cv as fn,cy as yn,aV as bn,cw as Cn,br as hs,es as _n,G as Gs,bd as xs,aP as wn,b6 as Nn,et as kn,bI as Sn,cI as Fn,eu as Mn,cU as zn,dj as On,g as Ws,Q as Js,x as Hs,dA as An,el as Ln,aC as Se,eh as Pn,F as Tn,R as Bn}from"./index-81db420b.js";import{u as Rn,a as $n,b as In,F as Un,C as Vn,T as En,c as qn,J as Gn}from"./TypingIndicator-a31fce65.js";import{R as Wn,u as Ys,g as Jn}from"./useCurrentChannelData-5d20df6c.js";import{u as Re,A as us,a as Zs,b as Hn,c as Yn}from"./EmptyState-0a5144f8.js";import{P as Ks}from"./PageHeader-4d13375f.js";import{u as rs}from"./useDebounce-02f398f3.js";import{u as Xs}from"./useGetUserRecords-beb6efeb.js";import{M as Qs}from"./MessageBox-b7d061a6.js";import"./index-a9edd0f4.js";/* empty css                      */import"./DoctypeLinkRenderer-5c845fcf.js";import"./useDoctypeMeta-749cfb81.js";import"./preferences-0e1c8796.js";import"./DateSeparator-55fa17c4.js";import"./useRavenSettings-a6b6461e.js";const Zn=({channelID:s,isArchived:n,isMemberAdmin:i})=>n===1?e.jsx(Kn,{channelID:s,isMemberAdmin:i}):null,Kn=({channelID:s,isMemberAdmin:n})=>e.jsx(l,{direction:"column",align:"center",className:"border border-gray-6 rounded-md bg-surface animate-fadein sm:mb-0 mb-2",p:"4",children:e.jsxs(ks,{justify:"center",align:"center",children:[e.jsx(h,{as:"span",color:"gray",children:"This channel has been archived."}),n===1?e.jsx(Xn,{channelID:s}):null]})}),Xn=({channelID:s})=>{const{updateDoc:n,loading:i}=Te(),r=()=>ne(void 0,null,function*(){return n("Raven Channel",s,{is_archived:0}).then(()=>{U.success("Channel restored.")}).catch(t=>{U.error(t.message)})});return e.jsxs(y,{size:"2",disabled:i,color:"gray",variant:"soft",className:"not-cal",onClick:r,children:[i&&e.jsx(I,{}),"Restore Channel"]})},Ds=({channelData:s})=>{const{name:n}=Ss(),{channelMembers:i,isLoading:r}=Re(s.name),{onUserType:t,stopTyping:c}=Rn(s.name),[d,o]=u.useState(null),a=f=>{o(f)},x=()=>{o(null)},{mutate:p}=Ce(),j=u.useRef(null),_=f=>{p({path:`get_messages_for_channel_${s.name}`},F=>{var we,Ne;if(F&&(F!=null&&F.message.has_new_messages))return F;const se=(we=F==null?void 0:F.message.messages)!=null?we:[],pe=[...se];return f.forEach(ke=>{const $e=se.findIndex(rn=>rn.name===ke.name);$e!==-1?pe[$e]=G(z({},ke),{_liked_by:"",is_pinned:0,is_continuation:0}):pe.push(G(z({},ke),{_liked_by:"",is_pinned:0,is_continuation:0}))}),{message:{messages:pe.sort((ke,$e)=>new Date($e.creation).getTime()-new Date(ke.creation).getTime()),has_new_messages:!1,has_old_messages:(Ne=F==null?void 0:F.message.has_old_messages)!=null?Ne:!1}}},{revalidate:!1}).then(()=>{var F,se;(se=j.current)==null||se.scrollTo(0,(F=j.current)==null?void 0:F.scrollHeight)}),c(),x()},v=u.useMemo(()=>{var f;return n&&i&&(f=i[n])!=null?f:null},[n,i]),b=u.useRef(null),M=u.useCallback(()=>{var f;(f=b.current)==null||f.onUpArrow()},[]),C=u.useRef(null),S=Fs(),L=u.useCallback(()=>{S||setTimeout(()=>{var f;(f=C.current)==null||f.focusEditor()},50)},[S]),{fileInputRef:O,files:R,setFiles:T,removeFile:D,uploadFiles:w,addFile:ee,fileUploadProgress:me,compressImages:P,setCompressImages:ge}=$n(s.name),{sendMessage:m,loading:W}=In(s.name,w,_,d),Z=({selectedMessage:f})=>f?e.jsx(Wn,{justify:"between",align:"center",className:"m-2",message:f,children:e.jsx(Le,{color:"gray",size:"1",variant:"soft",onClick:x,children:e.jsx(dn,{size:"20"})})}):null,{canUserSendMessage:te,shouldShowJoinBox:g}=u.useMemo(()=>{if(s.is_archived)return{canUserSendMessage:!1,shouldShowJoinBox:!1};if(s.type==="Open")return{canUserSendMessage:!0,shouldShowJoinBox:!1};if(v)return{canUserSendMessage:!0,shouldShowJoinBox:!1};const f=(s==null?void 0:s.is_direct_message)===1||(s==null?void 0:s.is_self_message)===1;return!v&&!f&&s&&!r?{shouldShowJoinBox:!0,canUserSendMessage:!1}:{canUserSendMessage:!1,shouldShowJoinBox:!1}},[v,s,r]),{threadID:$}=xe();return e.jsx(Dn,{children:e.jsxs(Un,{files:R,ref:O,onFileChange:T,width:$?"w-[calc((100vw-var(--sidebar-width)-var(--space-8))/2)]":void 0,maxFiles:10,maxFileSize:1e7,children:[e.jsx(Vn,{channelID:s.name,scrollRef:j,ref:b,onModalClose:L,pinnedMessagesString:s.pinned_messages_string,replyToMessage:a}),te&&e.jsxs(ks,{children:[e.jsx(En,{channel:s.name}),e.jsx(qn,{channelID:s.name,fileProps:{fileInputRef:O,addFile:ee},ref:C,onUpArrow:M,clearReplyMessage:x,channelMembers:i,onUserType:t,replyMessage:d,sessionStorageKey:`tiptap-${s.name}`,onMessageSend:m,messageSending:W,slotBefore:e.jsxs(l,{direction:"column",justify:"center",hidden:!d&&!R.length,children:[d&&e.jsx(Z,{selectedMessage:d}),R&&R.length>0&&e.jsx(l,{gap:"2",width:"100%",align:"stretch",px:"2",p:"2",wrap:"wrap",children:R.map(f=>e.jsx(k,{className:"grow-0",children:e.jsx(cn,{file:f,uploadProgress:me,removeFile:()=>D(f.fileID)})},f.fileID))}),R.length!==0&&e.jsx(Qn,{compressImages:P,setCompressImages:ge})]})},s.name)]}),g?e.jsx(Gn,{channelData:s,user:n}):null,e.jsx(Zn,{channelID:s.name,isArchived:s.is_archived,isMemberAdmin:v==null?void 0:v.is_admin})]})})},Qn=({compressImages:s,setCompressImages:n})=>e.jsx("div",{className:"px-3",children:e.jsx(ze,{size:"2",weight:"regular",children:e.jsxs(on,{align:"center",gap:"2",children:[e.jsx(ye,{checked:s,onCheckedChange:()=>{n(!s)}}),"Compress Images"]})})}),Dn=({children:s})=>{const{threadID:n}=xe();return e.jsx("div",{className:Xe("flex flex-col overflow-hidden px-2 pt-16 justify-end h-full",n?"sm:pl-4":"sm:px-4"),children:s})},js=({channelID:s,channelName:n,type:i,onClose:r})=>{var M;const t=Ms({defaultValues:{channel_name:n}}),{control:c,handleSubmit:d,setValue:o,formState:{errors:a}}=t,{updateDoc:x,loading:p,error:j}=Te(),_=C=>ne(void 0,null,function*(){return x("Raven Channel",s!=null?s:null,{channel_name:C.channel_name}).then(()=>{U.success("Channel name updated"),r()})}),v=u.useCallback(C=>{var S;o("channel_name",(S=C.target.value)==null?void 0:S.toLowerCase().replace(" ","-"))},[o]),b=A();return e.jsx(zs,G(z({},t),{children:e.jsxs("form",{onSubmit:d(_),children:[e.jsx(J,{children:"Rename this channel"}),e.jsxs(l,{gap:"2",direction:"column",width:"100%",children:[e.jsx(B,{error:j}),e.jsxs(k,{width:"100%",children:[e.jsx(ze,{htmlFor:"channel_name",isRequired:!0,children:"Name"}),e.jsx(Os,{name:"channel_name",control:c,rules:{required:"Please add a channel name",maxLength:{value:50,message:"Channel name cannot be more than 50 characters."},minLength:{value:3,message:"Channel name cannot be less than 3 characters."},pattern:{value:/^[a-zA-Z0-9][a-zA-Z0-9-]*$/,message:"Channel name can only contain letters, numbers and hyphens."}},render:({field:C,fieldState:{error:S}})=>e.jsxs(qe,G(z({maxLength:50,required:!0,autoFocus:b,placeholder:"e.g. wedding-gone-wrong, joffrey-tributes",color:S?"red":void 0},C),{"aria-invalid":S?"true":"false",onChange:v,children:[e.jsx(de,{side:"left",children:e.jsx(Q,{type:i})}),e.jsx(de,{side:"right",children:e.jsx(h,{size:"2",weight:"light",color:"gray",children:50-C.value.length})})]}))}),(a==null?void 0:a.channel_name)&&e.jsx(Me,{children:(M=a.channel_name)==null?void 0:M.message})]})]}),e.jsxs(l,{gap:"3",mt:"6",justify:"end",align:"center",children:[e.jsx(Qe,{disabled:p,children:e.jsx(y,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsxs(y,{type:"submit",disabled:p,children:[p&&e.jsx(I,{className:"text-white"}),p?"Saving":"Save"]})]})]})}))},en=c=>{var d=c,{channelID:s,channel_name:n,channelType:i,buttonVisible:r=!1}=d,t=Ke(d,["channelID","channel_name","channelType","buttonVisible"]);const[o,a]=u.useState(!1),x=()=>{a(!1)};return A()?e.jsxs(H,{open:o,onOpenChange:a,children:[e.jsx(Be,{children:e.jsx(Le,G(z({variant:"ghost",color:"gray",className:Xe(r?"":"invisible group-hover:visible"),"aria-label":"Click to edit channel name",title:"Edit channel name"},t),{children:e.jsx(cs,{size:"14"})}))}),e.jsx(Y,{className:V,children:e.jsx(js,{channelID:s,channelName:n,onClose:x,type:i})})]}):e.jsxs(E,{open:o,onOpenChange:a,children:[e.jsx(ue,{asChild:!0,children:e.jsx(Le,G(z({variant:"ghost",color:"gray",className:Xe(r?"":"invisible group-hover:visible"),"aria-label":"Click to edit channel name",title:"Edit channel name"},t),{children:e.jsx(cs,{size:"14"})}))}),e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(js,{channelID:s,channelName:n,onClose:x,type:i})})})]})},ms=u.lazy(()=>hn(()=>import("./ViewFilesContent-dd4ad41a.js"),["assets/ViewFilesContent-dd4ad41a.js","assets/index-81db420b.js","assets/index-27ae9ec0.css","assets/useDebounce-02f398f3.js","assets/PageSelector-75a82642.js","assets/TableLoader-47d8c4ae.js","assets/Skeleton-9de30e70.js"])),ei=({open:s,setOpen:n})=>A()?e.jsx(H,{open:s,onOpenChange:n,children:e.jsx(Y,{className:`${V} min-w-[64rem]`,children:e.jsx(u.Suspense,{fallback:e.jsx(l,{align:"center",justify:"center",className:"h-64",children:e.jsx(I,{})}),children:e.jsx(ms,{})})})}):e.jsx(E,{open:s,onOpenChange:n,children:e.jsx(q,{children:e.jsx(u.Suspense,{fallback:e.jsx(l,{align:"center",justify:"center",className:"h-[80vh]",children:e.jsx(I,{})}),children:e.jsx(ms,{})})})}),si=({open:s,setOpen:n})=>{const i=u.useCallback(()=>{n(!1)},[n]);return A()?e.jsx(H,{open:s,onOpenChange:n,children:e.jsx(Y,{className:"static",children:e.jsx(us,{onClose:i})})}):e.jsx(E,{open:s,onOpenChange:n,children:e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-96 px-1 overflow-auto",children:e.jsx(us,{onClose:i})})})})},ni=({onToggleMyChannels:s,isOnlyInMyChannels:n,onToggleSaved:i,isSaved:r,input:t,fromFilter:c,withFilter:d,inFilter:o})=>{var P,ge;const[a,x]=u.useState(t),p=rs(a),{channels:j,dm_channels:_}=u.useContext(De),[v,b]=u.useState(c),[M,C]=u.useState(o||((P=_.find(m=>m.peer_user_id==d))==null?void 0:P.name)),[S,L]=u.useState(),[O,R]=u.useState(),T=Xs(),D=m=>{x(m.target.value)},{data:w,error:ee,isLoading:me}=_e("raven.api.search.get_search_result",{filter_type:"File",search_text:p,from_user:v==="any"?void 0:v,in_channel:M==="any"?void 0:M,saved:r,date:S,file_type:O==="any"?void 0:O,message_type:O==="any"||O===void 0?void 0:O==="image"?"Image":"File",my_channel_only:n},void 0,{revalidateOnFocus:!1});return e.jsxs(k,{children:[e.jsxs(l,{direction:"column",gap:"2",children:[e.jsxs(l,{align:"center",gap:"2",children:[e.jsxs(qe,{style:{width:"80%"},onChange:D,type:"text",placeholder:"Search messages",value:a,autoFocus:!0,children:[e.jsx(de,{side:"left",children:e.jsx(Ge,{})}),e.jsx(de,{side:"right",children:me&&e.jsx(I,{})})]}),e.jsxs(ie,{value:O,onValueChange:R,children:[e.jsx(re,{placeholder:"File Type",className:"min-w-[20%]"}),e.jsx(le,{className:"z-50",children:e.jsxs(K,{children:[e.jsx(X,{children:"File Type"}),e.jsx(N,{value:"any",children:e.jsxs(l,{align:"center",gap:"1",children:[e.jsx(k,{width:"16px",children:"ðŸ¤·ðŸ»â€â™€ï¸"}),"Any"]})}),e.jsx(N,{value:"pdf",children:e.jsxs(l,{align:"center",gap:"1",children:[e.jsx(ve,{ext:"pdf"}),"PDF"]})}),e.jsx(N,{value:"doc",children:e.jsxs(l,{align:"center",gap:"1",children:[e.jsx(ve,{ext:"doc"}),"Documents (.doc)"]})}),e.jsx(N,{value:"ppt",children:e.jsxs(l,{align:"center",gap:"1",children:[e.jsx(ve,{ext:"ppt"}),"Presentations (.ppt)"]})}),e.jsx(N,{value:"xls",children:e.jsxs(l,{align:"center",gap:"1",children:[e.jsx(ve,{ext:"xls"}),"Spreadsheets (.xls)"]})}),e.jsx(N,{value:"image",children:e.jsxs(l,{align:"center",gap:"1",children:[e.jsx(ve,{ext:"jpg"}),"Images"]})})]})})]})]}),e.jsxs(es,{gap:"2",justify:"between",columns:{initial:"2",md:"5"},align:"center",children:[e.jsxs(ie,{value:v,onValueChange:b,children:[e.jsx(re,{placeholder:"From",id:"from-filter"}),e.jsxs(le,{className:"z-50",children:[e.jsx(N,{value:"any",children:"From anyone"}),e.jsxs(K,{children:[e.jsx(X,{children:"Message from"}),Object.values(T).map(m=>e.jsx(N,{textValue:m.full_name,value:m.name,children:e.jsxs(l,{gap:"2",align:"center",children:[e.jsx(he,{src:m.user_image,alt:m.full_name}),e.jsx(h,{children:m.full_name})]})},m.name))]})]})]}),e.jsxs(ie,{value:M,onValueChange:C,children:[e.jsx(re,{placeholder:"Channel / DM"}),e.jsxs(le,{className:"z-50",children:[e.jsx(N,{value:"any",children:"Any channel"}),e.jsxs(K,{children:[e.jsx(X,{children:"Channels"}),j.map(m=>e.jsx(N,{value:m.name,children:e.jsxs(l,{gap:"2",align:"center",className:"overflow-hidden",children:[e.jsx(Q,{type:m.type}),e.jsx(h,{style:{maxWidth:"20ch"},className:"text-ellipsis whitespace-break-spaces line-clamp-1",children:m.channel_name})]})},m.name))]}),e.jsx(As,{}),e.jsxs(K,{children:[e.jsx(X,{children:"Direct Messages"}),_.map(m=>{var W,Z,te,g,$,f,F;return e.jsx(N,{value:m.name,textValue:(Z=(W=T[m.peer_user_id])==null?void 0:W.full_name)!=null?Z:m.peer_user_id,children:e.jsxs(l,{gap:"2",align:"center",children:[e.jsx(he,{src:(te=T[m.peer_user_id])==null?void 0:te.user_image,alt:($=(g=T[m.peer_user_id])==null?void 0:g.full_name)!=null?$:m.peer_user_id}),e.jsx(h,{children:(F=(f=T[m.peer_user_id])==null?void 0:f.full_name)!=null?F:m.peer_user_id})]})},m.name)})]})]})]}),e.jsxs(ie,{value:S,onValueChange:L,children:[e.jsx(re,{placeholder:"Date"}),e.jsx(le,{className:"z-50",children:e.jsxs(K,{children:[e.jsx(X,{children:"Date"}),e.jsx(N,{value:"any",children:"Any time"}),sn.map(m=>e.jsx(N,{value:m.value,children:m.label},m.value))]})})]}),e.jsx(h,{as:"label",size:"2",children:e.jsxs(l,{gap:"2",children:[e.jsx(ye,{checked:n,onCheckedChange:s})," Only in my channels"]})}),e.jsx(h,{as:"label",size:"2",children:e.jsxs(l,{gap:"2",children:[e.jsx(ye,{checked:r,onCheckedChange:i})," Saved"]})})]})]}),e.jsxs(Ls,{type:"always",scrollbars:"vertical",className:"sm:h-[420px] h-[58vh]",mt:"4",children:[e.jsx(B,{error:ee}),((ge=w==null?void 0:w.message)==null?void 0:ge.length)===0&&e.jsx(Zs,{}),w!=null&&w.message&&w.message.length>0?e.jsx(l,{direction:"column",gap:"4",children:w.message.map(m=>{var W;return e.jsxs(l,{gap:"3",align:"center",children:[e.jsxs(l,{align:"center",justify:"center",className:"w-[10%] sm:w-[5%]",children:[m.message_type==="File"&&e.jsx(ve,{ext:xn(m.file),size:"24"}),m.message_type==="Image"&&e.jsx("img",{src:m.file,alt:"File preview",className:"rounded-md object-cover",style:{width:"36px",height:"36px"}})]}),e.jsxs(l,{direction:"column",className:"w-[94%]",children:[m.file&&e.jsx(Ps,{weight:"medium",size:"1",href:m.file,target:"_blank",children:un(m.file)}),T&&e.jsxs(h,{size:"1",color:"gray",children:["Shared by ",(W=Object.values(T).find(Z=>Z.name===m.owner))==null?void 0:W.full_name," on ",e.jsx(Ts,{date:m.creation})]})]})]},m.name)})}):null]})]})},ii=({onToggleMyChannels:s,isOnlyInMyChannels:n,onToggleSaved:i,isSaved:r,input:t,fromFilter:c,inFilter:d,withFilter:o,onClose:a})=>{var W,Z,te;const[x,p]=u.useState(t),j=rs(x),{channels:_,dm_channels:v}=u.useContext(De),[b,M]=u.useState(c),[C,S]=u.useState(d||((W=v.find(g=>g.peer_user_id==o))==null?void 0:W.name)),[L,O]=u.useState(),R=We(),T=(g,$,f)=>{a();let F=`/channel/${g}`;f&&(F=`/${f}/${g}`),R({pathname:F,search:`message_id=${$}`})},D=(g,$,f)=>ne(void 0,null,function*(){T($,g,f)}),w=Xs(),ee=g=>{p(g.target.value)},me=u.useMemo(()=>{const g=C!==void 0,$=b!=="any"&&b!==void 0,f=L!=="any"&&L!==void 0;return j.length>2||g||$||f||n===!0},[j,C,b,n,L]),{data:P,error:ge,isLoading:m}=_e("raven.api.search.get_search_result",{filter_type:"Message",search_text:j,from_user:b==="any"?void 0:b,in_channel:C==="any"?void 0:C,saved:r,date:L==="any"?void 0:L,my_channel_only:n},me?void 0:null,{revalidateOnFocus:!1});return e.jsxs(k,{children:[e.jsxs(l,{direction:"column",gap:"2",children:[e.jsxs(qe,{onChange:ee,type:"text",placeholder:"Search messages",value:x,autoFocus:!0,children:[e.jsx(de,{side:"left",children:e.jsx(Ge,{})}),e.jsx(de,{side:"right",children:m&&e.jsx(I,{})})]}),e.jsxs(es,{gap:"2",justify:"between",columns:{initial:"2",md:"5"},align:"center",children:[e.jsxs(ie,{value:b,onValueChange:M,children:[e.jsx(re,{placeholder:"From",id:"from-filter"}),e.jsxs(le,{className:"z-50",children:[e.jsx(N,{value:"any",children:"From anyone"}),e.jsxs(K,{children:[e.jsx(X,{children:"Message from"}),Object.values(w).map(g=>e.jsx(N,{textValue:g.full_name,value:g.name,children:e.jsxs(l,{gap:"2",align:"center",children:[e.jsx(he,{src:g.user_image,alt:g.full_name}),e.jsx(h,{children:g.full_name})]})},g.name))]})]})]}),e.jsxs(ie,{value:C,onValueChange:S,children:[e.jsx(re,{placeholder:"Channel / DM"}),e.jsxs(le,{className:"z-50",children:[e.jsx(N,{value:"any",children:"Any channel"}),e.jsxs(K,{children:[e.jsx(X,{children:"Channels"}),_.map(g=>e.jsx(N,{value:g.name,children:e.jsxs(l,{gap:"2",align:"center",className:"overflow-hidden",children:[e.jsx(Q,{type:g.type}),e.jsx(h,{style:{maxWidth:"20ch"},className:"text-ellipsis whitespace-break-spaces line-clamp-1",children:g.channel_name})]})},g.name))]}),e.jsx(As,{}),e.jsxs(K,{children:[e.jsx(X,{children:"Direct Messages"}),v.map(g=>{var $,f,F,se,pe,we,Ne;return e.jsx(N,{value:g.name,textValue:(f=($=w[g.peer_user_id])==null?void 0:$.full_name)!=null?f:g.peer_user_id,children:e.jsxs(l,{gap:"2",align:"center",children:[e.jsx(he,{src:(F=w[g.peer_user_id])==null?void 0:F.user_image,alt:(pe=(se=w[g.peer_user_id])==null?void 0:se.full_name)!=null?pe:g.peer_user_id}),e.jsx(h,{children:(Ne=(we=w[g.peer_user_id])==null?void 0:we.full_name)!=null?Ne:g.peer_user_id})]})},g.name)})]})]})]}),e.jsxs(ie,{value:L,onValueChange:O,children:[e.jsx(re,{placeholder:"Date"}),e.jsx(le,{className:"z-50",children:e.jsxs(K,{children:[e.jsx(X,{children:"Date"}),e.jsx(N,{value:"any",children:"Any time"}),sn.map(g=>e.jsx(N,{value:g.value,children:g.label},g.value))]})})]}),e.jsx(h,{as:"label",size:"2",children:e.jsxs(l,{gap:"2",children:[e.jsx(ye,{checked:n,onCheckedChange:s})," Only in my channels"]})}),e.jsx(h,{as:"label",size:"2",children:e.jsxs(l,{gap:"2",children:[e.jsx(ye,{checked:r,onCheckedChange:i})," Saved"]})})]})]}),e.jsxs(Ls,{type:"always",scrollbars:"vertical",className:"sm:h-[420px] h-[58vh]",mt:"4",children:[e.jsx(B,{error:ge}),((Z=P==null?void 0:P.message)==null?void 0:Z.length)===0&&e.jsx(Zs,{}),(te=P==null?void 0:P.message)!=null&&te.length&&(P==null?void 0:P.message.length)>0?e.jsx(l,{direction:"column",gap:"2",children:P.message.map(g=>e.jsx(Qs,{message:G(z({},g),{message_type:"Text",is_continuation:0,is_reply:0,_liked_by:"[]"}),handleScrollToMessage:D},g.name))}):!me&&e.jsx(k,{className:"text-center",py:"8",children:e.jsx(h,{size:"2",className:"text-gray-11",children:"Add a search query above to see results."})})]})]})};function ri(s){const{isOpen:n,onClose:i}=s,r=c=>{c||i()};return A()?e.jsx(H,{open:n,onOpenChange:r,children:e.jsx(Y,{className:V,style:{width:"80vw",maxWidth:"80vw"},children:e.jsx(gs,z({},s))})}):e.jsx(E,{open:n,onClose:i,children:e.jsx(q,{children:e.jsx("div",{className:"h-[75vh] pb-24 overflow-y-scroll",children:e.jsx(gs,z({},s))})})})}const gs=s=>{const[n,{toggle:i}]=ae(),[r,{toggle:t}]=ae(),{tabIndex:c,input:d,fromFilter:o,withFilter:a,inFilter:x,onClose:p}=s;return e.jsxs(e.Fragment,{children:[e.jsx(J,{children:"Search Results"}),e.jsx(l,{direction:"column",gap:"2",children:e.jsxs(Bs,{defaultValue:c.toString(),children:[e.jsxs(Rs,{children:[e.jsx(Oe,{value:"0",children:"Messages"}),e.jsx(Oe,{value:"1",children:"Files"})]}),e.jsxs(k,{pt:"3",pb:"2",children:[e.jsx(Ae,{value:"0",children:e.jsx(ii,{onToggleMyChannels:i,isOnlyInMyChannels:n,onToggleSaved:t,isSaved:r,input:d,fromFilter:o,inFilter:x,withFilter:a,onClose:p})}),e.jsx(Ae,{value:"1",children:e.jsx(ni,{onToggleMyChannels:i,isOnlyInMyChannels:n,onToggleSaved:t,isSaved:r,input:d,fromFilter:o,inFilter:x,withFilter:a})})]})]})})]})},sn=[{label:"Today",value:fe(0)},{label:"Yesterday",value:fe(-1)},{label:"Last 7 days",value:fe(-6)},{label:"Last 30 days",value:fe(-29)},{label:"Last three months",value:fe(-89)},{label:"Last 12 months",value:fe(-364)}];function fe(s){const n=new Date;n.setDate(n.getDate()+s);const i=n.getFullYear(),r=(n.getMonth()+1).toString().padStart(2,"0"),t=n.getDate().toString().padStart(2,"0");return`${i}-${r}-${t} 00:00:00`}const ps=({onClose:s,channelData:n,isDrawer:i,closeDetailsModal:r})=>{const{call:t,loading:c,error:d}=ss("raven.api.raven_channel.leave_channel"),o=We(),{mutate:a}=u.useContext(De),x=()=>ne(void 0,null,function*(){return t({channel_id:n==null?void 0:n.name}).then(()=>{U("You have left the channel"),s(),a(),o("../"),r()}).catch(v=>{U.error("Could not leave channel",{description:$s(v)})})}),p=i?J:Pe,j=i?u.Fragment:Je,_=i?u.Fragment:He;return e.jsxs(e.Fragment,{children:[e.jsx(p,{children:e.jsxs(l,{gap:"1",children:[e.jsx(h,{children:"Leave "}),e.jsx(Q,{type:n==null?void 0:n.type,className:"mt-1"}),e.jsxs(h,{children:[n==null?void 0:n.channel_name,"?"]})]})}),e.jsxs(l,{direction:"column",gap:"2",children:[e.jsx(B,{error:d}),(n==null?void 0:n.type)==="Private"?e.jsx(h,{size:"1",children:"When you leave this channel, youâ€™ll no longer be able to see any of its messages. To rejoin, youâ€™ll need to be invited."}):e.jsx(h,{size:"1",children:"When you leave this channel, youâ€™ll no longer be able to send anymore messages, you will have to rejoin the channel to continue participation."})]}),e.jsxs(l,{gap:"3",mt:"4",justify:"end",children:[e.jsx(j,{children:e.jsx(y,{variant:"soft",color:"gray",onClick:s,children:"Cancel"})}),e.jsx(_,{children:e.jsxs(y,{variant:"solid",color:"red",onClick:x,disabled:c,children:[c&&e.jsx(I,{className:"text-white"}),c?"Leaving":"Leave"]})})]})]})},li=({channelData:s,onClose:n})=>{const[i,r]=u.useState(!1),t=()=>{r(!1)};return A()?e.jsxs(Ye,{open:i,onOpenChange:r,children:[e.jsx(ns,{children:e.jsx(y,{variant:"ghost",className:"text-left text-red-700 hover:bg-red-3 w-fit not-cal",children:"Leave channel"})}),e.jsx(Ze,{className:V,children:e.jsx(ps,{onClose:t,closeDetailsModal:n,channelData:s})})]}):e.jsxs(E,{open:i,onOpenChange:r,children:[e.jsx(ue,{asChild:!0,children:e.jsx(y,{variant:"ghost",className:"text-left text-red-700 hover:bg-red-3 w-fit not-cal",children:"Leave channel"})}),e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(ps,{onClose:t,isDrawer:!0,closeDetailsModal:n,channelData:s})})})]})},ti=({channelID:s,channelMember:n})=>{const{mutate:i}=Ce(),r=jn(),{call:t}=ss("raven.api.notification.toggle_push_notification_for_channel"),c=()=>{n&&t({member:n==null?void 0:n.channel_member_name,allow_notifications:n!=null&&n.allow_notifications?0:1}).then(d=>{d&&d.message&&i(["channel_members",s],o=>({message:G(z({},o.message),{[n.name]:G(z({},o.message[n.name]),{allow_notifications:d.message.allow_notifications})})}),{revalidate:!1})}).catch(()=>{U.error("Failed to update notification settings")})};return n?e.jsx(k,{className:"p-4 rounded-md border border-gray-6",children:e.jsxs(l,{justify:"between",children:[e.jsxs(l,{direction:"column",gap:"1",children:[e.jsx(h,{as:"label",weight:"medium",htmlFor:"channel_push",size:"2",children:"Push Notifications"}),r?null:e.jsx(h,{size:"1",color:"gray",children:"Push notification is not enabled for the site. Please contact your administrator."})]}),e.jsx(l,{gap:"2",children:e.jsx(mn,{size:"2",checked:!!n.allow_notifications,id:"channel_push",onCheckedChange:c,disabled:!r})})]})}):null},ai=({channelData:s,channelMembers:n,onClose:i})=>{var o;const{currentUser:r}=u.useContext(je),t=is(s.owner),{channelMember:c,isAdmin:d}=u.useMemo(()=>{const a=n[r];return{channelMember:a,isAdmin:(a==null?void 0:a.is_admin)==1}},[n,r]);return e.jsxs(l,{direction:"column",gap:"4",className:"h-[66vh] pb-2 sm:h-96",children:[e.jsx(k,{className:"p-4 rounded-md border border-gray-6",children:e.jsxs(l,{justify:"between",children:[e.jsxs(l,{direction:"column",children:[e.jsx(h,{weight:"medium",size:"2",children:"Channel name"}),e.jsxs(l,{gap:"1",pt:"1",align:"center",children:[e.jsx(Q,{type:s.type,size:"14"}),e.jsx(h,{size:"2",children:s==null?void 0:s.channel_name})]})]}),e.jsx(en,{channelID:s.name,channel_name:s.channel_name,className:"",channelType:s.type,disabled:s.is_archived==1&&!d})]})}),e.jsx(ti,{channelID:s.name,channelMember:c}),e.jsx(k,{className:"p-4 rounded-md border border-gray-6",children:e.jsxs(l,{direction:"column",gap:"4",children:[e.jsxs(l,{justify:"between",children:[e.jsxs(l,{direction:"column",gap:"1",children:[e.jsx(h,{weight:"medium",size:"2",children:"Channel description"}),e.jsx(h,{size:"1",color:"gray",children:s&&s.channel_description&&s.channel_description.length>0?s.channel_description:"No description"})]}),e.jsx(Hn,{channelData:s,is_in_box:!0,disabled:s.is_archived==1&&!d})]}),e.jsx(oe,{className:"w-full"}),e.jsxs(l,{direction:"column",gap:"1",children:[e.jsx(h,{weight:"medium",size:"2",children:"Created by"}),e.jsxs(l,{gap:"1",children:[(s==null?void 0:s.owner)&&e.jsx(h,{size:"1",children:(o=t==null?void 0:t.full_name)!=null?o:s==null?void 0:s.owner}),s.creation&&e.jsxs(h,{size:"1",color:"gray",as:"span",children:["on ",e.jsx(Ts,{date:s==null?void 0:s.creation})]})]})]}),c&&Object.keys(n).length>1&&(s==null?void 0:s.type)!="Open"&&s.is_archived==0&&e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"w-full"}),e.jsx(li,{channelData:s,onClose:i})]})]})})]})},ci=({user:s,channelID:n,updateMembers:i})=>{const{updateDoc:r,loading:t,reset:c}=Te(),{data:d}=_e("frappe.client.get_value",{doctype:"Raven Channel Member",filters:JSON.stringify({channel_id:n,user_id:s.name}),fieldname:JSON.stringify(["name"])},void 0,{revalidateOnFocus:!1}),o=a=>ne(void 0,null,function*(){var x;return r("Raven Channel Member",(x=d==null?void 0:d.message.name)!=null?x:"",{is_admin:a}).then(()=>{U.success("Member has been made an admin"),i(),c()}).catch(p=>{U.error("Failed to update member status",{description:$s(p)}),c()})});return s.is_admin?e.jsxs("div",{className:"flex items-center gap-2",onClick:()=>o(0),children:[e.jsx(gn,{}),t?"Updating member status...":"Dismiss admin"]}):e.jsxs("div",{className:"flex items-center gap-2",onClick:()=>o(1),children:[e.jsx(Is,{}),t?"Updating member status...":"Make channel admin"]})},vs=({onClose:s,member:n})=>{const{deleteDoc:i,error:r,loading:t}=Us(),{channelID:c}=xe(),{channel:d}=Ys(c!=null?c:""),{mutate:o}=Ce(),a=d==null?void 0:d.channelData,{data:x,error:p}=_e("frappe.client.get_value",{doctype:"Raven Channel Member",filters:JSON.stringify({channel_id:c,user_id:n==null?void 0:n.name}),fieldname:JSON.stringify(["name"])},void 0,{revalidateOnFocus:!1}),j=()=>ne(void 0,null,function*(){return i("Raven Channel Member",x==null?void 0:x.message.name).then(()=>{U.success("Removed"),s(),o(["channel_members",c])})});return A()?e.jsxs(e.Fragment,{children:[e.jsx(Pe,{children:e.jsxs(l,{gap:"1",children:[e.jsxs(h,{children:["Remove ",n&&(n==null?void 0:n.full_name)," from"]}),(a==null?void 0:a.type)&&e.jsx(Q,{type:a==null?void 0:a.type,className:"mt-1"}),e.jsxs(h,{children:[a==null?void 0:a.channel_name,"?"]})]})}),e.jsxs(l,{direction:"column",gap:"2",children:[e.jsx(B,{error:p}),e.jsx(B,{error:r}),e.jsx(h,{size:"2",children:"This person will no longer have access to the channel."})]}),e.jsxs(l,{gap:"3",mt:"4",justify:"end",children:[e.jsx(Je,{children:e.jsx(y,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsx(He,{children:e.jsxs(y,{variant:"solid",color:"red",onClick:j,disabled:t,children:[t&&e.jsx(I,{className:"text-white"}),t?"Removing":"Remove"]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsxs(l,{gap:"1",children:[e.jsxs(h,{children:["Remove ",n&&(n==null?void 0:n.full_name)," from"]}),(a==null?void 0:a.type)&&e.jsx(Q,{type:a==null?void 0:a.type,className:"mt-1"}),e.jsxs(h,{children:[a==null?void 0:a.channel_name,"?"]})]})}),e.jsxs(l,{direction:"column",gap:"2",children:[e.jsx(B,{error:p}),e.jsx(B,{error:r}),e.jsx(h,{size:"1",children:"This person will no longer have access to the channel and can only rejoin by invitation."})]}),e.jsxs(l,{gap:"3",mt:"4",justify:"end",children:[e.jsx(y,{variant:"soft",color:"gray",onClick:s,children:"Cancel"}),e.jsxs(y,{variant:"solid",color:"red",onClick:j,disabled:t,children:[t&&e.jsx(I,{className:"text-white"}),t?"Removing":"Remove"]})]})]})},oi=()=>{const[s,n]=u.useState(null),i=u.useCallback(()=>{n(null)},[]);return{member:s,setRemoveMember:n,isOpen:s!==null,onClose:i}},di=({member:s,isOpen:n,onClose:i})=>A()?e.jsx(Ye,{open:n,onOpenChange:i,children:e.jsx(Ze,{className:V,children:s&&e.jsx(vs,{onClose:i,member:s})})}):e.jsx(E,{open:n,children:e.jsx(q,{children:e.jsx("div",{className:"min-h-48",children:s&&e.jsx(vs,{onClose:i,member:s})})})}),hi=({channelData:s,updateMembers:n,selectedMember:i})=>{const d=oi(),{setRemoveMember:r}=d,t=Ke(d,["setRemoveMember"]),c=()=>{r(i)};return e.jsxs(e.Fragment,{children:[e.jsxs(Vs,{children:[e.jsx(Es,{children:e.jsx(y,{variant:"ghost",color:"gray",className:"hover:bg-slate-3 cursor-pointer",size:"1",children:e.jsx(pn,{fontSize:"1rem"})})}),e.jsxs(qs,{className:"z-50",children:[e.jsx(ce,{children:e.jsx(ci,{user:i,channelID:s.name,updateMembers:n})}),e.jsxs(ce,{color:"red",onClick:c,className:"flex items-center gap-2",children:[e.jsx(vn,{}),"Remove from channel"]})]})]}),e.jsx(di,z({},t))]})},xi=({channelData:s,channelMembers:n,activeUsers:i,updateMembers:r})=>{const[t,c]=u.useState(""),d=rs(t,50),o=p=>{c(p.target.value)},{currentUser:a}=u.useContext(je),x=u.useMemo(()=>!!n[a],[a,n]);return e.jsxs(l,{direction:"column",gap:"4",className:"h-[66vh] pb-2 sm:h-96",children:[e.jsxs(l,{gap:"2",justify:"between",children:[e.jsx("div",{className:"w-full sm:w-full",children:e.jsx(qe,{autoFocus:!0,placeholder:"Find members",onChange:o,value:t,children:e.jsx(de,{side:"left",children:e.jsx(Ge,{})})})}),x&&s.type!=="Open"&&s.is_archived==0&&e.jsx("div",{children:e.jsx(Yn,{channelData:s,variant:"soft",size:"2"})})]}),e.jsx(ui,{channelData:s,channelMembers:n,activeUsers:i,updateMembers:r,input:d})]})},ui=({channelData:s,channelMembers:n,activeUsers:i,updateMembers:r,input:t})=>{const{currentUser:c}=u.useContext(je),d=u.useMemo(()=>{const o=Object.values(n);if(!t)return o;const a=t.toLowerCase();return o.filter(x=>{var p;return(p=x==null?void 0:x.full_name)==null?void 0:p.toLowerCase().includes(a)})},[t,n]);return e.jsx(k,{className:"overflow-hidden overflow-y-scroll",children:e.jsx(l,{direction:"column",gap:"2",children:d.length>0?e.jsx(l,{direction:"column",children:d.map(o=>{var a,x;return e.jsx(k,{className:"hover:bg-slate-3 rounded-md",children:e.jsxs(l,{justify:"between",className:"pr-3",children:[e.jsxs(l,{className:"p-2",gap:"3",children:[e.jsx(he,{src:(a=o.user_image)!=null?a:"",alt:o.full_name,size:"2",isActive:i.includes(o.name),availabilityStatus:o.availability_status}),e.jsxs(l,{gap:"2",align:"center",children:[e.jsx(h,{size:"2",weight:"medium",children:o.first_name}),i.includes(o.name)?e.jsx(os,{color:"green"}):e.jsx(os,{}),e.jsxs(l,{gap:"1",children:[e.jsx(h,{weight:"light",size:"1",children:o.full_name}),o.name===c&&e.jsx(h,{weight:"light",size:"1",children:"(You)"}),((x=n[o.name])==null?void 0:x.is_admin)==1&&e.jsx(l,{align:"center",children:e.jsx(Is,{color:"#FFC53D"})})]})]})]}),n[c]&&n[c].is_admin===1&&o.name!==c&&(s==null?void 0:s.type)!=="Open"&&s.is_archived==0&&e.jsx(l,{align:"center",children:e.jsx(hi,{channelData:s,updateMembers:r,selectedMember:o})})]})},o.name)})}):e.jsx(k,{className:"text-center h-10",children:e.jsxs(h,{size:"1",children:["No matches found for ",e.jsx("strong",{children:t})]})})})})},fs=({onClose:s,onCloseViewDetails:n,channelData:i,isDrawer:r})=>{const{updateDoc:t,loading:c,error:d}=Te(),o=We(),a=()=>{var _;t("Raven Channel",(_=i==null?void 0:i.name)!=null?_:"",{is_archived:1}).then(()=>{s(),n(),o(`/${i.workspace}`),U("Channel archived")})},x=r?J:Pe,p=r?u.Fragment:Je,j=r?u.Fragment:He;return e.jsxs(e.Fragment,{children:[r?e.jsx(x,{children:"Archive this channel? "}):e.jsx(Pe,{children:"Archive this channel? "}),e.jsxs(l,{direction:"column",gap:"4",children:[e.jsx(B,{error:d}),e.jsxs(h,{size:"2",children:["Please understand that when you archive ",e.jsx("strong",{children:i==null?void 0:i.channel_name}),":"]}),e.jsx(l,{direction:"column",children:e.jsxs("ul",{className:"list-inside",children:[e.jsx("li",{children:e.jsx(h,{size:"2",children:"It will be removed from your channel list"})}),e.jsx("li",{children:e.jsx(h,{size:"2",children:"No one will be able to send messages to this channel"})})]})}),e.jsx(h,{size:"2",children:"You will still be able to find the channelâ€™s contents via search. And you can always unarchive the channel in the future, if you want."})]}),e.jsxs(l,{gap:"3",mt:"4",justify:"end",children:[e.jsx(p,{children:e.jsx(y,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsx(j,{children:e.jsxs(y,{variant:"solid",color:"red",onClick:a,disabled:c,children:[c&&e.jsx(I,{className:"text-white"}),c?"Archiving":"Archive"]})})]})]})},ji=({onClose:s,channelData:n,allowSettingChange:i})=>{const[r,t]=u.useState(!1),c=()=>{t(!1)};return A()?e.jsxs(Ye,{open:r,onOpenChange:t,children:[e.jsx(ns,{children:e.jsxs(y,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 text-left justify-start rounded-none",disabled:!i,children:[e.jsx(ds,{}),"Archive channel"]})}),e.jsx(Ze,{className:V,children:e.jsx(fs,{onClose:c,onCloseViewDetails:s,channelData:n})})]}):e.jsxs(E,{open:r,onOpenChange:t,children:[e.jsx(ue,{asChild:!0,children:e.jsxs(y,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 text-left justify-start rounded-none",disabled:!i,children:[e.jsx(ds,{}),"Archive channel"]})}),e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(fs,{onClose:c,isDrawer:!0,onCloseViewDetails:s,channelData:n})})})]})},be=({onClose:s,channelData:n,newChannelType:i})=>{const{mutate:r}=Ce(),{updateDoc:t,loading:c,error:d}=Te(),o=a=>{var x;t("Raven Channel",(x=n==null?void 0:n.name)!=null?x:null,{type:a}).then(()=>{r(["channel_members",n.name]),U.success("Channel changed to "+a.toLocaleLowerCase()),s()})};return e.jsxs(e.Fragment,{children:[e.jsxs(J,{children:["Change to a ",i.toLocaleLowerCase()," channel?"]}),e.jsxs(l,{gap:"2",direction:"column",width:"100%",children:[e.jsx(B,{error:d}),i==="Public"&&e.jsxs(l,{direction:"column",gap:"4",children:[e.jsxs(h,{size:"2",children:["Please understand that when you make ",e.jsx("strong",{children:n==null?void 0:n.channel_name})," a public channel:"]}),e.jsxs("ul",{className:"list-inside",children:[e.jsx("li",{children:e.jsx(h,{size:"1",children:"Anyone from your organisation can join this channel and view its message history."})}),e.jsx("li",{children:e.jsx(h,{size:"1",children:"If you make this channel private, it will be visible to anyone who has joined the channel up until that point."})})]})]}),i==="Private"&&e.jsxs(l,{direction:"column",gap:"4",children:[e.jsxs(h,{size:"2",children:["Please understand that when you make ",e.jsx("strong",{children:n==null?void 0:n.channel_name})," a private channel:"]}),e.jsxs("ul",{className:"list-inside",children:[e.jsx("li",{children:e.jsx(h,{size:"1",children:"No changes will be made to the channel's history or members"})}),e.jsx("li",{children:e.jsx(h,{size:"1",children:"All files shared in this channel will become private and will be accessible only to the channel members"})})]})]}),i==="Open"&&e.jsxs(l,{direction:"column",gap:"4",children:[e.jsxs(h,{size:"2",children:["Please understand that when you make ",e.jsx("strong",{children:n==null?void 0:n.channel_name})," a open channel:"]}),e.jsxs("ul",{className:"list-inside",children:[e.jsx("li",{children:e.jsx(h,{size:"1",children:"Everyone from your organisation will become a channel member and will be able to view its message history."})}),e.jsx("li",{children:e.jsx(h,{size:"1",children:"If you later intend to make this private you will have to manually remove members that should not have access to this channel."})})]})]})]}),e.jsxs(l,{gap:"3",mt:"6",justify:"end",align:"center",children:[e.jsx(Qe,{disabled:c,children:e.jsx(y,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsxs(y,{onClick:()=>o(i),disabled:c,children:[c&&e.jsx(I,{className:"text-white"}),c?"Saving":`Change to ${i.toLocaleLowerCase()}`]})]})]})},mi=({channelData:s,allowSettingChange:n})=>e.jsxs(e.Fragment,{children:[s.type==="Public"&&e.jsxs(e.Fragment,{children:[e.jsx(ys,{channelData:s,allowSettingChange:n}),e.jsx(oe,{className:"w-full"})]}),s.type==="Public"&&e.jsx(bs,{channelData:s,allowSettingChange:n}),s.type==="Private"&&e.jsxs(e.Fragment,{children:[e.jsx(ys,{channelData:s,allowSettingChange:n}),e.jsx(oe,{className:"w-full"})]}),s.type==="Private"&&e.jsx(Cs,{channelData:s,allowSettingChange:n}),s.type==="Open"&&e.jsxs(e.Fragment,{children:[e.jsx(bs,{channelData:s,allowSettingChange:n}),e.jsx(oe,{className:"w-full"})]}),s.type==="Open"&&e.jsx(Cs,{channelData:s,allowSettingChange:n})]}),ys=({channelData:s,allowSettingChange:n})=>{const[i,r]=u.useState(!1),t=()=>{r(!1)};return A()?e.jsxs(H,{open:i,onOpenChange:r,children:[e.jsx(Be,{children:e.jsxs(y,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Public"?e.jsx(Ue,{}):e.jsx(Ve,{}),"Change to a ",s.type==="Public"?"private":"public"," channel"]})}),e.jsx(Y,{className:V,children:e.jsx(be,{newChannelType:s.type==="Public"?"Private":"Public",onClose:t,channelData:s})})]}):e.jsxs(E,{open:i,onOpenChange:r,children:[e.jsx(ue,{asChild:!0,children:e.jsxs(y,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Public"?e.jsx(Ue,{}):e.jsx(Ve,{}),"Change to a ",s.type==="Public"?"private":"public"," channel"]})}),e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(be,{newChannelType:s.type==="Public"?"Private":"Public",onClose:t,channelData:s})})})]})},bs=({channelData:s,allowSettingChange:n})=>{const[i,r]=u.useState(!1),t=()=>{r(!1)};return A()?e.jsxs(H,{open:i,onOpenChange:r,children:[e.jsx(Be,{children:e.jsxs(y,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Open"?e.jsx(Ve,{}):e.jsx(Ee,{}),"Change to a ",s.type==="Open"?"public":"open"," channel"]})}),e.jsx(Y,{className:V,children:e.jsx(be,{newChannelType:s.type==="Open"?"Public":"Open",onClose:t,channelData:s})})]}):e.jsxs(E,{open:i,onOpenChange:r,children:[e.jsx(ue,{asChild:!0,children:e.jsxs(y,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Open"?e.jsx(Ve,{}):e.jsx(Ee,{}),"Change to a ",s.type==="Open"?"public":"open"," channel"]})}),e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(be,{newChannelType:s.type==="Open"?"Public":"Open",onClose:t,channelData:s})})})]})},Cs=({channelData:s,allowSettingChange:n})=>{const[i,r]=u.useState(!1),t=()=>{r(!1)};return A()?e.jsxs(H,{open:i,onOpenChange:r,children:[e.jsx(Be,{children:e.jsxs(y,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Open"?e.jsx(Ue,{}):e.jsx(Ee,{}),"Change to a ",s.type==="Open"?"private":"open"," channel"]})}),e.jsx(Y,{className:V,children:e.jsx(be,{newChannelType:s.type==="Open"?"Private":"Open",onClose:t,channelData:s})})]}):e.jsxs(E,{open:i,onOpenChange:r,children:[e.jsx(ue,{asChild:!0,children:e.jsxs(y,{className:"py-6 px-4 bg-transparent text-zinc-900 dark:text-white not-cal hover:bg-gray-3 justify-start rounded-none",disabled:!n,children:[s.type==="Open"?e.jsx(Ue,{}):e.jsx(Ee,{}),"Change to a ",s.type==="Open"?"private":"open"," channel"]})}),e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(be,{newChannelType:s.type==="Open"?"Private":"Open",onClose:t,channelData:s})})})]})},_s=({onClose:s,onCloseParent:n,isDrawer:i,channelData:r})=>{const{mutate:t}=Ce(),{deleteDoc:c,error:d,loading:o,reset:a}=Us(),x=()=>{s(),a()},p=We(),j=localStorage.getItem("ravenLastWorkspace"),_=()=>{r!=null&&r.name&&c("Raven Channel",r.name).then(()=>{t(["channel_members",r.name],void 0,{revalidate:!1}),s(),n(),localStorage.removeItem("ravenLastChannel"),p(j?`/${j}`:"/"),U(`Channel ${r.channel_name} deleted.`)})},[v,b]=u.useState(!1),M=i?J:Pe,C=i?u.Fragment:Je,S=i?u.Fragment:He;return e.jsxs(e.Fragment,{children:[e.jsx(M,{children:"Delete this channel?"}),e.jsxs(l,{direction:"column",gap:"4",children:[e.jsx(B,{error:d}),e.jsxs(fn,{color:"red",size:"1",children:[e.jsx(yn,{children:e.jsx(bn,{size:"18"})}),e.jsx(Cn,{children:"This action is permanent and cannot be undone."})]}),e.jsx(h,{size:"2",children:"When you delete a channel, all messages from this channel will be removed immediately."}),e.jsx(l,{direction:"column",children:e.jsxs("ul",{className:"list-inside",children:[e.jsx("li",{children:e.jsx(h,{as:"span",size:"2",children:"All messages, including files and images will be removed"})}),e.jsx("li",{children:e.jsx(h,{as:"span",size:"2",children:"You can archive this channel instead to preserve your messages"})})]})}),e.jsx(h,{size:"2",as:"label",children:e.jsxs(l,{gap:"2",align:"center",children:[e.jsx(ye,{onClick:()=>b(!v),color:"red"}),"Yes, I understand, permanently delete this channel"]})})]}),e.jsxs(l,{gap:"3",mt:"4",justify:"end",children:[e.jsx(C,{children:e.jsx(y,{variant:"soft",color:"gray",onClick:x,children:"Cancel"})}),e.jsx(S,{children:e.jsxs(y,{variant:"solid",color:"red",onClick:_,disabled:!v||o,children:[o&&e.jsx(I,{className:"text-white"}),o?"Deleting":"Delete"]})})]})]})},gi=({onClose:s,channelData:n,allowSettingChange:i})=>{const[r,t]=u.useState(!1),c=()=>{t(!1)};return A()?e.jsxs(Ye,{open:r,onOpenChange:t,children:[e.jsx(ns,{children:e.jsxs(y,{className:"py-6 px-4 bg-transparent text-red-700 dark:text-red-500 hover:bg-red-3 dark:hover:bg-red-2 not-cal text-left justify-start rounded-none rounded-b-md",disabled:!i,children:[e.jsx(hs,{}),"Delete channel"]})}),e.jsx(Ze,{className:V,children:e.jsx(_s,{onClose:c,onCloseParent:s,channelData:n})})]}):e.jsxs(E,{open:r,onOpenChange:t,children:[e.jsx(ue,{asChild:!0,children:e.jsxs(y,{className:"py-6 px-4 bg-transparent text-red-700 dark:text-red-500 hover:bg-red-3 dark:hover:bg-red-2 not-cal text-left justify-start rounded-none",disabled:!i,children:[e.jsx(hs,{}),"Delete channel"]})}),e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(_s,{onClose:c,isDrawer:!0,onCloseParent:s,channelData:n})})})]})},pi=({onClose:s,channelData:n,allowSettingChange:i})=>e.jsx("div",{className:"h-96",children:e.jsxs(l,{direction:"column",gap:"3",children:[e.jsx(k,{className:"rounded-md border border-gray-6",children:e.jsxs(l,{direction:"column",children:[e.jsx(mi,{channelData:n,allowSettingChange:i}),e.jsx(oe,{className:"w-full"}),e.jsx(ji,{onClose:s,channelData:n,allowSettingChange:i}),e.jsx(oe,{className:"w-full"}),e.jsx(gi,{onClose:s,channelData:n,allowSettingChange:i})]})}),e.jsxs(l,{direction:"column",gap:"1",children:[e.jsx(h,{size:"1",weight:"light",className:"px-1",children:"Only channel admins are allowed to change the channel settings"}),e.jsx(h,{size:"1",weight:"light",className:"px-1",children:"General channel cannot be modified/ removed"})]})]})}),vi=({open:s,setOpen:n,channelData:i})=>A()?e.jsx(H,{open:s,onOpenChange:n,children:e.jsx(Y,{className:V,children:e.jsx(ws,{open:s,setOpen:n,channelData:i})})}):e.jsx(E,{open:s,onOpenChange:n,children:e.jsx(q,{children:e.jsx(ws,{open:s,setOpen:n,channelData:i})})}),ws=({setOpen:s,channelData:n})=>{var j,_;const{data:i}=_n(),r=(j=i==null?void 0:i.message)!=null?j:[],{channelMembers:t,mutate:c}=Re(n.name),d=Object.keys(t).length,{currentUser:o}=u.useContext(je),a=n.type,x=u.useCallback(()=>{s(!1)},[s]),p=((_=t[o])==null?void 0:_.is_admin)==1||!1;return e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsxs(l,{align:"center",gap:"2",children:[e.jsx(Q,{className:"mt-1",type:a}),e.jsx(h,{children:n.channel_name})]})}),e.jsx(Bs,{defaultValue:"About",children:e.jsxs(l,{direction:"column",gap:"4",children:[e.jsxs(Rs,{children:[e.jsx(Oe,{value:"About",children:"About"}),e.jsx(Oe,{value:"Members",children:e.jsxs(l,{gap:"2",children:[e.jsx(h,{children:"Members"}),e.jsx(h,{children:d})]})}),e.jsx(Oe,{value:"Settings",children:"Settings"})]}),e.jsxs(k,{children:[e.jsx(Ae,{value:"About",children:e.jsx(ai,{channelData:n,channelMembers:t,onClose:x})}),e.jsx(Ae,{value:"Members",children:e.jsx(xi,{channelData:n,channelMembers:t,activeUsers:r,updateMembers:c})}),e.jsx(Ae,{value:"Settings",children:e.jsx(pi,{channelData:n,onClose:x,allowSettingChange:p})})]})]})})]})};function fi(s){return Gs({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M960.496 415.056l-82.129-18.224c-6.4-20.48-14.784-40.08-24.4-58.927l44.431-74.032c16.592-26.512 24.976-65.52 0-90.512l-45.28-45.248c-24.976-24.992-67.151-20.496-92.623-2.832l-72.032 45.887c-18.689-9.696-38.225-18-58.529-24.56l-18.431-83.12C605.999 33.009 579.343 0 543.999 0h-64c-35.344 0-57.008 33.504-64 64l-20.528 82.128c-21.68 6.912-42.496 15.744-62.336 26.208l-73.84-47.024c-25.456-17.664-67.648-22.16-92.624 2.832l-45.264 45.248c-24.992 25.008-16.608 64 0 90.512l46.752 77.92c-8.767 17.664-16.544 35.936-22.544 55.024l-82.112 18.224C33.007 420.56 0 447.216 0 482.56v64c0 35.344 33.504 57.008 64 64l83.152 20.784c5.745 17.632 12.928 34.56 21.056 50.976l-46.8 78c-16.591 26.496-24.975 65.504 0 90.496l45.28 45.248c24.976 25.008 67.152 20.496 92.624 2.847l74-47.152c19.952 10.528 40.88 19.44 62.704 26.337L416.495 960c7.008 30.496 28.656 64 64 64h64c35.344 0 62-33.007 67.504-63.504l18.464-83.343c20.096-6.496 39.376-14.689 57.84-24.257l72.192 46c25.472 17.664 67.664 22.16 92.624-2.848L898.4 850.8c24.976-25.008 16.592-64 0-90.496l-44.463-74.128c8.944-17.568 16.688-35.84 22.912-54.848L960 610.56c30.496-7.008 64-28.656 64-64v-64c0-35.344-32.992-62-63.504-67.504zm-.465 126.992c-2.72 1.952-7.842 4.635-14.338 6.139l-118.656 29.631-11.008 33.632c-4.975 15.153-11.407 30.529-19.119 45.712l-16.064 31.569 62.688 104.528c4 6.4 5.872 12.127 6.432 15.503l-42.096 42.033c-4.064-1.28-8.688-2.945-10.912-4.464l-105.344-67.184-32.752 16.945c-15.776 8.192-31.969 14.976-48.097 20.192l-34.88 11.28-26.368 119.12c-1.216 6.368-4.624 11.504-6.96 13.344h-57.6c-1.951-2.72-4.623-7.84-6.112-14.32L449.39 827.9l-34.095-10.817c-17.569-5.536-35.088-12.912-52.144-21.904l-32.912-17.376-105.36 67.152c-4.304 2.912-8.912 4.56-13.088 4.56l-41.968-40.847c.56-3.311 2.304-8.783 5.792-14.367l65.456-109.056-15.568-31.344c-7.264-14.784-13.024-28.656-17.504-42.4l-10.992-33.664L79.518 548.46c-7.392-1.68-12.736-4.432-15.52-6.4v-59.504c.032.016.08.032.145.032 1.072 0 6.336-3.745 10.72-4.544l120.72-26.737 11.087-35.28c4.512-14.368 10.672-29.344 18.816-45.775l15.568-31.36-64.767-107.92c-4.016-6.432-5.872-12.16-6.432-15.52l42.08-42.065c4.08 1.312 8.672 2.96 10.88 4.48l107.312 68.4 32.88-17.344c16.88-8.895 34.336-16.239 51.904-21.823l34.016-10.832L478.11 79.501c1.697-7.391 4.416-12.735 6.4-15.52H544c-.433.657 3.68 6.24 4.527 10.865l26.88 121.408 34.848 11.264c16.336 5.28 32.752 12.16 48.72 20.448l32.752 17.008 103.152-65.712c4.32-2.945 8.944-4.576 13.088-4.576l42 40.816c-.56 3.328-2.32 8.816-5.808 14.416l-63.344 105.488 16.16 31.616c8.72 17.056 15.376 33.056 20.32 48.928l11.056 35.344L946.64 477.55c7.153 1.328 12.721 5.456 13.905 7.696zM512.43 319.674c-106.272 0-192.736 86.288-192.736 192.32 0 106.016 86.464 192.304 192.736 192.304s192.736-86.288 192.736-192.304c0-106.032-86.464-192.32-192.736-192.32zm-.432 320.32c-70.576 0-128-57.424-128-128 0-70.592 57.424-128 128-128 70.592 0 128 57.408 128 128 0 70.576-57.424 128-128 128z"},child:[]}]})(s)}const Ns=({onClose:s,channelData:n})=>{var C,S,L,O,R,T,D;let i=`Meeting with #${n.channel_name}`;const{currentUser:r}=u.useContext(je),t=Ss(),c=is((C=n.peer_user_id)!=null?C:void 0);n.is_direct_message&&(i=`Meeting between ${(S=c==null?void 0:c.full_name)!=null?S:n.peer_user_id} and ${(L=t==null?void 0:t.full_name)!=null?L:r}`);const d=Ms({defaultValues:{channel:n.name,subject:i,duration:"60"}}),{control:o,handleSubmit:a,register:x,setValue:p,formState:{errors:j}}=d;_e("frappe.client.get_value",{doctype:"Google Calendar",fieldname:["name"],filters:{user:r,enable:1}},void 0,{onSuccess:w=>{w.message&&p("google_calendar",w.message.name)}});const{call:_,loading:v,error:b}=ss("raven.api.events.create_event"),M=w=>ne(void 0,null,function*(){return _(w).then(ee=>{U.success("Meeting created",{description:e.jsx(Ps,{href:ee.message.google_meet_link,underline:"always",className:"cursor-pointer",target:"_blank",rel:"noreferrer",children:ee.message.google_meet_link})}),s()})});return e.jsx(zs,G(z({},d),{children:e.jsxs("form",{onSubmit:a(M),children:[e.jsx(J,{children:"Start a Meeting"}),e.jsxs(l,{gap:"2",direction:"column",width:"100%",children:[e.jsx(B,{error:b}),e.jsx(k,{width:"100%",children:e.jsxs(l,{direction:"column",gap:"2",children:[e.jsxs(k,{children:[e.jsx(ze,{htmlFor:"subject",isRequired:!0,children:"Subject"}),e.jsx(xs,z({},x("subject",{required:"Subject is required"})))]}),(j==null?void 0:j.subject)&&e.jsx(Me,{children:(O=j.subject)==null?void 0:O.message})]})}),e.jsxs(l,{gap:"2",children:[e.jsx(k,{width:"100%",children:e.jsxs(l,{direction:"column",gap:"2",children:[e.jsxs(k,{width:"100%",children:[e.jsx(ze,{htmlFor:"duration",isRequired:!0,children:"Duration"}),e.jsx(Os,{name:"duration",rules:{required:"Duration is required"},control:o,render:({field:w})=>e.jsxs(ie,{value:w.value,name:w.name,required:!0,onValueChange:w.onChange,children:[e.jsx(re,{onBlur:w.onBlur,className:"w-full"}),e.jsxs(le,{children:[e.jsx(N,{value:"15",children:"15 minutes"}),e.jsx(N,{value:"30",children:"30 minutes"}),e.jsx(N,{value:"60",children:"1 hour"}),e.jsx(N,{value:"120",children:"2 hours"})]})]})})]}),(j==null?void 0:j.duration)&&e.jsx(Me,{children:(R=j.duration)==null?void 0:R.message})]})}),e.jsx(k,{width:"100%",children:e.jsxs(l,{direction:"column",gap:"2",children:[e.jsx(wn,{name:"google_calendar",label:"Google Calendar",required:!0,dropdownClass:"sm:w-[255px] w-[10rem]",rules:{required:"Calendar is required"},filters:[["enable","=",1],["user","=",r]],doctype:"Google Calendar"}),e.jsx(Me,{children:(T=d.formState.errors.google_calendar)==null?void 0:T.message})]})})]}),e.jsxs(k,{width:"100%",children:[e.jsxs(ze,{htmlFor:"description",children:["Description ",e.jsx(h,{as:"span",size:"1",color:"gray",children:" (Optional)"})]}),e.jsx(xs,z({},x("description"))),(j==null?void 0:j.description)&&e.jsx(Me,{children:(D=j.description)==null?void 0:D.message})]})]}),e.jsxs(l,{gap:"3",mt:"6",justify:"end",align:"center",children:[e.jsx(Qe,{disabled:v,children:e.jsx(y,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsxs(y,{type:"submit",disabled:v,children:[v&&e.jsx(I,{className:"text-white"}),v?"Creating":"Create"]})]})]})}))},yi=({isOpen:s,setOpen:n,channelData:i})=>A()?e.jsx(H,{open:s,onOpenChange:n,children:e.jsx(Y,{className:V,children:e.jsx(Ns,{channelData:i,onClose:()=>n(!1)})})}):e.jsx(E,{open:s,onOpenChange:n,children:e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(Ns,{channelData:i,onClose:()=>n(!1)})})})}),Fe="16",nn=({channelData:s})=>{const{channelID:n}=xe(),{currentUser:i}=u.useContext(je),{channelMembers:r}=Re(s.name),[t,{on:c},d]=ae(!1),[o,{on:a},x]=ae(!1),[p,{on:j,off:_}]=ae(!1),[v,{on:b},M]=ae(!1),[C,{on:S},L]=ae(!1),O=u.useMemo(()=>s.type==="Open"||s.is_archived===1||s.is_direct_message===1?!1:!!r[i],[s,r,i]);return e.jsxs(e.Fragment,{children:[e.jsxs(Vs,{children:[e.jsx(Es,{children:e.jsx(Le,{color:"gray",className:"bg-transparent text-gray-12 hover:bg-gray-3",children:e.jsx(Nn,{})})}),e.jsxs(qs,{className:"min-w-48",children:[e.jsx(ce,{onClick:S,children:e.jsxs(l,{gap:"2",align:"center",children:[e.jsx(kn,{size:Fe}),"Start a Meeting"]})}),e.jsx(ce,{onClick:j,children:e.jsxs(l,{gap:"2",align:"center",children:[e.jsx(Ge,{size:Fe}),"Search"]})}),e.jsx(ce,{onClick:c,children:e.jsxs(l,{gap:"2",align:"center",children:[e.jsx(Sn,{size:Fe}),"View Files"]})}),s.is_direct_message===0&&e.jsxs(e.Fragment,{children:[e.jsx(Fn,{}),O&&e.jsx(ce,{onClick:a,children:e.jsxs(l,{gap:"2",align:"center",children:[e.jsx(Mn,{size:Fe}),"Add Members"]})}),e.jsx(ce,{onClick:b,children:e.jsxs(l,{gap:"2",align:"center",children:[e.jsx(fi,{size:Fe}),"Channel Settings"]})})]})]})]}),e.jsx(ei,{open:t,setOpen:d}),e.jsx(si,{open:o,setOpen:x}),e.jsx(ri,{isOpen:p,onClose:_,tabIndex:0,input:"",inFilter:n}),e.jsx(vi,{open:v,setOpen:M,channelData:s}),e.jsx(yi,{isOpen:C,setOpen:L,channelData:s})]})},bi=({channelData:s})=>{const{channelMembers:n}=Re(s.name),i=Object.keys(n).length,r=Math.min(i-3,9);return e.jsxs("div",{className:"flex items-center -space-x-1 rtl:space-x-reverse animate-fadein",children:[Object.entries(n).map(([t,c],d)=>{var o,a;if(d<3)return e.jsx(he,{src:(o=c.user_image)!=null?o:void 0,alt:(a=c.full_name)!=null?a:c.name,radius:"full",variant:"solid",className:"border border-gray-2"},t)}),i>3&&e.jsx("span",{className:"inline-block",children:e.jsx(zn,{fallback:`${r}+`,size:"1",variant:"soft",color:"gray",radius:"full",className:"border border-slate-4 text-[10px]"})})]})};function Ci(s){return Gs({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"m289.94 256 95-95A24 24 0 0 0 351 127l-95 95-95-95a24 24 0 0 0-34 34l95 95-95 95a24 24 0 1 0 34 34l95-95 95 95a24 24 0 0 0 34-34z"},child:[]}]})(s)}const _i=({onClose:s})=>{var t;const{channelID:n}=xe(),{data:i,error:r}=_e("raven.api.raven_message.get_pinned_messages",{channel_id:n},void 0,{revalidateOnFocus:!1});return e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsxs(l,{justify:"between",align:"center",children:[e.jsx(h,{children:"Pinned Messages"}),e.jsx(Le,{variant:"ghost",color:"gray","aria-label":"Close",onClick:s,children:e.jsx(Ci,{size:"20"})})]})}),e.jsx(B,{error:r}),e.jsx(l,{direction:"column",gap:"3",justify:"start",children:(t=i==null?void 0:i.message)==null?void 0:t.map(c=>e.jsx(Qs,{message:c},c.name))})]})},wi=({pinnedMessagesString:s})=>{const n=s?s.split(`
`).length:0,[i,r]=u.useState(!1),t=()=>{r(!1)};return n?e.jsxs(H,{open:i,onOpenChange:r,children:[e.jsx(Be,{children:e.jsxs(y,{size:"1",variant:"soft",color:"gray","aria-label":"View pinned messages",title:"View pinned messages",children:[e.jsx(On,{size:"14"}),n]})}),e.jsx(Y,{className:V,children:e.jsx(_i,{onClose:t})})]}):null},Ni=({channelData:s})=>{var i;const n=localStorage.getItem("ravenLastWorkspace");return e.jsxs(Ks,{children:[e.jsxs(l,{align:"center",children:[e.jsx(Ws,{to:`/${n}`,className:"block bg-transparent hover:bg-transparent active:bg-transparent sm:hidden",children:e.jsx(Js,{size:"24",className:"block text-gray-12"})}),e.jsxs(l,{gap:"4",align:"center",className:"group animate-fadein pr-4",children:[e.jsxs(l,{gap:"1",align:"center",children:[e.jsx(Q,{type:s.type,size:"18"}),e.jsx(Hs,{size:{initial:"4",sm:"5"},className:"mb-0.5 text-ellipsis line-clamp-1",children:s.channel_name})]}),e.jsx(en,{channelID:s.name,channel_name:s.channel_name,channelType:s.type,disabled:s.is_archived==1,buttonVisible:!!s.pinned_messages_string}),e.jsx(wi,{pinnedMessagesString:(i=s.pinned_messages_string)!=null?i:""})]})]}),e.jsxs(l,{gap:"2",align:"center",className:"animate-fadein",children:[e.jsx(bi,{channelData:s}),e.jsx(nn,{channelData:s})]})]})},ki=({channelData:s})=>e.jsxs(k,{children:[e.jsx(Ni,{channelData:s}),e.jsx(Ds,{channelData:s})]}),Si=({channelData:s})=>{var v;const{currentUser:n}=u.useContext(je),{channelMembers:i}=Re(s.name),r=s.peer_user_id,t=An(s.peer_user_id),{isBot:c,fullName:d,userImage:o}=u.useMemo(()=>{var C,S;const b=i==null?void 0:i[r],M=(b==null?void 0:b.type)==="Bot";return{fullName:(C=b==null?void 0:b.full_name)!=null?C:r,userImage:(S=b==null?void 0:b.user_image)!=null?S:"",isBot:M}},[i,r]),a=is(r),x=Jn(r),p=(v=d!=null?d:r)!=null?v:Ln(s.channel_name,n),j=A(),_=localStorage.getItem("ravenLastWorkspace");return e.jsxs(Ks,{children:[e.jsxs(l,{gap:"3",align:"center",children:[e.jsx(Ws,{to:`/${_}`,className:"block bg-transparent hover:bg-transparent active:bg-transparent sm:hidden",children:e.jsx(Js,{size:"24",className:"block text-gray-12"})}),e.jsx(he,{alt:p,src:o,isActive:t,availabilityStatus:a==null?void 0:a.availability_status,skeletonSize:"6",isBot:c,size:j?"2":"1"},r),e.jsx(Hs,{size:{initial:"4",sm:"5"},children:e.jsxs("div",{className:"flex items-center gap-2",children:[p,!a&&e.jsx(Se,{color:"gray",variant:"soft",children:"Deleted"}),(a==null?void 0:a.enabled)===0&&e.jsx(Se,{color:"gray",variant:"soft",children:"Disabled"}),(a==null?void 0:a.custom_status)&&e.jsx(Se,{color:"gray",className:"font-semibold px-1.5 py-0.5",children:a.custom_status}),x&&e.jsx(Se,{color:"yellow",variant:"surface",children:"On Leave"}),c&&e.jsx(Se,{color:"gray",className:"font-semibold px-1.5 py-0.5",children:"Bot"})]})})]}),e.jsx(l,{gap:"4",align:"center",children:e.jsx(nn,{channelData:s})})]})},Fi=({channelData:s})=>e.jsxs(k,{children:[e.jsx(Si,{channelData:s}),e.jsx(Ds,{channelData:s})]}),Mi=()=>{const{channelID:s}=xe();return e.jsx("div",{className:"scroll-smooth",children:s&&e.jsx(zi,{channelID:s})})},Hi=Mi,zi=({channelID:s})=>{const{threadID:n}=xe(),i=Fs(),{channel:r,error:t,isLoading:c}=Ys(s),{mutate:d,cache:o}=Ce(),[a]=Pn(),x=a.get("message_id");return u.useEffect(()=>{localStorage.setItem("ravenLastChannel",s);const p=o.get("unread_channel_count");p!=null&&p.data&&(x||d("unread_channel_count",j=>j&&{message:j.message.map(v=>v.name===s?G(z({},v),{unread_count:0}):v)},{revalidate:!1}))},[s,x]),e.jsxs(es,{columns:n&&!i?"2":"1",gap:"2",rows:"repeat(2, 64px)",width:"auto",className:"dark:bg-gray-2 bg-white h-screen",children:[n&&i?null:e.jsxs(k,{children:[c&&e.jsx(Tn,{}),e.jsx(B,{error:t}),r?r.type==="dm"?e.jsx(Fi,{channelData:r.channelData}):e.jsx(ki,{channelData:r.channelData}):null]}),e.jsx(Bn,{})]})};export{Hi as Component};
