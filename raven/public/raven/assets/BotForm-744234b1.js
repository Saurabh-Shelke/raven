var W=Object.defineProperty,L=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var T=(t,n,s)=>n in t?W(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,x=(t,n)=>{for(var s in n||(n={}))q.call(n,s)&&T(t,s,n[s]);if(z)for(var s of z(n))P.call(n,s)&&T(t,s,n[s]);return t},v=(t,n)=>L(t,V(n));import{aN as k,j as e,S as a,p as w,L as A,b as O,d as F,bd as H,i as u,at as j,aT as b,aW as _,aM as f,J as I,a3 as N,bD as B,x as R,aO as Y,r as G,n as J,bE as K,f as D,g as $,am as U,an as Q,o as M,ap as X,aY as Z,bF as ee,af as se,aC as ne,q as ae,aR as te,bG as C,bi as ie,bj as re,bk as m,D as oe,bH as ce,bI as le,bJ as de,bK as he,bn as p}from"./index-81db420b.js";import{I as xe}from"./InstructionField-5664444b.js";import{u as ue}from"./useRavenSettings-a6b6461e.js";import{A as je}from"./AINotEnabledCallout-6cdcef2f.js";import{C as y}from"./CodeBlock-5fc83e57.js";const me=()=>{var c,l;const{register:t,control:n,formState:{errors:s}}=k(),{ravenSettings:o}=ue();return e.jsxs(a,{gap:"4",children:[e.jsxs(a,{maxWidth:"480px",children:[e.jsxs(w,{children:[e.jsx(A,{htmlFor:"bot_name",isRequired:!0,children:"Name"}),e.jsx(O,v(x({id:"bot_name"},t("bot_name",{required:"Name is required"})),{autoFocus:!0,placeholder:"accounts-bot","aria-invalid":s.bot_name?"true":"false"}))]}),s.bot_name&&e.jsx(F,{children:(c=s.bot_name)==null?void 0:c.message})]}),e.jsxs(a,{children:[e.jsxs(w,{children:[e.jsx(A,{htmlFor:"description",children:"Description"}),e.jsx(H,v(x({id:"description"},t("description")),{rows:5,resize:"vertical",placeholder:"A bot to handle accounts","aria-invalid":s.description?"true":"false"}))]}),s.description&&e.jsx(F,{children:(l=s.description)==null?void 0:l.message})]}),e.jsx(je,{}),e.jsxs(a,{maxWidth:"480px",children:[e.jsx(u,{as:"label",size:"2",children:e.jsxs(j,{children:[e.jsx(b,{control:n,disabled:!(o!=null&&o.enable_ai_integration),name:"is_ai_bot",render:({field:r})=>e.jsx(_,{checked:!!r.value,disabled:r.disabled,onCheckedChange:i=>r.onChange(i?1:0)})}),"Is AI Agent"]})}),e.jsx(f,{children:"Check to enable AI features for this bot"})]})]})},pe=t=>{var r;const{register:n,control:s,formState:{errors:o},watch:c}=k();c("is_ai_bot");const l=c("openai_assistant_id");return e.jsxs(a,{gap:"4",children:[e.jsxs(a,{maxWidth:"480px",children:[e.jsxs(w,{hidden:!l,children:[e.jsx(A,{htmlFor:"openai_assistant_id",children:"OpenAI Assistant ID"}),e.jsx(O,v(x({id:"openai_assistant_id"},n("openai_assistant_id")),{readOnly:!0,placeholder:"asst_*******************","aria-invalid":o.openai_assistant_id?"true":"false"}))]}),o.openai_assistant_id&&e.jsx(F,{children:(r=o.openai_assistant_id)==null?void 0:r.message})]}),e.jsxs(a,{maxWidth:"480px",children:[e.jsx(u,{as:"label",size:"2",children:e.jsxs(j,{children:[e.jsx(b,{control:s,name:"allow_bot_to_write_documents",render:({field:i})=>e.jsx(_,{checked:!!i.value,onCheckedChange:h=>i.onChange(h?1:0)})}),"Allow Agent to Write Documents"]})}),e.jsx(f,{children:"Checking this will allow the bot to create/update/delete documents in the system."})]}),e.jsx(I,{className:"w-full"}),e.jsxs(a,{maxWidth:"560px",children:[e.jsx(u,{as:"label",size:"2",children:e.jsxs(j,{align:"center",children:[e.jsx(b,{control:s,name:"enable_file_search",render:({field:i})=>e.jsx(_,{checked:!!i.value,onCheckedChange:h=>i.onChange(h?1:0)})}),e.jsx("span",{children:"Enable File Search"}),e.jsx(N,{content:"View OpenAI documentation about File Search",children:e.jsx("a",{href:"https://platform.openai.com/docs/assistants/tools/file-search",title:"View OpenAI documentation about File Search","aria-label":"View OpenAI documentation about File Search",target:"_blank",className:"text-gray-11 -mb-1",children:e.jsx(B,{size:16})})})]})}),e.jsxs(f,{children:["Enable this if you want the bot to be able to read PDF files and scan them.",e.jsx("br",{}),e.jsx("br",{}),"File search enables the assistant with knowledge from files that you upload.",e.jsx("br",{}),e.jsx("br",{}),"Once a file is uploaded, the assistant automatically decides when to retrieve content based on user requests."]})]}),e.jsx(I,{className:"w-full"}),e.jsxs(a,{maxWidth:"560px",children:[e.jsx(u,{as:"label",size:"2",children:e.jsxs(j,{align:"center",children:[e.jsx(b,{control:s,name:"enable_code_interpreter",render:({field:i})=>e.jsx(_,{checked:!!i.value,onCheckedChange:h=>i.onChange(h?1:0)})}),e.jsx("span",{children:"Enable Code Interpreter"}),e.jsx(N,{content:"View OpenAI documentation about Code Interpreter",children:e.jsx("a",{href:"https://platform.openai.com/docs/assistants/tools/code-interpreter",title:"View OpenAI documentation about Code Interpreter","aria-label":"View OpenAI documentation about Code Interpreter",target:"_blank",className:"text-gray-11 -mb-1",children:e.jsx(B,{size:16})})})]})}),e.jsxs(f,{children:["Enable this if you want the bot to be able to process files like Excel sheets or data from Insights.",e.jsx("br",{}),"OpenAI Assistants run code in a sandboxed environment (on OpenAI servers) to do this."]})]}),e.jsx(I,{className:"w-full"}),e.jsx(R,{as:"h5",size:"2",className:"not-cal",weight:"medium",children:"Advanced"}),e.jsxs(a,{maxWidth:"560px",children:[e.jsx(u,{as:"label",size:"2",children:e.jsxs(j,{align:"center",children:[e.jsx(b,{control:s,name:"debug_mode",render:({field:i})=>e.jsx(_,{checked:!!i.value,onCheckedChange:h=>i.onChange(h?1:0)})}),e.jsx("span",{children:"Enable Debug Mode"})]})}),e.jsxs(f,{children:["If enabled, stack traces of errors will be sent as messages by the bot during runs.",e.jsx("br",{}),"This is helpful when you're testing your bots and want to know where things are going wrong."]})]})]})},ge=t=>{var S;const{control:n}=k(),{fields:s,append:o,remove:c}=Y({control:n,name:"bot_functions"}),{call:l}=G.useContext(J),[r,i]=K.useState(""),h=()=>{r&&l.get("frappe.client.get_value",{doctype:"Raven AI Function",filters:{name:r},fieldname:["type","description"]}).then(d=>{o({function:r,type:d.message.type,description:d.message.description}),i("")})};return e.jsxs(a,{gap:"4",children:[e.jsxs(j,{justify:"between",align:"center",children:[e.jsxs(u,{color:"gray",size:"2",children:["Add functions that the bot can use to create or update documents in the system.",e.jsx("br",{}),"Create functions in the ",e.jsx(D,{asChild:!0,children:e.jsx($,{to:"/settings/functions",children:"function builder"})})," and then add them here."]}),e.jsx(w,{children:e.jsxs(U,{children:[e.jsx(Q,{children:e.jsx(M,{size:"2",variant:"soft",children:"Add Function"})}),e.jsx(X,{width:"380px",className:"relative overflow-visible",children:e.jsxs(a,{children:[e.jsx(Z,{doctype:"Raven AI Function",value:r,filters:[["name","not in",(S=s.map(d=>d.function))!=null?S:[]]],dropdownClass:"sm:w-[350px]",label:"Function",setValue:i}),e.jsx(j,{justify:"end",children:e.jsx(ee,{children:e.jsx(M,{type:"button",onClick:h,children:"Add"})})})]})})]})})]}),e.jsx(a,{children:s==null?void 0:s.map((d,E)=>e.jsx(se,{size:"2",children:e.jsxs(j,{justify:"between",align:"center",children:[e.jsxs(a,{gap:"1",children:[e.jsxs(j,{gap:"2",align:"center",children:[e.jsx(D,{asChild:!0,size:"2",weight:"bold",className:"text-gray-12",children:e.jsx($,{to:`/settings/functions/${d.function}`,children:d.function})}),e.jsx(ne,{color:"purple",children:d.type})]}),e.jsx(u,{as:"div",size:"2",color:"gray",children:d.description})]}),e.jsx(ae,{size:"2",color:"red",variant:"ghost",type:"button",title:"Remove","aria-label":"Remove",mr:"1",onClick:()=>c(E),children:e.jsx(te,{size:"16"})})]})},d.id))})]})},be=()=>{const{getValues:t}=k(),n=t("name"),s=n.replace(/-/g,"_"),o=({children:r})=>e.jsx(R,{as:"h3",size:"3",className:"not-cal",weight:"medium",children:r}),c=({children:r})=>e.jsx(u,{as:"p",size:"2",color:"gray",children:r}),l={sendMessage:`${s} = frappe.get_doc("Raven Bot", "${n}")

# Send a message to a channel. Text can be in HTML format.
${s}.send_message(channel_id="channel-name", text="This is a test message.")`,sendMessageInMarkdown:`${s}.send_message(
        channel_id="channel-name", 
        text="This is a test message.", 
        markdown=True
    )`,sendMessageWithDocumentLink:`${s}.send_message(
            channel_id="channel-name", 
            text="This is a test message.", 
            link_doctype="DocType",
            link_document="Document Name"
        )`,sendDirectMessage:`${s}.send_direct_message(
            user_id="john.doe@example.com", 
            text="This is a test message."
        )`};return e.jsxs(a,{gap:"3",pt:"2",children:[e.jsx(u,{as:"p",size:"3",children:"The following code samples show how to use the bot/agent in a Frappe app or Server Script."}),e.jsxs(a,{gap:"0",children:[e.jsxs(a,{gap:"1",children:[e.jsx(o,{children:"Sending a message to a channel"}),e.jsx(c,{children:"Bots can be used to send messages to channels with HTML formatted content."})]}),e.jsx(y,{code:l.sendMessage})]}),e.jsxs(a,{gap:"0",children:[e.jsxs(a,{gap:"1",children:[e.jsx(o,{children:"Sending a message to a channel in markdown format"}),e.jsxs(c,{children:["You can send markdown formatted text to a channel by setting the ",e.jsx(C,{children:"markdown"})," parameter to True."]})]}),e.jsx(y,{code:l.sendMessageInMarkdown})]}),e.jsxs(a,{gap:"0",children:[e.jsxs(a,{gap:"1",children:[e.jsx(o,{children:"Sending a message with a document link"}),e.jsxs(c,{children:["You can send a message with a link to any document in the system by setting the ",e.jsx(C,{children:"link_doctype"})," and ",e.jsx(C,{children:"link_document"})," parameters."]})]}),e.jsx(y,{code:l.sendMessageWithDocumentLink})]}),e.jsxs(a,{gap:"0",children:[e.jsxs(a,{gap:"1",children:[e.jsx(o,{children:"Sending a direct message to a user"}),e.jsxs(c,{children:["You can send a direct message to a user by calling the ",e.jsx(C,{children:"send_direct_message"})," method and setting the user_id parameter. This method also accepts markdown and document link parameters."]})]}),e.jsx(y,{code:l.sendDirectMessage})]})]})},g={size:18,className:"mr-1.5"},ye=({isEdit:t})=>{const{watch:n}=k(),s=!!n("is_ai_bot");return e.jsxs(ie,{defaultValue:"general",children:[e.jsxs(re,{children:[e.jsxs(m,{value:"general",children:[e.jsx(oe,x({},g))," General"]}),s?e.jsxs(m,{value:"ai",children:[e.jsx(ce,x({},g))," AI"]}):null,s?e.jsxs(m,{value:"instructions",children:[e.jsx(le,x({},g))," Instructions"]}):null,s?e.jsxs(m,{value:"functions",children:[e.jsx(de,x({},g))," Functions"]}):null,t?e.jsxs(m,{value:"api-docs",children:[e.jsx(he,x({},g))," API Docs"]}):null]}),e.jsxs(w,{pt:"4",children:[e.jsx(p,{value:"general",children:e.jsx(me,{})}),e.jsx(p,{value:"ai",children:e.jsx(pe,{})}),e.jsx(p,{value:"instructions",children:e.jsx(xe,{allowUsingTemplate:!0,instructionRequired:!!s})}),e.jsx(p,{value:"functions",children:e.jsx(ge,{})}),e.jsx(p,{value:"api-docs",children:e.jsx(be,{})})]})]})};export{ye as B};
