var X=Object.defineProperty,D=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var z=(s,i,r)=>i in s?X(s,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[i]=r,_=(s,i)=>{for(var r in i||(i={}))S.call(i,r)&&z(s,r,i[r]);if(w)for(var r of w(i))N.call(i,r)&&z(s,r,i[r]);return s},f=(s,i)=>D(s,ee(i));var A=(s,i)=>{var r={};for(var n in s)S.call(s,n)&&i.indexOf(n)<0&&(r[n]=s[n]);if(s!=null&&w)for(var n of w(s))i.indexOf(n)<0&&N.call(s,n)&&(r[n]=s[n]);return r};import{u as U,ad as se,j as e,ae as B,aq as O,_ as h,a as d,E as L,p as v,L as re,bd as ie,i as l,d as I,au as $,o as u,e as C,$ as P,r as x,M as G,a2 as R,a4 as Y,a6 as V,a7 as ne,dw as W,dx as H,dy as q,aG as te,bg as oe,aZ as de,c as ce,b7 as K,ar as le,aT as ae,K as M,W as me,U as Z,x as J,b$ as he,cT as ue,dA as xe,el as E,a0 as pe,aC as je,em as ge,f as be}from"./index-81db420b.js";import{u as Q}from"./useCurrentChannelData-5d20df6c.js";import{u as _e}from"./useGetUserRecords-beb6efeb.js";const F=({channelData:s,onClose:i})=>{var b;const r=U({defaultValues:{channel_description:s==null?void 0:s.channel_description}}),{register:n,handleSubmit:o,formState:{errors:t}}=r,{updateDoc:c,loading:m,error:j}=se(),g=p=>{var a;c("Raven Channel",(a=s==null?void 0:s.name)!=null?a:null,{channel_description:p.channel_description}).then(()=>{P.success(h("Channel description updated")),i()})};return e.jsx(B,f(_({},r),{children:e.jsxs("form",{onSubmit:o(g),children:[e.jsx(O,{children:s&&(s!=null&&s.channel_description)&&(s==null?void 0:s.channel_description.length)>0?h("Edit description"):h("Add description")}),e.jsxs(d,{gap:"2",direction:"column",width:"100%",children:[e.jsx(L,{error:j}),e.jsxs(v,{width:"100%",children:[e.jsx(re,{htmlFor:"channel_description",children:h("Channel description")}),e.jsx(ie,f(_({maxLength:140,id:"channel_description",placeholder:h("Add description")},n("channel_description",{maxLength:{value:140,message:h("Channel description cannot be more than 200 characters.")}})),{"aria-invalid":t.channel_description?"true":"false"})),e.jsx(l,{size:"1",weight:"light",children:h("This is how people will know what this channel is about.")}),(t==null?void 0:t.channel_description)&&e.jsx(I,{children:(b=t.channel_description)==null?void 0:b.message})]})]}),e.jsxs(d,{gap:"3",mt:"6",justify:"end",align:"center",children:[e.jsx($,{disabled:m,children:e.jsx(u,{variant:"soft",color:"gray",children:h("Cancel")})}),e.jsxs(u,{type:"submit",disabled:m,children:[m&&e.jsx(C,{className:"text-white"}),m?h("Saving"):h("Save")]})]})]})}))},fe=({channelData:s,is_in_box:i})=>{const[r,n]=x.useState(!1),o=()=>{n(!1)},t=s&&s.channel_description&&s.channel_description.length>0?"Edit":"Add";return G()?e.jsxs(R,{open:r,onOpenChange:n,children:[e.jsx(Y,{children:e.jsxs(u,{variant:"ghost",size:"1",children:[t," ",i?"":"description"]})}),e.jsx(V,{className:ne,children:e.jsx(F,{channelData:s,onClose:o})})]}):e.jsxs(W,{open:r,onOpenChange:n,children:[e.jsx(H,{asChild:!0,children:e.jsxs(u,{variant:"ghost",size:"1",children:[t," ",i?"":"description"]})}),e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-48 px-1 overflow-auto",children:e.jsx(F,{channelData:s,onClose:o})})})]})},ye=x.lazy(()=>te(()=>import("./AddMembersDropdown-88e80609.js"),["assets/AddMembersDropdown-88e80609.js","assets/index-81db420b.js","assets/index-27ae9ec0.css","assets/MultipleUserCombobox-3792d0b5.js","assets/WorkspaceMemberManagement-60867905.js","assets/index-a6c096df.js","assets/TableLoader-47d8c4ae.js","assets/Skeleton-9de30e70.js","assets/useGetUserRecords-beb6efeb.js","assets/useCurrentChannelData-5d20df6c.js","assets/index-a9edd0f4.js","assets/useRavenSettings-a6b6461e.js","assets/preferences-0e1c8796.js","assets/DoctypeLinkRenderer-5c845fcf.js","assets/useDoctypeMeta-749cfb81.js","assets/useDebounce-02f398f3.js","assets/useCurrentChannelData-b08321ce.css"])),T=({onClose:s})=>{var p;const{channelID:i}=oe(),{channel:r}=Q(i!=null?i:""),{mutate:n}=de(),{call:o,error:t,loading:c}=ce("raven.api.raven_channel_member.add_channel_members"),m=U({defaultValues:{add_members:null}}),{handleSubmit:j,control:g}=m,b=a=>{a.add_members&&a.add_members.length>0&&o({channel_id:i,members:a.add_members.map(y=>y.name)}).then(()=>{P.success("Members added"),n(["channel_members",i]),s()})};return e.jsx(e.Fragment,{children:i&&r&&e.jsx(B,f(_({},m),{children:e.jsxs("form",{onSubmit:j(b),children:[e.jsx(O,{children:e.jsxs(l,{as:"span",children:["Add members to ",e.jsx(K,{type:r==null?void 0:r.channelData.type,size:"18",className:"inline-block -mb-0.5"}),r==null?void 0:r.channelData.channel_name]})}),e.jsxs(le,{size:"2",children:["New members will be able to see all of ",e.jsx("strong",{children:r==null?void 0:r.channelData.channel_name}),"'s history, including any files that have been shared in the channel."]}),e.jsxs(d,{gap:"2",pt:"2",direction:"column",width:"100%",children:[e.jsx(L,{error:t}),e.jsx(l,{size:"2",children:"You can only add members from your workspace to this channel."}),e.jsx(v,{width:"100%",children:e.jsx(d,{direction:"column",gap:"2",children:e.jsxs(d,{direction:"column",gap:"2",children:[e.jsx(x.Suspense,{fallback:e.jsx(C,{}),children:e.jsx(ae,{control:g,name:"add_members",rules:{validate:a=>a&&a.length>0?!0:"Please select at least one member"},render:({field:{onChange:a,value:y}})=>{var k;return e.jsx(ye,{setSelectedUsers:a,workspaceID:(k=r==null?void 0:r.channelData.workspace)!=null?k:"",selectedUsers:y!=null?y:[],channelID:i,label:""})}})}),e.jsx(I,{children:(p=m.formState.errors.add_members)==null?void 0:p.message})]})})})]}),e.jsxs(d,{gap:"3",mt:"6",justify:"end",align:"center",children:[e.jsx($,{disabled:c,children:e.jsx(u,{variant:"soft",color:"gray",children:"Cancel"})}),e.jsxs(u,{type:"submit",disabled:c,children:[c&&e.jsx(C,{className:"text-white"}),c?"Saving":"Save"]})]})]})}))})},we=r=>{var n=r,{channelData:s}=n,i=A(n,["channelData"]);const[o,t]=x.useState(!1),c=()=>{t(!1)};return G()?e.jsxs(R,{open:o,onOpenChange:t,children:[e.jsx(Y,{children:e.jsx(u,f(_({variant:"ghost",size:"1"},i),{className:M("text-nowrap",i.className),children:"Add Members"}))}),e.jsx(V,{className:"static",children:e.jsx(T,{onClose:c})})]}):e.jsxs(W,{open:o,onOpenChange:t,children:[e.jsx(H,{asChild:!0,children:e.jsx(u,f(_({variant:"ghost",size:"1"},i),{className:M("text-nowrap",i.className),children:"Add Members"}))}),e.jsx(q,{children:e.jsx("div",{className:"pb-16 min-h-96 px-1 overflow-auto",children:e.jsx(T,{onClose:c})})})]})},ve=s=>{var t;const{data:i,error:r,isLoading:n,mutate:o}=me("raven.api.chat.get_channel_members",{channel_id:s},["channel_members",s],{keepPreviousData:!0,dedupingInterval:3e5});return{channelMembers:(t=i==null?void 0:i.message)!=null?t:{},error:r,isLoading:n,mutate:o}},Me=()=>e.jsx(d,{justify:"center",align:"center",className:"w-full h-64",children:e.jsxs(d,{direction:"column",gap:"1",className:"text-center",children:[e.jsx(l,{weight:"bold",size:"5",children:"Nothing turned up"}),e.jsx(l,{as:"span",size:"2",children:"You may want to try using different keywords, checking for typos or adjusting your filters."}),e.jsxs(l,{as:"span",size:"2",children:["Not the results that you expected? File an issue on ",e.jsx(be,{href:"https://github.com/The-Commit-Company/Raven",target:"_blank",rel:"noreferrer",children:e.jsx(l,{color:"blue",size:"2",children:"GitHub"})}),"."]})]})}),Ce=({channelData:s})=>{var t;const{channelMembers:i}=ve(s.name),{currentUser:r}=x.useContext(Z),n=_e(),{isAdmin:o}=x.useMemo(()=>{const c=i[r];return{isAdmin:(c==null?void 0:c.is_admin)==1}},[i,r]);return e.jsxs(d,{direction:"column",className:"p-2",gap:"2",children:[e.jsxs(d,{direction:"column",gap:"2",children:[e.jsxs(d,{align:"center",gap:"1",children:[e.jsx(K,{type:s==null?void 0:s.type}),e.jsx(J,{size:"4",children:s==null?void 0:s.channel_name})]}),e.jsxs(l,{size:"2",children:[(t=n[s.owner])==null?void 0:t.full_name," created this channel on ",e.jsx(he,{date:s==null?void 0:s.creation}),". This is the very beginning of the ",e.jsx("strong",{children:s==null?void 0:s.channel_name})," channel."]}),(s==null?void 0:s.channel_description)&&e.jsx(l,{size:"1",color:"gray",children:s==null?void 0:s.channel_description})]}),(s==null?void 0:s.is_archived)==0&&o&&e.jsxs(d,{gap:"4",className:"z-1",children:[e.jsx(fe,{channelData:s}),(s==null?void 0:s.type)!=="Open"&&e.jsx(we,{channelData:s})]})]})},ke=({channelData:s})=>{var g;const{currentUser:i}=x.useContext(Z),r=s.peer_user_id,n=ue(r),{fullName:o,userImage:t,isBot:c}=x.useMemo(()=>{var p,a;const b=(n==null?void 0:n.type)==="Bot";return{fullName:(p=n==null?void 0:n.full_name)!=null?p:r,userImage:(a=n==null?void 0:n.user_image)!=null?a:"",isBot:b}},[n,r]),m=xe(r),j=(g=o!=null?o:r)!=null?g:E(s.channel_name,i);return e.jsx(v,{className:"p-2",children:(s==null?void 0:s.is_direct_message)==1&&e.jsxs(d,{direction:"column",gap:"3",children:[e.jsxs(d,{gap:"3",align:"center",children:[e.jsx(pe,{alt:j,src:t,size:"3",skeletonSize:"7",isBot:c,availabilityStatus:n==null?void 0:n.availability_status,isActive:m}),e.jsxs(d,{direction:"column",gap:"0",children:[e.jsx(J,{size:"4",children:j}),e.jsx("div",{children:c?e.jsx(je,{color:"gray",className:"py-0 px-1",children:"Bot"}):e.jsx(l,{size:"1",color:"gray",children:r})})]})]}),(s==null?void 0:s.is_self_message)==1?e.jsxs(d,{direction:"column",gap:"0",children:[e.jsxs(l,{size:"2",children:[e.jsx("strong",{children:"This space is all yours."})," Draft messages, list your to-dos, or keep links and files handy. "]}),e.jsx(l,{size:"2",children:"And if you ever feel like talking to yourself, don't worry, we won't judge - just remember to bring your own banter to the table."})]}):e.jsx(d,{gap:"2",align:"center",children:r||o?e.jsxs(l,{size:"2",children:["This is a Direct Message channel between you and ",e.jsx("strong",{children:o!=null?o:r}),"."]}):e.jsxs(l,{size:"2",children:["We could not find the user for this DM channel (",E(s.channel_name,i),")."]})})]})})},Ee=()=>e.jsx(v,{className:"py-2 px-6",children:e.jsxs(d,{direction:"column",gap:"2",children:[e.jsx(l,{size:"3",children:e.jsx("strong",{children:"Your saved messages will appear here"})}),e.jsxs(d,{direction:"column",gap:"1",children:[e.jsx(l,{size:"2",as:"span",children:"Saved messages are a convenient way to keep track of important information or messages you want to refer back to later."}),e.jsxs(l,{size:"2",as:"span",children:["You can save messages by simply clicking on the bookmark icon ",e.jsx(ge,{className:"-mb-0.5"})," in message actions."]})]})]})}),Fe=({channelID:s})=>{const{channel:i}=Q(s);return i?i.type==="dm"?e.jsx(ke,{channelData:i.channelData}):e.jsx(Ce,{channelData:i.channelData}):null};export{T as A,Fe as C,Ee as E,Me as a,fe as b,we as c,ve as u};
