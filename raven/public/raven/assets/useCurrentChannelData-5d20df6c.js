var Ys=Object.defineProperty,qs=Object.defineProperties;var Gs=Object.getOwnPropertyDescriptors;var st=Object.getOwnPropertySymbols;var or=Object.prototype.hasOwnProperty,ir=Object.prototype.propertyIsEnumerable;var sr=(e,t,n)=>t in e?Ys(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,j=(e,t)=>{for(var n in t||(t={}))or.call(t,n)&&sr(e,n,t[n]);if(st)for(var n of st(t))ir.call(t,n)&&sr(e,n,t[n]);return e},N=(e,t)=>qs(e,Gs(t));var ue=(e,t)=>{var n={};for(var r in e)or.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&st)for(var r of st(e))t.indexOf(r)<0&&ir.call(e,r)&&(n[r]=e[r]);return n};var $e=(e,t,n)=>new Promise((r,s)=>{var o=c=>{try{a(n.next(c))}catch(d){s(d)}},i=c=>{try{a(n.throw(c))}catch(d){s(d)}},a=c=>c.done?r(c.value):Promise.resolve(c.value).then(o,i);a((n=n.apply(e,t)).next())});import{d0 as Qs,$ as D,G as Js,W as De,c as et,j as l,d1 as W,a as w,d2 as ft,ac as ye,r as C,a3 as Ie,q as Te,K as O,d3 as zr,b9 as En,bg as tt,d4 as Xs,d5 as Zs,cJ as eo,d6 as to,bs as no,d7 as ro,d8 as so,i as A,U as nt,d9 as oo,da as Dr,db as io,dc as ot,ch as lo,dd as Rn,de as Gt,df as ao,dg as co,c0 as Ir,br as uo,n as rt,dh as ho,di as fo,dj as po,dk as mo,bu as Pr,f as xe,aG as Br,am as go,an as xo,bt as bo,p as z,ap as yo,a7 as Qt,e as wo,aZ as vo,aD as Co,dl as jo,dm as ko,dn as Jt,dp as Ao,dq as To,a2 as Mn,a6 as Ln,dr as $r,aq as _n,ar as Fr,ds as On,o as be,au as Ur,dt as Wr,M as Xt,du as Vr,t as Kr,a4 as Yr,dv as No,dw as So,J as Hn,dx as Eo,dy as Ro,E as qr,b0 as Mo,cT as Zt,a0 as zn,dz as Lo,aC as xt,be as _o,bf as Oo,aW as Ho,dA as Gr,bv as Dn,bw as In,by as Pn,ai as Qr,dB as Jr,g as Xr,dC as lr,dD as zo,dE as ar,S as Re,at as Do,dF as Io,dG as Po,dH as Bo,dI as $o,af as Zr,dJ as Fo,cg as Uo,dK as Wo,cf as Vo,dL as es,dM as ts,dN as ns,dO as rs,dP as Ko,dQ as Yo,cU as qo,a1 as Go,dR as Qo,dS as Jo,cF as Xo}from"./index-81db420b.js";import{u as Zo}from"./useGetUserRecords-beb6efeb.js";import{M as Bn,m as F,d as ei,e as ss,B as ti,N as en,P as Pe,f as ae,h as ni,i as ri,k as si,l as oi,n as ii,o as Ne,q as li,D as bt,r as yt,s as ai,v as ge,w as ci,y as di,T as ke,F as le,z as Ae,A as ui,G as hi,H as fi,I as pi,J as mi,R as wt,K as os,L as gi,c as xi,x as bi,a as yi,j as wi,t as vi,b as Ci,p as ji,g as ki,u as Ai,S as Ti,C as Ni,O as Si,Q as Ei,E as Ri}from"./index-a9edd0f4.js";import{u as Mi}from"./useRavenSettings-a6b6461e.js";import{Q as Li}from"./preferences-0e1c8796.js";import{D as is}from"./DoctypeLinkRenderer-5c845fcf.js";import{u as ls}from"./useDebounce-02f398f3.js";const _i=Qs;function Oi(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])}return e}function pn(e,t){return Array(t+1).join(e)}function Hi(e){return e.replace(/^\n*/,"")}function zi(e){for(var t=e.length;t>0&&e[t-1]===`
`;)t--;return e.substring(0,t)}var Di=["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","BODY","CANVAS","CENTER","DD","DIR","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","FRAMESET","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","HTML","ISINDEX","LI","MAIN","MENU","NAV","NOFRAMES","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TBODY","TD","TFOOT","TH","THEAD","TR","UL"];function $n(e){return Fn(e,Di)}var as=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];function cs(e){return Fn(e,as)}function Ii(e){return us(e,as)}var ds=["A","TABLE","THEAD","TBODY","TFOOT","TH","TD","IFRAME","SCRIPT","AUDIO","VIDEO"];function Pi(e){return Fn(e,ds)}function Bi(e){return us(e,ds)}function Fn(e,t){return t.indexOf(e.nodeName)>=0}function us(e,t){return e.getElementsByTagName&&t.some(function(n){return e.getElementsByTagName(n).length})}var K={};K.paragraph={filter:"p",replacement:function(e){return`

`+e+`

`}};K.lineBreak={filter:"br",replacement:function(e,t,n){return n.br+`
`}};K.heading={filter:["h1","h2","h3","h4","h5","h6"],replacement:function(e,t,n){var r=Number(t.nodeName.charAt(1));if(n.headingStyle==="setext"&&r<3){var s=pn(r===1?"=":"-",e.length);return`

`+e+`
`+s+`

`}else return`

`+pn("#",r)+" "+e+`

`}};K.blockquote={filter:"blockquote",replacement:function(e){return e=e.replace(/^\n+|\n+$/g,""),e=e.replace(/^/gm,"> "),`

`+e+`

`}};K.list={filter:["ul","ol"],replacement:function(e,t){var n=t.parentNode;return n.nodeName==="LI"&&n.lastElementChild===t?`
`+e:`

`+e+`

`}};K.listItem={filter:"li",replacement:function(e,t,n){e=e.replace(/^\n+/,"").replace(/\n+$/,`
`).replace(/\n/gm,`
    `);var r=n.bulletListMarker+"   ",s=t.parentNode;if(s.nodeName==="OL"){var o=s.getAttribute("start"),i=Array.prototype.indexOf.call(s.children,t);r=(o?Number(o)+i:i+1)+".  "}return r+e+(t.nextSibling&&!/\n$/.test(e)?`
`:"")}};K.indentedCodeBlock={filter:function(e,t){return t.codeBlockStyle==="indented"&&e.nodeName==="PRE"&&e.firstChild&&e.firstChild.nodeName==="CODE"},replacement:function(e,t,n){return`

    `+t.firstChild.textContent.replace(/\n/g,`
    `)+`

`}};K.fencedCodeBlock={filter:function(e,t){return t.codeBlockStyle==="fenced"&&e.nodeName==="PRE"&&e.firstChild&&e.firstChild.nodeName==="CODE"},replacement:function(e,t,n){for(var r=t.firstChild.getAttribute("class")||"",s=(r.match(/language-(\S+)/)||[null,""])[1],o=t.firstChild.textContent,i=n.fence.charAt(0),a=3,c=new RegExp("^"+i+"{3,}","gm"),d;d=c.exec(o);)d[0].length>=a&&(a=d[0].length+1);var u=pn(i,a);return`

`+u+s+`
`+o.replace(/\n$/,"")+`
`+u+`

`}};K.horizontalRule={filter:"hr",replacement:function(e,t,n){return`

`+n.hr+`

`}};K.inlineLink={filter:function(e,t){return t.linkStyle==="inlined"&&e.nodeName==="A"&&e.getAttribute("href")},replacement:function(e,t){var n=t.getAttribute("href");n&&(n=n.replace(/([()])/g,"\\$1"));var r=vt(t.getAttribute("title"));return r&&(r=' "'+r.replace(/"/g,'\\"')+'"'),"["+e+"]("+n+r+")"}};K.referenceLink={filter:function(e,t){return t.linkStyle==="referenced"&&e.nodeName==="A"&&e.getAttribute("href")},replacement:function(e,t,n){var r=t.getAttribute("href"),s=vt(t.getAttribute("title"));s&&(s=' "'+s+'"');var o,i;switch(n.linkReferenceStyle){case"collapsed":o="["+e+"][]",i="["+e+"]: "+r+s;break;case"shortcut":o="["+e+"]",i="["+e+"]: "+r+s;break;default:var a=this.references.length+1;o="["+e+"]["+a+"]",i="["+a+"]: "+r+s}return this.references.push(i),o},references:[],append:function(e){var t="";return this.references.length&&(t=`

`+this.references.join(`
`)+`

`,this.references=[]),t}};K.emphasis={filter:["em","i"],replacement:function(e,t,n){return e.trim()?n.emDelimiter+e+n.emDelimiter:""}};K.strong={filter:["strong","b"],replacement:function(e,t,n){return e.trim()?n.strongDelimiter+e+n.strongDelimiter:""}};K.code={filter:function(e){var t=e.previousSibling||e.nextSibling,n=e.parentNode.nodeName==="PRE"&&!t;return e.nodeName==="CODE"&&!n},replacement:function(e){if(!e)return"";e=e.replace(/\r?\n|\r/g," ");for(var t=/^`|^ .*?[^ ].* $|`$/.test(e)?" ":"",n="`",r=e.match(/`+/gm)||[];r.indexOf(n)!==-1;)n=n+"`";return n+t+e+t+n}};K.image={filter:"img",replacement:function(e,t){var n=vt(t.getAttribute("alt")),r=t.getAttribute("src")||"",s=vt(t.getAttribute("title")),o=s?' "'+s+'"':"";return r?"!["+n+"]("+r+o+")":""}};function vt(e){return e?e.replace(/(\n+\s*)+/g,`
`):""}function hs(e){this.options=e,this._keep=[],this._remove=[],this.blankRule={replacement:e.blankReplacement},this.keepReplacement=e.keepReplacement,this.defaultRule={replacement:e.defaultReplacement},this.array=[];for(var t in e.rules)this.array.push(e.rules[t])}hs.prototype={add:function(e,t){this.array.unshift(t)},keep:function(e){this._keep.unshift({filter:e,replacement:this.keepReplacement})},remove:function(e){this._remove.unshift({filter:e,replacement:function(){return""}})},forNode:function(e){if(e.isBlank)return this.blankRule;var t;return(t=rn(this.array,e,this.options))||(t=rn(this._keep,e,this.options))||(t=rn(this._remove,e,this.options))?t:this.defaultRule},forEach:function(e){for(var t=0;t<this.array.length;t++)e(this.array[t],t)}};function rn(e,t,n){for(var r=0;r<e.length;r++){var s=e[r];if($i(s,t,n))return s}}function $i(e,t,n){var r=e.filter;if(typeof r=="string"){if(r===t.nodeName.toLowerCase())return!0}else if(Array.isArray(r)){if(r.indexOf(t.nodeName.toLowerCase())>-1)return!0}else if(typeof r=="function"){if(r.call(e,t,n))return!0}else throw new TypeError("`filter` needs to be a string, array, or function")}function Fi(e){var t=e.element,n=e.isBlock,r=e.isVoid,s=e.isPre||function(h){return h.nodeName==="PRE"};if(!(!t.firstChild||s(t))){for(var o=null,i=!1,a=null,c=cr(a,t,s);c!==t;){if(c.nodeType===3||c.nodeType===4){var d=c.data.replace(/[ \r\n\t]+/g," ");if((!o||/ $/.test(o.data))&&!i&&d[0]===" "&&(d=d.substr(1)),!d){c=sn(c);continue}c.data=d,o=c}else if(c.nodeType===1)n(c)||c.nodeName==="BR"?(o&&(o.data=o.data.replace(/ $/,"")),o=null,i=!1):r(c)||s(c)?(o=null,i=!0):o&&(i=!1);else{c=sn(c);continue}var u=cr(a,c,s);a=c,c=u}o&&(o.data=o.data.replace(/ $/,""),o.data||sn(o))}}function sn(e){var t=e.nextSibling||e.parentNode;return e.parentNode.removeChild(e),t}function cr(e,t,n){return e&&e.parentNode===t||n(t)?t.nextSibling||t.parentNode:t.firstChild||t.nextSibling||t.parentNode}var Un=typeof window!="undefined"?window:{};function Ui(){var e=Un.DOMParser,t=!1;try{new e().parseFromString("","text/html")&&(t=!0)}catch(n){}return t}function Wi(){var e=function(){};return Vi()?e.prototype.parseFromString=function(t){var n=new window.ActiveXObject("htmlfile");return n.designMode="on",n.open(),n.write(t),n.close(),n}:e.prototype.parseFromString=function(t){var n=document.implementation.createHTMLDocument("");return n.open(),n.write(t),n.close(),n},e}function Vi(){var e=!1;try{document.implementation.createHTMLDocument("").open()}catch(t){Un.ActiveXObject&&(e=!0)}return e}var Ki=Ui()?Un.DOMParser:Wi();function Yi(e,t){var n;if(typeof e=="string"){var r=qi().parseFromString('<x-turndown id="turndown-root">'+e+"</x-turndown>","text/html");n=r.getElementById("turndown-root")}else n=e.cloneNode(!0);return Fi({element:n,isBlock:$n,isVoid:cs,isPre:t.preformattedCode?Gi:null}),n}var on;function qi(){return on=on||new Ki,on}function Gi(e){return e.nodeName==="PRE"||e.nodeName==="CODE"}function Qi(e,t){return e.isBlock=$n(e),e.isCode=e.nodeName==="CODE"||e.parentNode.isCode,e.isBlank=Ji(e),e.flankingWhitespace=Xi(e,t),e}function Ji(e){return!cs(e)&&!Pi(e)&&/^\s*$/i.test(e.textContent)&&!Ii(e)&&!Bi(e)}function Xi(e,t){if(e.isBlock||t.preformattedCode&&e.isCode)return{leading:"",trailing:""};var n=Zi(e.textContent);return n.leadingAscii&&dr("left",e,t)&&(n.leading=n.leadingNonAscii),n.trailingAscii&&dr("right",e,t)&&(n.trailing=n.trailingNonAscii),{leading:n.leading,trailing:n.trailing}}function Zi(e){var t=e.match(/^(([ \t\r\n]*)(\s*))(?:(?=\S)[\s\S]*\S)?((\s*?)([ \t\r\n]*))$/);return{leading:t[1],leadingAscii:t[2],leadingNonAscii:t[3],trailing:t[4],trailingNonAscii:t[5],trailingAscii:t[6]}}function dr(e,t,n){var r,s,o;return e==="left"?(r=t.previousSibling,s=/ $/):(r=t.nextSibling,s=/^ /),r&&(r.nodeType===3?o=s.test(r.nodeValue):n.preformattedCode&&r.nodeName==="CODE"?o=!1:r.nodeType===1&&!$n(r)&&(o=s.test(r.textContent))),o}var el=Array.prototype.reduce,tl=[[/\\/g,"\\\\"],[/\*/g,"\\*"],[/^-/g,"\\-"],[/^\+ /g,"\\+ "],[/^(=+)/g,"\\$1"],[/^(#{1,6}) /g,"\\$1 "],[/`/g,"\\`"],[/^~~~/g,"\\~~~"],[/\[/g,"\\["],[/\]/g,"\\]"],[/^>/g,"\\>"],[/_/g,"\\_"],[/^(\d+)\. /g,"$1\\. "]];function Ct(e){if(!(this instanceof Ct))return new Ct(e);var t={rules:K,headingStyle:"setext",hr:"* * *",bulletListMarker:"*",codeBlockStyle:"indented",fence:"```",emDelimiter:"_",strongDelimiter:"**",linkStyle:"inlined",linkReferenceStyle:"full",br:"  ",preformattedCode:!1,blankReplacement:function(n,r){return r.isBlock?`

`:""},keepReplacement:function(n,r){return r.isBlock?`

`+r.outerHTML+`

`:r.outerHTML},defaultReplacement:function(n,r){return r.isBlock?`

`+n+`

`:n}};this.options=Oi({},t,e),this.rules=new hs(this.options)}Ct.prototype={turndown:function(e){if(!sl(e))throw new TypeError(e+" is not a string, or an element/document/fragment node.");if(e==="")return"";var t=fs.call(this,new Yi(e,this.options));return nl.call(this,t)},use:function(e){if(Array.isArray(e))for(var t=0;t<e.length;t++)this.use(e[t]);else if(typeof e=="function")e(this);else throw new TypeError("plugin must be a Function or an Array of Functions");return this},addRule:function(e,t){return this.rules.add(e,t),this},keep:function(e){return this.rules.keep(e),this},remove:function(e){return this.rules.remove(e),this},escape:function(e){return tl.reduce(function(t,n){return t.replace(n[0],n[1])},e)}};function fs(e){var t=this;return el.call(e.childNodes,function(n,r){r=new Qi(r,t.options);var s="";return r.nodeType===3?s=r.isCode?r.nodeValue:t.escape(r.nodeValue):r.nodeType===1&&(s=rl.call(t,r)),ps(n,s)},"")}function nl(e){var t=this;return this.rules.forEach(function(n){typeof n.append=="function"&&(e=ps(e,n.append(t.options)))}),e.replace(/^[\t\r\n]+/,"").replace(/[\t\r\n\s]+$/,"")}function rl(e){var t=this.rules.forNode(e),n=fs.call(this,e),r=e.flankingWhitespace;return(r.leading||r.trailing)&&(n=n.trim()),r.leading+t.replacement(n,e,this.options)+r.trailing}function ps(e,t){var n=zi(e),r=Hi(t),s=Math.max(e.length-n.length,t.length-r.length),o=`

`.substring(0,s);return n+o+r}function sl(e){return e!=null&&(typeof e=="string"||e.nodeType&&(e.nodeType===1||e.nodeType===9||e.nodeType===11))}const ol=e=>()=>{if(e)if(e.message_type==="Text"){let s=e.text.replace(/^\s*[\r\n]/gm,"");var n=new Ct({codeBlockStyle:"fenced"});n.addRule("links",{filter:"a",replacement:function(o,i,a){var c;return(c=i.textContent)!=null?c:o}});var r=n.turndown(s);r?(navigator.clipboard.writeText(r),D.success("Text copied to clipboard")):D.error("Could not copy text")}else(e.message_type==="Image"||e.message_type==="File")&&(e.file.startsWith("http")||e.file.startsWith("https")?navigator.clipboard.writeText(e.file):navigator.clipboard.writeText(window.location.origin+e.file),D.success("Link copied"))};function il(e){return Js({tag:"svg",attr:{version:"1.2",baseProfile:"tiny",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M19.164 19.547c-1.641-2.5-3.669-3.285-6.164-3.484v1.437c0 .534-.208 1.036-.586 1.414-.756.756-2.077.751-2.823.005l-6.293-6.207c-.191-.189-.298-.444-.298-.713s.107-.524.298-.712l6.288-6.203c.754-.755 2.073-.756 2.829.001.377.378.585.88.585 1.414v1.704c4.619.933 8 4.997 8 9.796v1c0 .442-.29.832-.714.958-.095.027-.19.042-.286.042-.331 0-.646-.165-.836-.452zm-7.141-5.536c2.207.056 4.638.394 6.758 2.121-.768-3.216-3.477-5.702-6.893-6.08-.504-.056-.888-.052-.888-.052v-3.497l-5.576 5.496 5.576 5.5v-3.499l1.023.011z"},child:[]}]})(e)}const ll=({message:e})=>{var s,o;const{data:t}=De("raven.api.raven_poll.get_poll",{message_id:e==null?void 0:e.name},`poll_data_${e==null?void 0:e.poll_id}`,{revalidateOnFocus:!1,revalidateOnReconnect:!1}),{call:n}=et("raven.api.raven_poll.retract_vote"),r=()=>n({poll_id:e==null?void 0:e.poll_id}).then(()=>{D("Vote retracted")}).catch(i=>{D.error("Could not retract vote",{description:ye(i)})});return t&&((s=t.message)==null?void 0:s.current_user_votes.length)>0?l.jsxs(l.Fragment,{children:[l.jsx(W,{onClick:r,disabled:!!((o=t.message)!=null&&o.poll.is_disabled),children:l.jsxs(w,{gap:"2",children:[l.jsx(il,{size:"18"}),"Retract vote"]})}),l.jsx(ft,{})]}):null},Wn="bg-gray-2 dark:bg-gray-2 hover:bg-gray-4 dark:hover:bg-gray-5 text-gray-12 hover:text-gray-12",Ue=C.forwardRef((s,r)=>{var o=s,{className:e,tooltip:t}=o,n=ue(o,["className","tooltip"]);return l.jsx(Ie,{content:t,children:l.jsx(Te,j({size:"2",className:O(Wn,e),ref:r},n))})}),ms=e=>{const t=En(),{workspaceID:n}=tt(),{call:r}=et("raven.api.threads.create_thread");return()=>{r({message_id:e}).then(o=>{D.success("Thread created successfully!"),t(`/${n}/${o.message.channel_id}/thread/${o.message.thread_id}`)}).catch(()=>{D.error("Failed to create thread")})}},al=({messageID:e})=>{const t=ms(e);return l.jsx(Ue,{tooltip:"Create a thread","aria-label":"Create a thread",onClick:t,children:l.jsx(zr,{size:"16"})})},cl=({messageID:e})=>{const t=ms(e);return l.jsx(W,{children:l.jsxs(w,{gap:"2",align:"center",width:"100%",onClick:t,children:[l.jsx(zr,{size:"18"}),"Create Thread"]})})},dl=e=>l.jsxs(Xs,{children:[l.jsx(Zs,{children:l.jsxs(w,{gap:"2",align:"center",children:[l.jsx(eo,{size:"18"}),"Actions"]})}),l.jsx(to,{children:l.jsx(ul,j({},e))})]}),ul=e=>{const{data:t}=no("Raven Message Action",{fields:["name","action_name"],filters:[["enabled","=",1]],orderBy:{field:"action",order:"asc"}},void 0,{revalidateOnFocus:!1}),n=ro(so);return l.jsx(l.Fragment,{children:t&&t.length>0?t==null?void 0:t.map(r=>l.jsx(W,{onClick:()=>n({actionID:r.name,messageID:e.messageID}),children:l.jsx(A,{size:"2",weight:"medium",children:r.action_name})},r.name)):l.jsx(W,{disabled:!0,children:"No Actions Available"})})},gs=({message:e,onDelete:t,onEdit:n,onReply:r,onForward:s,showThreadButton:o,onAttachDocument:i,onViewReaction:a})=>{var f;const c=ol(e),{currentUser:d}=C.useContext(nt),u=d===(e==null?void 0:e.owner)&&!(e!=null&&e.is_bot_message),h=Object.keys(JSON.parse((f=e==null?void 0:e.message_reactions)!=null?f:"{}")).length!==0;return l.jsx(oo,{children:e?l.jsxs(l.Fragment,{children:[e&&e.message_type==="Poll"&&l.jsx(ll,{message:e}),l.jsx(W,{children:l.jsxs(w,{gap:"2",width:"100%",onClick:r,children:[l.jsx(Dr,{size:"18"}),"Reply"]})}),l.jsx(W,{children:l.jsxs(w,{gap:"2",width:"100%",onClick:s,children:[l.jsx(io,{size:"18"}),"Forward"]})}),e&&!e.is_thread&&o&&l.jsx(cl,{messageID:e.name}),l.jsx(hl,{message:e}),l.jsx(ft,{}),l.jsxs(ot,{children:[e.message_type==="Text"&&l.jsx(W,{children:l.jsxs(w,{gap:"2",width:"100%",onClick:c,children:[l.jsx(lo,{size:"18"}),"Copy"]})}),["File","Image"].includes(e.message_type)&&l.jsxs(ot,{children:[l.jsx(W,{children:l.jsxs(w,{gap:"2",width:"100%",onClick:c,children:[l.jsx(Rn,{size:"18"}),"Copy link"]})}),l.jsx(W,{asChild:!0,children:l.jsx("a",{download:!0,href:e.file,children:l.jsxs(w,{gap:"2",children:[l.jsx(Gt,{size:"18"}),"Download"]})})}),l.jsx(W,{children:l.jsxs(w,{gap:"2",width:"100%",onClick:i,children:[l.jsx(ao,{size:"18"}),"Attach File to Document"]})})]}),o&&l.jsx(pl,{message:e}),l.jsx(fl,{message:e})]}),h&&l.jsxs(ot,{children:[l.jsx(ft,{}),l.jsx(W,{children:l.jsxs(w,{gap:"2",width:"100%",onClick:a,children:[l.jsx(co,{size:"18"}),"View Reactions"]})})]}),l.jsx(dl,{messageID:e.name}),u&&l.jsxs(ot,{children:[l.jsx(ft,{}),e.message_type==="Text"&&l.jsx(W,{children:l.jsxs(w,{gap:"2",width:"100%",onClick:n,children:[l.jsx(Ir,{size:"18"}),"Edit"]})}),l.jsx(W,{color:"red",children:l.jsxs(w,{gap:"2",width:"100%",onClick:t,children:[l.jsx(uo,{size:"18"}),"Delete"]})})]})]}):null})},hl=({message:e})=>{const{workspaceID:t,threadID:n}=tt(),r=()=>{let s="raven";window.location.origin.endsWith("/")||(s="/"+s),n===e.channel_id?navigator.clipboard.writeText(`${window.location.origin}${s}/${t}/threads/${n}?message_id=${e.name}`):navigator.clipboard.writeText(`${window.location.origin}${s}/${t}/${e.channel_id}?message_id=${e.name}`),D.success("Message link copied to clipboard")};return l.jsx(W,{children:l.jsxs(w,{gap:"2",width:"100%",onClick:r,children:[l.jsx(Rn,{size:"18"}),"Copy Message Link"]})})},fl=({message:e})=>{const{currentUser:t}=C.useContext(nt),n=JSON.parse(e._liked_by?e._liked_by:"[]").includes(t),{call:r}=C.useContext(rt),s=()=>{r.post("raven.api.raven_message.save_message",{message_id:e.name,add:n?"No":"Yes"}).then(()=>{n?D("Message unsaved"):D.success("Message saved")}).catch(o=>{D.error("Could not perform the action",{description:ye(o)})})};return l.jsx(W,{children:l.jsxs(w,{gap:"2",width:"100%",onClick:s,children:[!n&&l.jsx(ho,{size:"18"}),n&&l.jsx(fo,{size:"18"}),n?"Unsave":"Save"," Message"]})})},pl=({message:e})=>{const t=e.is_pinned,{call:n}=C.useContext(rt),r=()=>{n.post("raven.api.raven_channel.toggle_pin_message",{channel_id:e.channel_id,message_id:e.name}).then(()=>{D.success(`Message ${t?"unpinned":"pinned"}`)}).catch(s=>{D.error("Could not perform the action",{description:ye(s)})})};return l.jsx(W,{children:l.jsxs(w,{gap:"2",width:"100%",onClick:r,children:[t?l.jsx(mo,{size:"18"}):l.jsx(po,{size:"18"}),t?"Unpin":"Pin"]})})},mn=({timestamp:e,timeFormat:t="hh:mm A"})=>{const{tooltipContent:n,time:r}=C.useMemo(()=>{const s=Pr(e);return{tooltipContent:s.format("Do MMMM [at] hh:mm A"),time:s.format(t)}},[e,t]);return l.jsx(Ie,{content:n,children:l.jsx(xe,{asChild:!0,size:"1",color:"gray",children:l.jsx("span",{children:r})})})},ml=({timestamp:e})=>{const{tooltipContent:t,time:n}=C.useMemo(()=>{const r=Pr(e);return{tooltipContent:r.format("Do MMMM [at] hh:mm A"),time:r.format("hh:mm")}},[e]);return l.jsx(Ie,{content:t,children:l.jsx(xe,{asChild:!0,style:{fontSize:"0.68rem"},color:"gray",className:"tabular-nums",children:l.jsx("span",{children:n})})})},gl=C.lazy(()=>Br(()=>import("./EmojiPicker-289a24eb.js"),["assets/EmojiPicker-289a24eb.js","assets/index-81db420b.js","assets/index-27ae9ec0.css","assets/AddCustomEmojiDialog-15ed8490.js"])),xs=({saveReaction:e,isOpen:t,setIsOpen:n,iconButtonProps:r,iconSize:s="18"})=>{const o=()=>{n(!1)},i=(a,c,d)=>{e(a,c,d),o()};return l.jsx(go,{open:t,onOpenChange:n,children:l.jsxs(w,{children:[l.jsx(Ie,{content:"Add reaction",children:l.jsx(xo,{children:l.jsx(Te,N(j({variant:"soft",size:"2",color:"gray","aria-label":"pick emoji"},r),{className:O(Wn,r==null?void 0:r.className),children:l.jsx(bo,{size:s})}))})}),l.jsx(_i,{children:l.jsx(z,{className:"z-10",children:l.jsx(yo,{className:`${Qt} p-0`,children:l.jsx(C.Suspense,{fallback:l.jsx(wo,{}),children:l.jsx(gl,{onSelect:i})})})})})]})})},bs=()=>{const{call:e}=C.useContext(rt),{mutate:t}=vo(),{name:n}=Co();return C.useCallback((s,o,i=!1,a)=>{const c=d=>{var f,p,m;const h=((f=d==null?void 0:d.message.messages)!=null?f:[]).map(b=>{var y;if(b.name!==s.name)return b;const g=JSON.parse((y=b.message_reactions)!=null?y:"{}");return g[o]?g[o].count>1?(g[o].users=g[o].users.filter(E=>E!==n),g[o].count=g[o].count-1):delete g[o]:g[o]={reaction:o,users:[n],count:1,emoji_name:a!=null?a:""},N(j({},b),{message_reactions:JSON.stringify(g)})});return{message:{has_new_messages:(p=d==null?void 0:d.message.has_new_messages)!=null?p:!1,has_old_messages:(m=d==null?void 0:d.message.has_old_messages)!=null?m:!0,messages:h}}};return t({path:`get_messages_for_channel_${s.channel_id}`},d=>$e(void 0,null,function*(){return e.post("raven.api.reactions.react",{message_id:s.name,reaction:o,is_custom:i,emoji_name:a}).then(()=>c(d))}),{optimisticData:d=>c(d),rollbackOnError:!0,revalidate:!1})},[])},ys=({message:e,message_reactions:t})=>{const{currentUser:n}=C.useContext(nt),r=bs(),s=C.useCallback((a,c=!1,d)=>{e&&r(e,a,c,d).catch(u=>{D.error("Could not react to message.",{description:ye(u)})})},[e]),o=Zo(),i=C.useMemo(()=>{const a=JSON.parse(t!=null?t:"{}");return Object.entries(a).map(([c,d])=>N(j({},d),{emoji_name:c}))},[t]);return i.length===0?null:l.jsxs(w,{gap:"1",mt:"1",wrap:"wrap",children:[i.map(a=>l.jsx(bl,{reaction:a,onReactionClick:s,currentUser:n,allUsers:o},a.reaction)),l.jsx(xl,{saveReaction:s})]})},xl=({saveReaction:e})=>{const[t,n]=C.useState(!1);return l.jsx(xs,{saveReaction:e,isOpen:t,setIsOpen:n,iconButtonProps:{size:"1",className:"bg-gray-3 dark:bg-gray-5 py-0.5 w-[3ch] text-gray-10 dark:text-gray-11 h-full rounded-md",variant:"soft",color:"gray"},iconSize:"15"})},bl=({reaction:e,onReactionClick:t,currentUser:n,allUsers:r})=>{const{reaction:s,users:o,count:i,emoji_name:a}=e,c=C.useCallback(()=>{t(s,e.is_custom,a)},[t,s]),{label:d,currentUserReacted:u}=C.useMemo(()=>({label:`${jo(o,i,n,r)} reacted with ${a}`,currentUserReacted:o.includes(n)}),[r,i,n,e,o]);return l.jsx(Ie,{content:l.jsx("span",{className:"my-0 max-w-96",children:d}),children:l.jsx("button",{onClick:c,className:O("w-fit sm:h-full text-xs py-0.5 cursor-pointer rounded-md min-w-[4ch] border font-semibold",u?"bg-blue-50 border-blue-500 dark:border-gray-9 dark:bg-gray-7 sm:dark:hover:bg-gray-7":"bg-gray-3 border-gray-3 sm:hover:bg-gray-2 sm:hover:border-gray-8 dark:bg-gray-5 sm:dark:hover:bg-gray-5 sm:dark:hover:border-gray-9"),children:l.jsxs(A,{as:"span",className:O("flex items-center gap-1 min-w-[3ch] tabular-nums h-[1.2rem] text-gray-12",u?"text-blue-800 dark:text-gray-12":"text-gray-12"),children:[e.is_custom?l.jsx("img",{src:s,alt:s,loading:"lazy",className:"w-[1.1rem] h-[1.1rem] object-contain object-center"}):l.jsx("span",{className:"-mb-1 w-[1.1rem] h-[1.1rem]",children:l.jsx("em-emoji",{native:s,set:"apple",size:"1.2em"})}),i]})})})},yl=C.lazy(()=>Br(()=>import("./ImageViewer-594dbe79.js"),["assets/ImageViewer-594dbe79.js","assets/index-81db420b.js","assets/index-27ae9ec0.css"])),wl=C.memo(({message:e,isScrolling:t=!1,user:n})=>{var p;const[r,s]=C.useState(!1),o=ko(),i=Jt(e.file),[a,c]=C.useState(!0),{height:d,width:u}=C.useMemo(()=>{if(!a)return{height:"0",width:"0"};let m="200",b="300";return e.thumbnail_height&&(m=String(o?e.thumbnail_height/2:e.thumbnail_height)),e.thumbnail_width&&(b=String(o?e.thumbnail_width/2:e.thumbnail_width)),{height:m,width:b}},[e.thumbnail_height,e.thumbnail_width,o,a]),h=C.useRef(null),f=()=>{c(!0),setTimeout(()=>{h.current&&h.current.scrollIntoView({behavior:"smooth",block:"center"})},200)};return l.jsxs(w,{direction:"column",gap:"1",children:[l.jsxs(w,{className:"py-1 items-center",children:[l.jsx(Te,{size:"1",variant:"ghost",color:"gray",radius:"large",className:"pl-0 pr-[6px] font-bold hover:bg-transparent text-accent-a11 hover:text-gray-12","aria-label":`Click to ${a?"hide":"show"} image`,title:`${a?"Hide":"Show"} image`,onClick:()=>a?c(!1):f(),children:a?l.jsx(Ao,{size:"20",className:"pt-[1px]"}):l.jsx(To,{size:"20",className:"pt-[1px]"})}),l.jsx(xe,{href:e.file,size:"1",color:"gray",target:"_blank",children:i})]}),l.jsxs(z,{ref:h,className:"relative rounded-md cursor-pointer transition-all duration-300 ease-ease-out-circ overflow-hidden",role:"button",onClick:()=>s(!t&&!0),style:{height:d+"px",width:u+"px"},children:[l.jsx(z,{className:" absolute top-0 z-0 left-0",style:{height:d+"px",width:u+"px"},children:l.jsx(z,{style:{height:d+"px",width:u+"px"},className:"bg-gray-3 z-0 dark:bg-gray-5 rounded-md"})}),l.jsx("img",{src:e.file,loading:"lazy",className:"z-50 absolute top-0 left-0 rounded-md shadow-md object-cover",height:d,style:{maxHeight:d+"px",maxWidth:u+"px",minHeight:d+"px",minWidth:u+"px"},width:u,alt:`Image file sent by ${e.owner} at ${e.creation}`,onContextMenu:m=>{m.stopPropagation()}})]}),!t&&l.jsx(Mn,{open:r,onOpenChange:s,children:l.jsxs(Ln,{className:O(Qt,"sm:max-w-[88vw]",o&&"fixed inset-0 w-full h-full max-w-none p-0 rounded-none bg-black overflow-hidden"),children:[o&&l.jsx(Te,{size:"3",variant:"ghost",color:"gray",className:"fixed top-4 right-4 z-10 text-white",onClick:()=>s(!1),children:l.jsx($r,{size:"24"})}),l.jsx(_n,{size:"3",className:"h-0 invisible sm:h-auto sm:visible",children:i}),l.jsxs(Fr,{color:"gray",size:"1",className:"h-0 invisible sm:h-auto sm:visible",children:[(p=n==null?void 0:n.full_name)!=null?p:e.owner," on ",l.jsx(On,{date:e.creation})]}),l.jsx(z,{className:O("w-full mx-auto items-center flex justify-center",o?"h-[100dvh] absolute inset-0":"my-4"),children:l.jsx(C.Suspense,{fallback:l.jsx("img",{src:e.file,loading:"lazy",width:"100%",className:O("object-contain",o?"h-[100dvh] w-full":"rounded-md shadow-md max-h-[90vh] sm:max-h-[600px]"),alt:`Image file sent by ${e.owner} at ${e.creation}`}),children:l.jsx(yl,{children:l.jsx("img",{src:e.file,loading:"lazy",width:"100%",className:O("object-contain",o?"h-[100dvh] w-full":"rounded-md shadow-md max-h-[90vh] sm:max-h-[600px]"),alt:`Image file sent by ${e.owner} at ${e.creation}`})})})}),!o&&l.jsxs(w,{justify:"end",gap:"2",mt:"3",children:[l.jsx(be,{variant:"soft",color:"gray",asChild:!0,children:l.jsxs(xe,{className:"no-underline",href:e.file,download:!0,children:[l.jsx(Gt,{}),"Download"]})}),l.jsx(Ur,{children:l.jsx(be,{color:"gray",variant:"soft",children:"Close"})})]})]})})]})}),vl=C.memo(r=>{var s=r,{message:e,user:t}=s,n=ue(s,["message","user"]);var f;const o=(f=e.file)==null?void 0:f.split("?")[0],i=Wr(o),a=Jt(o),c=No(i),d=i==="pdf",u=()=>{o.startsWith("http")||o.startsWith("https")?navigator.clipboard.writeText(o):navigator.clipboard.writeText(window.location.origin+o),D.success("Link copied")},h=Xt();return l.jsx(z,N(j({},n),{children:c?l.jsxs(w,{gap:"2",direction:"column",children:[l.jsx(xe,{href:e.file,size:"1",download:!0,title:"Download",color:"gray",target:"_blank",children:a}),l.jsx("video",{src:e.file,controls:!0,className:"rounded-md shadow-md max-h-96 max-w-[620px]"})]}):l.jsxs(w,{align:"center",gap:"4",p:"4",className:"border bg-gray-1 dark:bg-gray-3 rounded-md border-gray-4 dark:border-gray-6 w-fit",children:[l.jsxs(w,{align:"center",gap:"2",children:[l.jsx(Vr,{ext:i}),l.jsx(A,{as:"span",size:"2",className:"text-ellipsis overflow-hidden line-clamp-1",children:a})]}),l.jsxs(w,{align:"center",gap:"2",children:[d&&h&&l.jsx(Cl,{message:e,user:t}),l.jsx(Te,{size:{md:"1",sm:"2"},title:"Copy link",color:"gray",onClick:u,variant:"soft",children:l.jsx(Rn,{className:"text-lg sm:text-base"})}),l.jsx(Te,{size:{md:"1",sm:"2"},asChild:!0,title:"Download",color:"gray",variant:"soft",children:l.jsx(xe,{className:"no-underline",href:e.file,download:!0,children:h?l.jsx(Gt,{className:"text-lg sm:text-base"}):l.jsx(Kr,{className:"text-lg sm:text-base"})})})]})]})}))}),Cl=({message:e,user:t})=>{var r;const n=Jt(e.file);return l.jsx(z,{children:l.jsxs(Mn,{children:[l.jsx(Yr,{children:l.jsx(Te,{size:{md:"1",sm:"2"},color:"gray",variant:"soft",title:"Preview",children:l.jsx(Kr,{className:"text-lg sm:text-base"})})}),l.jsxs(Ln,{className:O(Qt,"min-w-[64rem]"),size:"4",children:[l.jsx(_n,{size:"3",children:n}),l.jsxs(Fr,{color:"gray",size:"1",children:[(r=t==null?void 0:t.full_name)!=null?r:e.owner," on ",l.jsx(On,{date:e.creation})]}),l.jsx(z,{my:"4",children:l.jsx("embed",{src:e.file,type:"application/pdf",width:"100%",height:"680px"})}),l.jsxs(w,{justify:"end",gap:"2",mt:"3",children:[l.jsx(be,{variant:"soft",color:"gray",asChild:!0,children:l.jsxs(xe,{className:"no-underline",href:e.file,download:!0,children:[l.jsx(Gt,{size:"18"}),"Download"]})}),l.jsx(Ur,{children:l.jsx(be,{color:"gray",variant:"soft",children:"Close"})})]})]})]})})},jl=({poll:e})=>{const[t,n]=C.useState(!1),r=()=>{n(!1)};return Xt()?l.jsxs(Mn,{open:t,onOpenChange:n,children:[l.jsx(Yr,{children:l.jsx(be,{variant:"ghost",size:"1",className:"-mb-2.5 bg-transparent hover:text-accent-10 w-full",children:"View Votes"})}),l.jsx(Ln,{className:O(Qt,"max-h-[80vh]"),children:l.jsx(ur,{onClose:r,poll:e})})]}):l.jsxs(So,{open:t,onOpenChange:n,children:[l.jsx(Hn,{className:"w-full"}),l.jsx(Eo,{asChild:!0,children:l.jsx(be,{variant:"ghost",size:"1",className:"bg-transparent hover:text-accent-10 w-full",children:"View Votes"})}),l.jsx(Ro,{children:l.jsx("div",{className:"h-[80vh]",children:l.jsx(ur,{onClose:r,poll:e})})})]})},ur=({onClose:e,poll:t})=>{const{data:n,error:r}=De("raven.api.raven_poll.get_all_votes",{poll_id:t.poll.name},`poll_votes_${t.poll.name}`,{revalidateOnFocus:!1,revalidateOnReconnect:!1});return l.jsxs(w,{direction:"column",gap:"2",children:[l.jsx(qr,{error:r}),n&&n.message&&l.jsx(kl,{votesData:n.message,poll:t})]})},kl=({votesData:e,poll:t})=>l.jsxs(w,{direction:"column",children:[l.jsx(_n,{children:l.jsxs(w,{justify:"between",align:"baseline",children:[l.jsx(A,{children:"Poll Votes"}),l.jsxs(A,{size:"2",color:"gray",className:"not-cal",children:[t.poll.total_votes," votes"]})]})}),l.jsx(Hn,{className:"w-full"}),l.jsx(Mo,{className:"h-[76vh]",type:"scroll",children:l.jsxs(w,{direction:"column",className:"py-4 pr-3",gap:"2",children:[l.jsx(A,{size:"3",weight:"bold",children:t.poll.question}),e&&Object.keys(e).map(n=>{var o;const r=e[n],s=(o=t.poll.options.find(i=>i.name===n))==null?void 0:o.option;return l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center justify-between py-2",children:[l.jsxs(w,{children:[l.jsx(A,{size:"1",children:s}),l.jsxs(A,{size:"1",color:"gray",className:"ml-1",children:["- ",r.percentage.toFixed(2),"%"]})]}),l.jsxs(A,{size:"1",color:"gray",children:[r.count," vote",r.count>1?"s":""]})]},n),l.jsx(w,{direction:"column",gap:"2",className:"bg-gray-100 dark:bg-gray-3 rounded-md py-2 px-2",children:r.users.map(i=>l.jsx("div",{className:"group",children:l.jsx(Al,{user_id:i})},i))})]})})]})})]}),Al=({user_id:e})=>{const t=Zt(e);return l.jsxs(w,{gap:"2",children:[l.jsx(zn,{alt:t==null?void 0:t.full_name,src:t==null?void 0:t.user_image,size:"2"}),l.jsx("div",{className:"flex flex-col text-ellipsis justify-center border-b border-gray-6 w-full pb-2 group-last:pb-0 group-last:border-b-0",children:l.jsx(A,{as:"span",className:"block",weight:"medium",size:"2",children:t==null?void 0:t.full_name})})]})},Tl=r=>{var s=r,{message:e,user:t}=s,n=ue(s,["message","user"]);const{data:o,error:i,mutate:a}=De("raven.api.raven_poll.get_poll",{message_id:e.name},`poll_data_${e.poll_id}`,{revalidateOnFocus:!1,revalidateOnReconnect:!1});return Lo("Raven Poll",e.poll_id,()=>{a()}),l.jsxs(z,N(j({},n),{pt:"1",children:[l.jsx(qr,{error:i}),o&&l.jsx(Nl,{data:o.message,messageID:e.name})]}))},Nl=({data:e,messageID:t})=>l.jsx(w,{align:"center",gap:"4",p:"2",className:`bg-gray-2
        shadow-sm
        dark:bg-gray-3
        group-hover:bg-accent-a2
        dark:group-hover:bg-gray-4
        group-hover:transition-all
        group-hover:delay-100
        min-w-64
        max-w-96
        w-full
        rounded-md`,children:l.jsxs(w,{direction:"column",gap:"2",p:"2",className:"w-full",children:[l.jsxs(w,{justify:"between",align:"center",gap:"2",children:[l.jsx(A,{size:"2",weight:"medium",children:e.poll.question}),e.poll.is_anonymous?l.jsx(xt,{color:"blue",className:"w-fit",children:"Anonymous"}):null]}),e.current_user_votes.length>0?l.jsx(Sl,{data:e}):l.jsx(l.Fragment,{children:e.poll.is_multi_choice?l.jsx(Ml,{data:e,messageID:t}):l.jsx(Rl,{data:e,messageID:t})}),e.poll.is_disabled?l.jsx(xt,{color:"gray",className:"w-fit",children:"Poll is now closed"}):null,e.poll.is_anonymous?null:l.jsx(jl,{poll:e})]})}),Sl=({data:e})=>l.jsxs(w,{direction:"column",gap:"2",className:"w-full",children:[e.poll.options.map(t=>l.jsx(El,{data:e,option:t},t.name)),l.jsxs(A,{as:"span",size:"1",color:"gray",className:"px-2",children:[e.poll.total_votes," vote",e.poll.total_votes>1?"s":""]})]}),El=({data:e,option:t})=>{const[n,r]=C.useState(!1);C.useEffect(()=>{r(!0)},[e]);const s=C.useMemo(()=>e.current_user_votes.some(a=>a.option===t.name),[e.current_user_votes,t.name]),o=C.useMemo(()=>{var c;return(d=>{if(e.poll.is_multi_choice){const u=e.poll.options.reduce((h,f)=>{var p;return h+((p=f.votes)!=null?p:0)},0);return d/u*100}else return d/e.poll.total_votes*100})((c=t.votes)!=null?c:0)},[t.votes,e]),i=`${o}%`;return l.jsxs(w,{justify:"between",align:"center",width:"100%",className:"relative",children:[l.jsx(z,{position:"absolute",top:"0",left:"0","data-is-current-user-vote":s,className:`bg-gray-5
                            dark:bg-gray-6
                            h-full
                            rounded-sm
                            data-[is-current-user-vote=true]:bg-accent-a5
                            dark:data-[is-current-user-vote=true]:bg-accent-a6`,style:{width:n?i:0,transition:"width 0.5s ease-in-out"}}),l.jsx(A,{as:"span",size:"2",className:"px-2 py-1 z-10",weight:s?"bold":"regular",children:t.option}),l.jsxs(A,{as:"span",size:"2",className:"px-2 py-1 z-10",weight:s?"bold":"regular",children:[o.toFixed(1),"%"]})]},t.name)},Rl=({data:e,messageID:t})=>{const{call:n}=et("raven.api.raven_poll.add_vote"),r=s=>$e(void 0,null,function*(){return n({message_id:t,option_id:s.name}).then(()=>{D.success("Your vote has been submitted!")}).catch(o=>{D.error("There was an error submitting your vote.",{description:ye(o)})})});return l.jsx(_o,{children:e.poll.options.map(s=>l.jsx("div",{children:l.jsx(A,{as:"label",size:"2",children:l.jsxs(w,{gap:"2",p:"2",className:"rounded-sm hover:bg-accent-a2 dark:hover:bg-gray-5",children:[l.jsx(Oo,{disabled:!!e.poll.is_disabled,value:s.name,onClick:()=>r(s)}),s.option]})})},s.name))})},Ml=({data:e,messageID:t})=>{const[n,r]=C.useState([]),s=(a,c)=>{r(c?d=>[...d,a]:d=>d.filter(u=>u!==a))},{call:o}=et("raven.api.raven_poll.add_vote"),i=()=>$e(void 0,null,function*(){if(!n.length){D.error("Please select at least one option");return}return o({message_id:t,option_id:n}).then(()=>{D.success("Your vote has been submitted!")}).catch(a=>{D.error("There was an error submitting your vote.",{description:ye(a)})})});return l.jsxs("div",{children:[e.poll.options.map(a=>l.jsx("div",{children:l.jsx(A,{as:"label",size:"2",children:l.jsxs(w,{gap:"2",p:"2",className:"rounded-sm hover:bg-accent-a2 dark:hover:bg-gray-5",children:[l.jsx(Ho,{disabled:!!e.poll.is_disabled,value:a.name,onCheckedChange:c=>s(a.name,c)}),a.option]})})},a.name)),l.jsxs(w,{justify:"between",align:"center",gap:"2",children:[l.jsx(A,{size:"1",className:"text-gray-500",children:"To view the poll results, please submit your choice(s)"}),l.jsx(be,{disabled:!!e.poll.is_disabled,size:"1",variant:"soft",style:{alignSelf:"flex-end"},onClick:i,children:"Submit"})]})]})},Ll=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,_l=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,Ol=Bn.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:e=>e.getAttribute("data-color")||e.style.backgroundColor,renderHTML:e=>e.color?{"data-color":e.color,style:`background-color: ${e.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:e}){return["mark",F(this.options.HTMLAttributes,e),0]},addCommands(){return{setHighlight:e=>({commands:t})=>t.setMark(this.name,e),toggleHighlight:e=>({commands:t})=>t.toggleMark(this.name,e),unsetHighlight:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[ei({find:Ll,type:this.type})]},addPasteRules(){return[ss({find:_l,type:this.type})]}}),Hl=ti.extend({renderHTML({HTMLAttributes:e}){return["strong",F(e,{class:"rt-Strong"}),0]}}),zl=e=>{var s,o,i,a;const{ravenSettings:t}=Mi(),n=((i=(o=(s=window==null?void 0:window.frappe)==null?void 0:s.boot)==null?void 0:o.versions)==null?void 0:i.hrms)!==void 0,{data:r}=De("raven.api.raven_users.is_user_on_leave",{user:e},t!=null&&t.show_if_a_user_is_on_leave&&n?["is_user_on_leave",e]:null,{dedupingInterval:6*60*60*1e3,revalidateOnFocus:!1});return(a=r==null?void 0:r.message)!=null?a:!1},ws=({userID:e})=>zl(e)?l.jsx(xt,{color:"yellow",variant:"surface",children:"On Leave"}):null,Dl=({node:e})=>{var d,u,h;const t=Zt(e.attrs.id),n=Gr(e.attrs.id),r=t==null?void 0:t.availability_status,s=t==null?void 0:t.custom_status,{call:o}=C.useContext(rt),i=En(),{workspaceID:a}=tt(),c=()=>{t&&o.post("raven.api.raven_channel.create_direct_message_channel",{user_id:t==null?void 0:t.name}).then(f=>{i(`/${a}/${f==null?void 0:f.message}`)}).catch(f=>{D.error("Could not create a DM channel",{description:ye(f)})})};return l.jsx(en,{as:"span",children:l.jsxs(Dn,{children:[l.jsx(In,{children:l.jsxs(xe,{size:"2",onClick:c,className:"cursor-pointer",children:["@",(d=t==null?void 0:t.full_name)!=null?d:e.attrs.label]})}),l.jsx(Pn,{size:"1",children:l.jsxs(w,{gap:"2",align:"center",children:[l.jsx(zn,{src:t==null?void 0:t.user_image,alt:(u=t==null?void 0:t.full_name)!=null?u:e.attrs.label,size:"4"}),l.jsxs(w,{direction:"column",children:[l.jsxs(w,{gap:"3",align:"center",children:[l.jsx(A,{className:"text-gray-12",weight:"bold",size:"3",children:(h=t==null?void 0:t.full_name)!=null?h:e.attrs.label}),r&&r!=="Invisible"&&l.jsx(w,{className:"text-gray-10 text-xs flex gap-1 items-center",children:Qr(r)}),!r&&n&&l.jsxs(w,{gap:"1",align:"center",children:[l.jsx(Jr,{color:"green",size:"8"}),l.jsx(A,{className:"text-gray-10",size:"1",children:"Online"})]})]}),t&&l.jsx(ws,{userID:t.name}),s?l.jsx(A,{className:"text-gray-11",size:"2",children:s}):t&&l.jsx(A,{className:"text-gray-11",size:"1",children:t==null?void 0:t.name})]})]})})]})})},Il=({node:e})=>l.jsx(en,{as:"span",children:l.jsx(xe,{asChild:!0,children:l.jsxs(Xr,{to:`/channel/${e.attrs.id}`,children:["#",e.attrs.label]})})}),Pl="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2ntley5rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6logistics9properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3ncaster6d0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2psy3ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0america6xi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mögensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",Bl="ελ1υ2бг1ел3дети4ею2католик6ом3мкд2он1сква6онлайн5рг3рус2ф2сайт3рб3укр3қаз3հայ3ישראל5קום3ابوظبي5رامكو5لاردن4بحرين5جزائر5سعودية6عليان5مغرب5مارات5یران5بارت2زار4يتك3ھارت5تونس4سودان3رية5شبكة4عراق2ب2مان4فلسطين6قطر3كاثوليك6وم3مصر2ليسيا5وريتانيا7قع4همراه5پاکستان7ڀارت4कॉम3नेट3भारत0म्3ोत5संगठन5বাংলা5ভারত2ৰত4ਭਾਰਤ4ભારત4ଭାରତ4இந்தியா6லங்கை6சிங்கப்பூர்11భారత్5ಭಾರತ4ഭാരതം5ලංකා4คอม3ไทย3ລາວ3გე2みんな3アマゾン4クラウド4グーグル4コム2ストア3セール3ファッション6ポイント4世界2中信1国1國1文网3亚马逊3企业2佛山2信息2健康2八卦2公司1益2台湾1灣2商城1店1标2嘉里0大酒店5在线2大拿2天主教3娱乐2家電2广东2微博2慈善2我爱你3手机2招聘2政务1府2新加坡2闻2时尚2書籍2机构2淡马锡3游戏2澳門2点看2移动2组织机构4网址1店1站1络2联通2谷歌2购物2通販2集团2電訊盈科4飞利浦3食品2餐厅2香格里拉3港2닷넷1컴2삼성2한국2",ze=(e,t)=>{for(const n in t)e[n]=t[n];return e},gn="numeric",xn="ascii",bn="alpha",Ve="asciinumeric",We="alphanumeric",yn="domain",vs="emoji",$l="scheme",Fl="slashscheme",ln="whitespace";function Ul(e,t){return e in t||(t[e]=[]),t[e]}function Ee(e,t,n){t[gn]&&(t[Ve]=!0,t[We]=!0),t[xn]&&(t[Ve]=!0,t[bn]=!0),t[Ve]&&(t[We]=!0),t[bn]&&(t[We]=!0),t[We]&&(t[yn]=!0),t[vs]&&(t[yn]=!0);for(const r in t){const s=Ul(r,n);s.indexOf(e)<0&&s.push(e)}}function Wl(e,t){const n={};for(const r in t)t[r].indexOf(e)>=0&&(n[r]=!0);return n}function Q(e=null){this.j={},this.jr=[],this.jd=null,this.t=e}Q.groups={};Q.prototype={accepts(){return!!this.t},go(e){const t=this,n=t.j[e];if(n)return n;for(let r=0;r<t.jr.length;r++){const s=t.jr[r][0],o=t.jr[r][1];if(o&&s.test(e))return o}return t.jd},has(e,t=!1){return t?e in this.j:!!this.go(e)},ta(e,t,n,r){for(let s=0;s<e.length;s++)this.tt(e[s],t,n,r)},tr(e,t,n,r){r=r||Q.groups;let s;return t&&t.j?s=t:(s=new Q(t),n&&r&&Ee(t,n,r)),this.jr.push([e,s]),s},ts(e,t,n,r){let s=this;const o=e.length;if(!o)return s;for(let i=0;i<o-1;i++)s=s.tt(e[i]);return s.tt(e[o-1],t,n,r)},tt(e,t,n,r){r=r||Q.groups;const s=this;if(t&&t.j)return s.j[e]=t,t;const o=t;let i,a=s.go(e);if(a?(i=new Q,ze(i.j,a.j),i.jr.push.apply(i.jr,a.jr),i.jd=a.jd,i.t=a.t):i=new Q,o){if(r)if(i.t&&typeof i.t=="string"){const c=ze(Wl(i.t,r),n);Ee(o,c,r)}else n&&Ee(o,n,r);i.t=o}return s.j[e]=i,i}};const k=(e,t,n,r,s)=>e.ta(t,n,r,s),I=(e,t,n,r,s)=>e.tr(t,n,r,s),hr=(e,t,n,r,s)=>e.ts(t,n,r,s),x=(e,t,n,r,s)=>e.tt(t,n,r,s),pe="WORD",wn="UWORD",Cs="ASCIINUMERICAL",js="ALPHANUMERICAL",Je="LOCALHOST",vn="TLD",Cn="UTLD",pt="SCHEME",He="SLASH_SCHEME",Vn="NUM",jn="WS",Kn="NL",Ke="OPENBRACE",Ye="CLOSEBRACE",jt="OPENBRACKET",kt="CLOSEBRACKET",At="OPENPAREN",Tt="CLOSEPAREN",Nt="OPENANGLEBRACKET",St="CLOSEANGLEBRACKET",Et="FULLWIDTHLEFTPAREN",Rt="FULLWIDTHRIGHTPAREN",Mt="LEFTCORNERBRACKET",Lt="RIGHTCORNERBRACKET",_t="LEFTWHITECORNERBRACKET",Ot="RIGHTWHITECORNERBRACKET",Ht="FULLWIDTHLESSTHAN",zt="FULLWIDTHGREATERTHAN",Dt="AMPERSAND",Yn="APOSTROPHE",It="ASTERISK",ve="AT",Pt="BACKSLASH",Bt="BACKTICK",$t="CARET",Ce="COLON",qn="COMMA",Ft="DOLLAR",oe="DOT",Ut="EQUALS",Gn="EXCLAMATION",re="HYPHEN",qe="PERCENT",Wt="PIPE",Vt="PLUS",Kt="POUND",Ge="QUERY",Qn="QUOTE",ks="FULLWIDTHMIDDLEDOT",Jn="SEMI",ie="SLASH",Qe="TILDE",Yt="UNDERSCORE",As="EMOJI",qt="SYM";var Ts=Object.freeze({__proto__:null,WORD:pe,UWORD:wn,ASCIINUMERICAL:Cs,ALPHANUMERICAL:js,LOCALHOST:Je,TLD:vn,UTLD:Cn,SCHEME:pt,SLASH_SCHEME:He,NUM:Vn,WS:jn,NL:Kn,OPENBRACE:Ke,CLOSEBRACE:Ye,OPENBRACKET:jt,CLOSEBRACKET:kt,OPENPAREN:At,CLOSEPAREN:Tt,OPENANGLEBRACKET:Nt,CLOSEANGLEBRACKET:St,FULLWIDTHLEFTPAREN:Et,FULLWIDTHRIGHTPAREN:Rt,LEFTCORNERBRACKET:Mt,RIGHTCORNERBRACKET:Lt,LEFTWHITECORNERBRACKET:_t,RIGHTWHITECORNERBRACKET:Ot,FULLWIDTHLESSTHAN:Ht,FULLWIDTHGREATERTHAN:zt,AMPERSAND:Dt,APOSTROPHE:Yn,ASTERISK:It,AT:ve,BACKSLASH:Pt,BACKTICK:Bt,CARET:$t,COLON:Ce,COMMA:qn,DOLLAR:Ft,DOT:oe,EQUALS:Ut,EXCLAMATION:Gn,HYPHEN:re,PERCENT:qe,PIPE:Wt,PLUS:Vt,POUND:Kt,QUERY:Ge,QUOTE:Qn,FULLWIDTHMIDDLEDOT:ks,SEMI:Jn,SLASH:ie,TILDE:Qe,UNDERSCORE:Yt,EMOJI:As,SYM:qt});const he=/[a-z]/,Fe=new RegExp("\\p{L}","u"),an=new RegExp("\\p{Emoji}","u"),fe=/\d/,cn=/\s/,fr="\r",dn=`
`,Vl="️",Kl="‍",un="￼";let it=null,lt=null;function Yl(e=[]){const t={};Q.groups=t;const n=new Q;it==null&&(it=pr(Pl)),lt==null&&(lt=pr(Bl)),x(n,"'",Yn),x(n,"{",Ke),x(n,"}",Ye),x(n,"[",jt),x(n,"]",kt),x(n,"(",At),x(n,")",Tt),x(n,"<",Nt),x(n,">",St),x(n,"（",Et),x(n,"）",Rt),x(n,"「",Mt),x(n,"」",Lt),x(n,"『",_t),x(n,"』",Ot),x(n,"＜",Ht),x(n,"＞",zt),x(n,"&",Dt),x(n,"*",It),x(n,"@",ve),x(n,"`",Bt),x(n,"^",$t),x(n,":",Ce),x(n,",",qn),x(n,"$",Ft),x(n,".",oe),x(n,"=",Ut),x(n,"!",Gn),x(n,"-",re),x(n,"%",qe),x(n,"|",Wt),x(n,"+",Vt),x(n,"#",Kt),x(n,"?",Ge),x(n,'"',Qn),x(n,"/",ie),x(n,";",Jn),x(n,"~",Qe),x(n,"_",Yt),x(n,"\\",Pt),x(n,"・",ks);const r=I(n,fe,Vn,{[gn]:!0});I(r,fe,r);const s=I(r,he,Cs,{[Ve]:!0}),o=I(r,Fe,js,{[We]:!0}),i=I(n,he,pe,{[xn]:!0});I(i,fe,s),I(i,he,i),I(s,fe,s),I(s,he,s);const a=I(n,Fe,wn,{[bn]:!0});I(a,he),I(a,fe,o),I(a,Fe,a),I(o,fe,o),I(o,he),I(o,Fe,o);const c=x(n,dn,Kn,{[ln]:!0}),d=x(n,fr,jn,{[ln]:!0}),u=I(n,cn,jn,{[ln]:!0});x(n,un,u),x(d,dn,c),x(d,un,u),I(d,cn,u),x(u,fr),x(u,dn),I(u,cn,u),x(u,un,u);const h=I(n,an,As,{[vs]:!0});x(h,"#"),I(h,an,h),x(h,Vl,h);const f=x(h,Kl);x(f,"#"),I(f,an,h);const p=[[he,i],[fe,s]],m=[[he,null],[Fe,a],[fe,o]];for(let b=0;b<it.length;b++)we(n,it[b],vn,pe,p);for(let b=0;b<lt.length;b++)we(n,lt[b],Cn,wn,m);Ee(vn,{tld:!0,ascii:!0},t),Ee(Cn,{utld:!0,alpha:!0},t),we(n,"file",pt,pe,p),we(n,"mailto",pt,pe,p),we(n,"http",He,pe,p),we(n,"https",He,pe,p),we(n,"ftp",He,pe,p),we(n,"ftps",He,pe,p),Ee(pt,{scheme:!0,ascii:!0},t),Ee(He,{slashscheme:!0,ascii:!0},t),e=e.sort((b,g)=>b[0]>g[0]?1:-1);for(let b=0;b<e.length;b++){const g=e[b][0],v=e[b][1]?{[$l]:!0}:{[Fl]:!0};g.indexOf("-")>=0?v[yn]=!0:he.test(g)?fe.test(g)?v[Ve]=!0:v[xn]=!0:v[gn]=!0,hr(n,g,g,v)}return hr(n,"localhost",Je,{ascii:!0}),n.jd=new Q(qt),{start:n,tokens:ze({groups:t},Ts)}}function Ns(e,t){const n=ql(t.replace(/[A-Z]/g,a=>a.toLowerCase())),r=n.length,s=[];let o=0,i=0;for(;i<r;){let a=e,c=null,d=0,u=null,h=-1,f=-1;for(;i<r&&(c=a.go(n[i]));)a=c,a.accepts()?(h=0,f=0,u=a):h>=0&&(h+=n[i].length,f++),d+=n[i].length,o+=n[i].length,i++;o-=h,i-=f,d-=h,s.push({t:u.t,v:t.slice(o-d,o),s:o-d,e:o})}return s}function ql(e){const t=[],n=e.length;let r=0;for(;r<n;){let s=e.charCodeAt(r),o,i=s<55296||s>56319||r+1===n||(o=e.charCodeAt(r+1))<56320||o>57343?e[r]:e.slice(r,r+2);t.push(i),r+=i.length}return t}function we(e,t,n,r,s){let o;const i=t.length;for(let a=0;a<i-1;a++){const c=t[a];e.j[c]?o=e.j[c]:(o=new Q(r),o.jr=s.slice(),e.j[c]=o),e=o}return o=new Q(n),o.jr=s.slice(),e.j[t[i-1]]=o,o}function pr(e){const t=[],n=[];let r=0,s="0123456789";for(;r<e.length;){let o=0;for(;s.indexOf(e[r+o])>=0;)o++;if(o>0){t.push(n.join(""));for(let i=parseInt(e.substring(r,r+o),10);i>0;i--)n.pop();r+=o}else n.push(e[r]),r++}return t}const Xe={defaultProtocol:"http",events:null,format:mr,formatHref:mr,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Xn(e,t=null){let n=ze({},Xe);e&&(n=ze(n,e instanceof Xn?e.o:e));const r=n.ignoreTags,s=[];for(let o=0;o<r.length;o++)s.push(r[o].toUpperCase());this.o=n,t&&(this.defaultRender=t),this.ignoreTags=s}Xn.prototype={o:Xe,ignoreTags:[],defaultRender(e){return e},check(e){return this.get("validate",e.toString(),e)},get(e,t,n){const r=t!=null;let s=this.o[e];return s&&(typeof s=="object"?(s=n.t in s?s[n.t]:Xe[e],typeof s=="function"&&r&&(s=s(t,n))):typeof s=="function"&&r&&(s=s(t,n.t,n)),s)},getObj(e,t,n){let r=this.o[e];return typeof r=="function"&&t!=null&&(r=r(t,n.t,n)),r},render(e){const t=e.render(this);return(this.get("render",null,e)||this.defaultRender)(t,e.t,e)}};function mr(e){return e}function Ss(e,t){this.t="token",this.v=e,this.tk=t}Ss.prototype={isLink:!1,toString(){return this.v},toHref(e){return this.toString()},toFormattedString(e){const t=this.toString(),n=e.get("truncate",t,this),r=e.get("format",t,this);return n&&r.length>n?r.substring(0,n)+"…":r},toFormattedHref(e){return e.get("formatHref",this.toHref(e.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(e=Xe.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(e),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(e){return{type:this.t,value:this.toFormattedString(e),isLink:this.isLink,href:this.toFormattedHref(e),start:this.startIndex(),end:this.endIndex()}},validate(e){return e.get("validate",this.toString(),this)},render(e){const t=this,n=this.toHref(e.get("defaultProtocol")),r=e.get("formatHref",n,this),s=e.get("tagName",n,t),o=this.toFormattedString(e),i={},a=e.get("className",n,t),c=e.get("target",n,t),d=e.get("rel",n,t),u=e.getObj("attributes",n,t),h=e.getObj("events",n,t);return i.href=r,a&&(i.class=a),c&&(i.target=c),d&&(i.rel=d),u&&ze(i,u),{tagName:s,attributes:i,content:o,eventListeners:h}}};function tn(e,t){class n extends Ss{constructor(s,o){super(s,o),this.t=e}}for(const r in t)n.prototype[r]=t[r];return n.t=e,n}const gr=tn("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),xr=tn("text"),Gl=tn("nl"),at=tn("url",{isLink:!0,toHref(e=Xe.defaultProtocol){return this.hasProtocol()?this.v:`${e}://${this.v}`},hasProtocol(){const e=this.tk;return e.length>=2&&e[0].t!==Je&&e[1].t===Ce}}),ne=e=>new Q(e);function Ql({groups:e}){const t=e.domain.concat([Dt,It,ve,Pt,Bt,$t,Ft,Ut,re,Vn,qe,Wt,Vt,Kt,ie,qt,Qe,Yt]),n=[Ce,qn,oe,Gn,qe,Ge,Qn,Jn,Nt,St,Ke,Ye,kt,jt,At,Tt,Et,Rt,Mt,Lt,_t,Ot,Ht,zt],r=[Dt,Yn,It,Pt,Bt,$t,Ft,Ut,re,Ke,Ye,qe,Wt,Vt,Kt,Ge,ie,qt,Qe,Yt],s=ne(),o=x(s,Qe);k(o,r,o),k(o,e.domain,o);const i=ne(),a=ne(),c=ne();k(s,e.domain,i),k(s,e.scheme,a),k(s,e.slashscheme,c),k(i,r,o),k(i,e.domain,i);const d=x(i,ve);x(o,ve,d),x(a,ve,d),x(c,ve,d);const u=x(o,oe);k(u,r,o),k(u,e.domain,o);const h=ne();k(d,e.domain,h),k(h,e.domain,h);const f=x(h,oe);k(f,e.domain,h);const p=ne(gr);k(f,e.tld,p),k(f,e.utld,p),x(d,Je,p);const m=x(h,re);x(m,re,m),k(m,e.domain,h),k(p,e.domain,h),x(p,oe,f),x(p,re,m);const b=x(p,Ce);k(b,e.numeric,gr);const g=x(i,re),y=x(i,oe);x(g,re,g),k(g,e.domain,i),k(y,r,o),k(y,e.domain,i);const v=ne(at);k(y,e.tld,v),k(y,e.utld,v),k(v,e.domain,i),k(v,r,o),x(v,oe,y),x(v,re,g),x(v,ve,d);const E=x(v,Ce),R=ne(at);k(E,e.numeric,R);const T=ne(at),H=ne();k(T,t,T),k(T,n,H),k(H,t,T),k(H,n,H),x(v,ie,T),x(R,ie,T);const M=x(a,Ce),$=x(c,Ce),S=x($,ie),B=x(S,ie);k(a,e.domain,i),x(a,oe,y),x(a,re,g),k(c,e.domain,i),x(c,oe,y),x(c,re,g),k(M,e.domain,T),x(M,ie,T),x(M,Ge,T),k(B,e.domain,T),k(B,t,T),x(B,ie,T);const U=[[Ke,Ye],[jt,kt],[At,Tt],[Nt,St],[Et,Rt],[Mt,Lt],[_t,Ot],[Ht,zt]];for(let X=0;X<U.length;X++){const[Z,de]=U[X],q=x(T,Z);x(H,Z,q),x(q,de,T);const Y=ne(at);k(q,t,Y);const ee=ne();k(q,n),k(Y,t,Y),k(Y,n,ee),k(ee,t,Y),k(ee,n,ee),x(Y,de,T),x(ee,de,T)}return x(s,Je,v),x(s,Kn,Gl),{start:s,tokens:Ts}}function Jl(e,t,n){let r=n.length,s=0,o=[],i=[];for(;s<r;){let a=e,c=null,d=null,u=0,h=null,f=-1;for(;s<r&&!(c=a.go(n[s].t));)i.push(n[s++]);for(;s<r&&(d=c||a.go(n[s].t));)c=null,a=d,a.accepts()?(f=0,h=a):f>=0&&f++,s++,u++;if(f<0)s-=u,s<r&&(i.push(n[s]),s++);else{i.length>0&&(o.push(hn(xr,t,i)),i=[]),s-=f,u-=f;const p=h.t,m=n.slice(s-u,s);o.push(hn(p,t,m))}}return i.length>0&&o.push(hn(xr,t,i)),o}function hn(e,t,n){const r=n[0].s,s=n[n.length-1].e,o=t.slice(r,s);return new e(o,n)}const Xl=typeof console!="undefined"&&console&&console.warn||(()=>{}),Zl="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",_={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function ea(){return Q.groups={},_.scanner=null,_.parser=null,_.tokenQueue=[],_.pluginQueue=[],_.customSchemes=[],_.initialized=!1,_}function br(e,t=!1){if(_.initialized&&Xl(`linkifyjs: already initialized - will not register custom scheme "${e}" ${Zl}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(e))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);_.customSchemes.push([e,t])}function ta(){_.scanner=Yl(_.customSchemes);for(let e=0;e<_.tokenQueue.length;e++)_.tokenQueue[e][1]({scanner:_.scanner});_.parser=Ql(_.scanner.tokens);for(let e=0;e<_.pluginQueue.length;e++)_.pluginQueue[e][1]({scanner:_.scanner,parser:_.parser});return _.initialized=!0,_}function Zn(e){return _.initialized||ta(),Jl(_.parser.start,e,Ns(_.scanner.start,e))}Zn.scan=Ns;function Es(e,t=null,n=null){if(t&&typeof t=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${t}; must be a string`);n=t,t=null}const r=new Xn(n),s=Zn(e),o=[];for(let i=0;i<s.length;i++){const a=s[i];a.isLink&&(!t||a.t===t)&&r.check(a)&&o.push(a.toFormattedObject(r))}return o}function na(e){return e.length===1?e[0].isLink:e.length===3&&e[1].isLink?["()","[]"].includes(e[0].value+e[2].value):!1}function ra(e){return new Pe({key:new ae("autolink"),appendTransaction:(t,n,r)=>{const s=t.some(d=>d.docChanged)&&!n.doc.eq(r.doc),o=t.some(d=>d.getMeta("preventAutolink"));if(!s||o)return;const{tr:i}=r,a=ni(n.doc,[...t]);if(ri(a).forEach(({newRange:d})=>{const u=si(r.doc,d,p=>p.isTextblock);let h,f;if(u.length>1?(h=u[0],f=r.doc.textBetween(h.pos,h.pos+h.node.nodeSize,void 0," ")):u.length&&r.doc.textBetween(d.from,d.to," "," ").endsWith(" ")&&(h=u[0],f=r.doc.textBetween(h.pos,d.to,void 0," ")),h&&f){const p=f.split(" ").filter(y=>y!=="");if(p.length<=0)return!1;const m=p[p.length-1],b=h.pos+f.lastIndexOf(m);if(!m)return!1;const g=Zn(m).map(y=>y.toObject(e.defaultProtocol));if(!na(g))return!1;g.filter(y=>y.isLink).map(y=>N(j({},y),{from:b+y.start+1,to:b+y.end+1})).filter(y=>r.schema.marks.code?!r.doc.rangeHasMark(y.from,y.to,r.schema.marks.code):!0).filter(y=>e.validate(y.value)).forEach(y=>{oi(y.from,y.to,r.doc).some(v=>v.mark.type===e.type)||i.addMark(y.from,y.to,e.type.create({href:y.href}))})}}),!!i.steps.length)return i}})}function sa(e){return new Pe({key:new ae("handleClickLink"),props:{handleClick:(t,n,r)=>{var s,o;if(r.button!==0||!t.editable)return!1;let i=r.target;const a=[];for(;i.nodeName!=="DIV";)a.push(i),i=i.parentNode;if(!a.find(f=>f.nodeName==="A"))return!1;const c=ii(t.state,e.type.name),d=r.target,u=(s=d==null?void 0:d.href)!==null&&s!==void 0?s:c.href,h=(o=d==null?void 0:d.target)!==null&&o!==void 0?o:c.target;return d&&u?(window.open(u,h),!0):!1}}})}function oa(e){return new Pe({key:new ae("handlePasteLink"),props:{handlePaste:(t,n,r)=>{const{state:s}=t,{selection:o}=s,{empty:i}=o;if(i)return!1;let a="";r.content.forEach(d=>{a+=d.textContent});const c=Es(a,{defaultProtocol:e.defaultProtocol}).find(d=>d.isLink&&d.value===a);return!a||!c?!1:(e.editor.commands.setMark(e.type,{href:c.href}),!0)}}})}const ia=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g,la=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i;function yr(e){return!e||e.replace(ia,"").match(la)}const aa=Bn.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.protocols.forEach(e=>{if(typeof e=="string"){br(e);return}br(e.scheme,e.optionalSlashes)})},onDestroy(){ea()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},validate:e=>!!e}},addAttributes(){return{href:{default:null},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:e=>{const t=e.getAttribute("href");return!t||!yr(t)?!1:{href:t}}}]},renderHTML({HTMLAttributes:e}){return yr(e.href)?["a",F(this.options.HTMLAttributes,e),0]:["a",F(this.options.HTMLAttributes,N(j({},e),{href:""})),0]},addCommands(){return{setLink:e=>({chain:t})=>t().setMark(this.name,e).setMeta("preventAutolink",!0).run(),toggleLink:e=>({chain:t})=>t().toggleMark(this.name,e,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run(),unsetLink:()=>({chain:e})=>e().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[ss({find:e=>{const t=[];if(e){const{validate:n}=this.options,r=Es(e).filter(s=>s.isLink&&n(s.value));r.length&&r.forEach(s=>t.push({text:s.value,data:{href:s.href},index:s.start}))}return t},type:this.type,getAttributes:e=>{var t;return{href:(t=e.data)===null||t===void 0?void 0:t.href}}})]},addProseMirrorPlugins(){const e=[];return this.options.autolink&&e.push(ra({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:this.options.validate})),this.options.openOnClick===!0&&e.push(sa({type:this.type})),this.options.linkOnPaste&&e.push(oa({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type})),e}}),ca=aa.extend({renderHTML({HTMLAttributes:e}){return["a",F(e,{class:"rt-Text rt-reset rt-Link rt-underline-auto break-all"}),0]}}).configure({protocols:["mailto","https","http"],openOnClick:!1}),da=Bn.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:e=>e.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:e}){return["u",F(this.options.HTMLAttributes,e),0]},addCommands(){return{setUnderline:()=>({commands:e})=>e.setMark(this.name),toggleUnderline:()=>({commands:e})=>e.toggleMark(this.name),unsetUnderline:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),ua=da.extend({renderHTML({HTMLAttributes:e}){return["span",F(e,{class:"rt-Text rt-reset rt-Link rt-underline-always text-gray-12","data-accent-color":"gray"}),0]}}),ha=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,fa=Ne.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{}}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:e}){return["img",F(this.options.HTMLAttributes,e)]},addCommands(){return{setImage:e=>({commands:t})=>t.insertContent({type:this.name,attrs:e})}},addInputRules(){return[li({find:ha,type:this.type,getAttributes:e=>{const[,,t,n,r]=e;return{src:n,alt:t,title:r}}})]}});function pa(e){var t;const{char:n,allowSpaces:r,allowedPrefixes:s,startOfLine:o,$position:i}=e,a=ai(n),c=new RegExp(`\\s${a}$`),d=o?"^":"",u=r?new RegExp(`${d}${a}.*?(?=\\s${a}|$)`,"gm"):new RegExp(`${d}(?:^)?${a}[^\\s${a}]*`,"gm"),h=((t=i.nodeBefore)===null||t===void 0?void 0:t.isText)&&i.nodeBefore.text;if(!h)return null;const f=i.pos-h.length,p=Array.from(h.matchAll(u)).pop();if(!p||p.input===void 0||p.index===void 0)return null;const m=p.input.slice(Math.max(0,p.index-1),p.index),b=new RegExp(`^[${s==null?void 0:s.join("")}\0]?$`).test(m);if(s!==null&&!b)return null;const g=f+p.index;let y=g+p[0].length;return r&&c.test(h.slice(y-1,y+1))&&(p[0]+=" ",y+=1),g<i.pos&&y>=i.pos?{range:{from:g,to:y},query:p[0].slice(n.length),text:p[0]}:null}const ma=new ae("suggestion");function ga({pluginKey:e=ma,editor:t,char:n="@",allowSpaces:r=!1,allowedPrefixes:s=[" "],startOfLine:o=!1,decorationTag:i="span",decorationClass:a="suggestion",command:c=()=>null,items:d=()=>[],render:u=()=>({}),allow:h=()=>!0,findSuggestionMatch:f=pa}){let p;const m=u==null?void 0:u(),b=new Pe({key:e,view(){return{update:(g,y)=>$e(this,null,function*(){var v,E,R,T,H,M,$;const S=(v=this.key)===null||v===void 0?void 0:v.getState(y),B=(E=this.key)===null||E===void 0?void 0:E.getState(g.state),U=S.active&&B.active&&S.range.from!==B.range.from,X=!S.active&&B.active,Z=S.active&&!B.active,de=!X&&!Z&&S.query!==B.query,q=X,Y=de||U,ee=Z;if(!q&&!Y&&!ee)return;const G=ee&&!q?S:B,Se=g.dom.querySelector(`[data-decoration-id="${G.decorationId}"]`);p={editor:t,range:G.range,query:G.query,text:G.text,items:[],command:te=>c({editor:t,range:G.range,props:te}),decorationNode:Se,clientRect:Se?()=>{var te;const{decorationId:_e}=(te=this.key)===null||te===void 0?void 0:te.getState(t.state),Oe=g.dom.querySelector(`[data-decoration-id="${_e}"]`);return(Oe==null?void 0:Oe.getBoundingClientRect())||null}:null},q&&((R=m==null?void 0:m.onBeforeStart)===null||R===void 0||R.call(m,p)),Y&&((T=m==null?void 0:m.onBeforeUpdate)===null||T===void 0||T.call(m,p)),(Y||q)&&(p.items=yield d({editor:t,query:G.query})),ee&&((H=m==null?void 0:m.onExit)===null||H===void 0||H.call(m,p)),Y&&((M=m==null?void 0:m.onUpdate)===null||M===void 0||M.call(m,p)),q&&(($=m==null?void 0:m.onStart)===null||$===void 0||$.call(m,p))}),destroy:()=>{var g;p&&((g=m==null?void 0:m.onExit)===null||g===void 0||g.call(m,p))}}},state:{init(){return{active:!1,range:{from:0,to:0},query:null,text:null,composing:!1}},apply(g,y,v,E){const{isEditable:R}=t,{composing:T}=t.view,{selection:H}=g,{empty:M,from:$}=H,S=j({},y);if(S.composing=T,R&&(M||t.view.composing)){($<y.range.from||$>y.range.to)&&!T&&!y.composing&&(S.active=!1);const B=f({char:n,allowSpaces:r,allowedPrefixes:s,startOfLine:o,$position:H.$from}),U=`id_${Math.floor(Math.random()*4294967295)}`;B&&h({editor:t,state:E,range:B.range,isActive:y.active})?(S.active=!0,S.decorationId=y.decorationId?y.decorationId:U,S.range=B.range,S.query=B.query,S.text=B.text):S.active=!1}else S.active=!1;return S.active||(S.decorationId=null,S.range={from:0,to:0},S.query=null,S.text=null),S}},props:{handleKeyDown(g,y){var v;const{active:E,range:R}=b.getState(g.state);return E&&((v=m==null?void 0:m.onKeyDown)===null||v===void 0?void 0:v.call(m,{view:g,event:y,range:R}))||!1},decorations(g){const{active:y,range:v,decorationId:E}=b.getState(g);return y?bt.create(g.doc,[yt.inline(v.from,v.to,{nodeName:i,class:a,"data-decoration-id":E})]):null}}});return b}const xa=new ae("mention"),wr=Ne.create({name:"mention",addOptions(){return{HTMLAttributes:{},renderText({options:e,node:t}){var n;return`${e.suggestion.char}${(n=t.attrs.label)!==null&&n!==void 0?n:t.attrs.id}`},deleteTriggerWithBackspace:!1,renderHTML({options:e,node:t}){var n;return["span",F(this.HTMLAttributes,e.HTMLAttributes),`${e.suggestion.char}${(n=t.attrs.label)!==null&&n!==void 0?n:t.attrs.id}`]},suggestion:{char:"@",pluginKey:xa,command:({editor:e,range:t,props:n})=>{var r,s;const o=e.view.state.selection.$to.nodeAfter;((r=o==null?void 0:o.text)===null||r===void 0?void 0:r.startsWith(" "))&&(t.to+=1),e.chain().focus().insertContentAt(t,[{type:this.name,attrs:n},{type:"text",text:" "}]).run(),(s=window.getSelection())===null||s===void 0||s.collapseToEnd()},allow:({state:e,range:t})=>{const n=e.doc.resolve(t.from),r=e.schema.nodes[this.name];return!!n.parent.type.contentMatch.matchType(r)}}}},group:"inline",inline:!0,selectable:!1,atom:!0,addAttributes(){return{id:{default:null,parseHTML:e=>e.getAttribute("data-id"),renderHTML:e=>e.id?{"data-id":e.id}:{}},label:{default:null,parseHTML:e=>e.getAttribute("data-label"),renderHTML:e=>e.label?{"data-label":e.label}:{}}}},parseHTML(){return[{tag:`span[data-type="${this.name}"]`}]},renderHTML({node:e,HTMLAttributes:t}){if(this.options.renderLabel!==void 0)return console.warn("renderLabel is deprecated use renderText and renderHTML instead"),["span",F({"data-type":this.name},this.options.HTMLAttributes,t),this.options.renderLabel({options:this.options,node:e})];const n=j({},this.options);n.HTMLAttributes=F({"data-type":this.name},this.options.HTMLAttributes,t);const r=this.options.renderHTML({options:n,node:e});return typeof r=="string"?["span",F({"data-type":this.name},this.options.HTMLAttributes,t),r]:r},renderText({node:e}){return this.options.renderLabel!==void 0?(console.warn("renderLabel is deprecated use renderText and renderHTML instead"),this.options.renderLabel({options:this.options,node:e})):this.options.renderText({options:this.options,node:e})},addKeyboardShortcuts(){return{Backspace:()=>this.editor.commands.command(({tr:e,state:t})=>{let n=!1;const{selection:r}=t,{empty:s,anchor:o}=r;return s?(t.doc.nodesBetween(o-1,o,(i,a)=>{if(i.type.name===this.name)return n=!0,e.insertText(this.options.deleteTriggerWithBackspace?"":this.options.suggestion.char||"",a,a+i.nodeSize),!1}),n):!1})}},addProseMirrorPlugins(){return[ga(j({editor:this.editor},this.options.suggestion))]}});var kn,An;if(typeof WeakMap!="undefined"){let e=new WeakMap;kn=t=>e.get(t),An=(t,n)=>(e.set(t,n),n)}else{const e=[];let n=0;kn=r=>{for(let s=0;s<e.length;s+=2)if(e[s]==r)return e[s+1]},An=(r,s)=>(n==10&&(n=0),e[n++]=r,e[n++]=s)}var P=class{constructor(e,t,n,r){this.width=e,this.height=t,this.map=n,this.problems=r}findCell(e){for(let t=0;t<this.map.length;t++){const n=this.map[t];if(n!=e)continue;const r=t%this.width,s=t/this.width|0;let o=r+1,i=s+1;for(let a=1;o<this.width&&this.map[t+a]==n;a++)o++;for(let a=1;i<this.height&&this.map[t+this.width*a]==n;a++)i++;return{left:r,top:s,right:o,bottom:i}}throw new RangeError(`No cell with offset ${e} found`)}colCount(e){for(let t=0;t<this.map.length;t++)if(this.map[t]==e)return t%this.width;throw new RangeError(`No cell with offset ${e} found`)}nextCell(e,t,n){const{left:r,right:s,top:o,bottom:i}=this.findCell(e);return t=="horiz"?(n<0?r==0:s==this.width)?null:this.map[o*this.width+(n<0?r-1:s)]:(n<0?o==0:i==this.height)?null:this.map[r+this.width*(n<0?o-1:i)]}rectBetween(e,t){const{left:n,right:r,top:s,bottom:o}=this.findCell(e),{left:i,right:a,top:c,bottom:d}=this.findCell(t);return{left:Math.min(n,i),top:Math.min(s,c),right:Math.max(r,a),bottom:Math.max(o,d)}}cellsInRect(e){const t=[],n={};for(let r=e.top;r<e.bottom;r++)for(let s=e.left;s<e.right;s++){const o=r*this.width+s,i=this.map[o];n[i]||(n[i]=!0,!(s==e.left&&s&&this.map[o-1]==i||r==e.top&&r&&this.map[o-this.width]==i)&&t.push(i))}return t}positionAt(e,t,n){for(let r=0,s=0;;r++){const o=s+n.child(r).nodeSize;if(r==e){let i=t+e*this.width;const a=(e+1)*this.width;for(;i<a&&this.map[i]<s;)i++;return i==a?o-1:this.map[i]}s=o}}static get(e){return kn(e)||An(e,ba(e))}};function ba(e){if(e.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+e.type.name);const t=ya(e),n=e.childCount,r=[];let s=0,o=null;const i=[];for(let d=0,u=t*n;d<u;d++)r[d]=0;for(let d=0,u=0;d<n;d++){const h=e.child(d);u++;for(let m=0;;m++){for(;s<r.length&&r[s]!=0;)s++;if(m==h.childCount)break;const b=h.child(m),{colspan:g,rowspan:y,colwidth:v}=b.attrs;for(let E=0;E<y;E++){if(E+d>=n){(o||(o=[])).push({type:"overlong_rowspan",pos:u,n:y-E});break}const R=s+E*t;for(let T=0;T<g;T++){r[R+T]==0?r[R+T]=u:(o||(o=[])).push({type:"collision",row:d,pos:u,n:g-T});const H=v&&v[T];if(H){const M=(R+T)%t*2,$=i[M];$==null||$!=H&&i[M+1]==1?(i[M]=H,i[M+1]=1):$==H&&i[M+1]++}}}s+=g,u+=b.nodeSize}const f=(d+1)*t;let p=0;for(;s<f;)r[s++]==0&&p++;p&&(o||(o=[])).push({type:"missing",row:d,n:p}),u++}const a=new P(t,n,r,o);let c=!1;for(let d=0;!c&&d<i.length;d+=2)i[d]!=null&&i[d+1]<n&&(c=!0);return c&&wa(a,i,e),a}function ya(e){let t=-1,n=!1;for(let r=0;r<e.childCount;r++){const s=e.child(r);let o=0;if(n)for(let i=0;i<r;i++){const a=e.child(i);for(let c=0;c<a.childCount;c++){const d=a.child(c);i+d.attrs.rowspan>r&&(o+=d.attrs.colspan)}}for(let i=0;i<s.childCount;i++){const a=s.child(i);o+=a.attrs.colspan,a.attrs.rowspan>1&&(n=!0)}t==-1?t=o:t!=o&&(t=Math.max(t,o))}return t}function wa(e,t,n){e.problems||(e.problems=[]);const r={};for(let s=0;s<e.map.length;s++){const o=e.map[s];if(r[o])continue;r[o]=!0;const i=n.nodeAt(o);if(!i)throw new RangeError(`No cell with offset ${o} found`);let a=null;const c=i.attrs;for(let d=0;d<c.colspan;d++){const u=(s+d)%e.width,h=t[u*2];h!=null&&(!c.colwidth||c.colwidth[d]!=h)&&((a||(a=va(c)))[d]=h)}a&&e.problems.unshift({type:"colwidth mismatch",pos:o,colwidth:a})}}function va(e){if(e.colwidth)return e.colwidth.slice();const t=[];for(let n=0;n<e.colspan;n++)t.push(0);return t}function V(e){let t=e.cached.tableNodeTypes;if(!t){t=e.cached.tableNodeTypes={};for(const n in e.nodes){const r=e.nodes[n],s=r.spec.tableRole;s&&(t[s]=r)}}return t}var je=new ae("selectingCells");function Be(e){for(let t=e.depth-1;t>0;t--)if(e.node(t).type.spec.tableRole=="row")return e.node(0).resolve(e.before(t+1));return null}function Ca(e){for(let t=e.depth;t>0;t--){const n=e.node(t).type.spec.tableRole;if(n==="cell"||n==="header_cell")return e.node(t)}return null}function se(e){const t=e.selection.$head;for(let n=t.depth;n>0;n--)if(t.node(n).type.spec.tableRole=="row")return!0;return!1}function nn(e){const t=e.selection;if("$anchorCell"in t&&t.$anchorCell)return t.$anchorCell.pos>t.$headCell.pos?t.$anchorCell:t.$headCell;if("node"in t&&t.node&&t.node.type.spec.tableRole=="cell")return t.$anchor;const n=Be(t.$head)||ja(t.$head);if(n)return n;throw new RangeError(`No cell found around position ${t.head}`)}function ja(e){for(let t=e.nodeAfter,n=e.pos;t;t=t.firstChild,n++){const r=t.type.spec.tableRole;if(r=="cell"||r=="header_cell")return e.doc.resolve(n)}for(let t=e.nodeBefore,n=e.pos;t;t=t.lastChild,n--){const r=t.type.spec.tableRole;if(r=="cell"||r=="header_cell")return e.doc.resolve(n-t.nodeSize)}}function Tn(e){return e.parent.type.spec.tableRole=="row"&&!!e.nodeAfter}function ka(e){return e.node(0).resolve(e.pos+e.nodeAfter.nodeSize)}function er(e,t){return e.depth==t.depth&&e.pos>=t.start(-1)&&e.pos<=t.end(-1)}function Rs(e,t,n){const r=e.node(-1),s=P.get(r),o=e.start(-1),i=s.nextCell(e.pos-o,t,n);return i==null?null:e.node(0).resolve(o+i)}function Me(e,t,n=1){const r=N(j({},e),{colspan:e.colspan-n});return r.colwidth&&(r.colwidth=r.colwidth.slice(),r.colwidth.splice(t,n),r.colwidth.some(s=>s>0)||(r.colwidth=null)),r}function Ms(e,t,n=1){const r=N(j({},e),{colspan:e.colspan+n});if(r.colwidth){r.colwidth=r.colwidth.slice();for(let s=0;s<n;s++)r.colwidth.splice(t,0,0)}return r}function Aa(e,t,n){const r=V(t.type.schema).header_cell;for(let s=0;s<e.height;s++)if(t.nodeAt(e.map[n+s*e.width]).type!=r)return!1;return!0}var L=class me extends ge{constructor(t,n=t){const r=t.node(-1),s=P.get(r),o=t.start(-1),i=s.rectBetween(t.pos-o,n.pos-o),a=t.node(0),c=s.cellsInRect(i).filter(u=>u!=n.pos-o);c.unshift(n.pos-o);const d=c.map(u=>{const h=r.nodeAt(u);if(!h)throw RangeError(`No cell with offset ${u} found`);const f=o+u+1;return new di(a.resolve(f),a.resolve(f+h.content.size))});super(d[0].$from,d[0].$to,d),this.$anchorCell=t,this.$headCell=n}map(t,n){const r=t.resolve(n.map(this.$anchorCell.pos)),s=t.resolve(n.map(this.$headCell.pos));if(Tn(r)&&Tn(s)&&er(r,s)){const o=this.$anchorCell.node(-1)!=r.node(-1);return o&&this.isRowSelection()?me.rowSelection(r,s):o&&this.isColSelection()?me.colSelection(r,s):new me(r,s)}return ke.between(r,s)}content(){const t=this.$anchorCell.node(-1),n=P.get(t),r=this.$anchorCell.start(-1),s=n.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r),o={},i=[];for(let c=s.top;c<s.bottom;c++){const d=[];for(let u=c*n.width+s.left,h=s.left;h<s.right;h++,u++){const f=n.map[u];if(o[f])continue;o[f]=!0;const p=n.findCell(f);let m=t.nodeAt(f);if(!m)throw RangeError(`No cell with offset ${f} found`);const b=s.left-p.left,g=p.right-s.right;if(b>0||g>0){let y=m.attrs;if(b>0&&(y=Me(y,0,b)),g>0&&(y=Me(y,y.colspan-g,g)),p.left<s.left){if(m=m.type.createAndFill(y),!m)throw RangeError(`Could not create cell with attrs ${JSON.stringify(y)}`)}else m=m.type.create(y,m.content)}if(p.top<s.top||p.bottom>s.bottom){const y=N(j({},m.attrs),{rowspan:Math.min(p.bottom,s.bottom)-Math.max(p.top,s.top)});p.top<s.top?m=m.type.createAndFill(y):m=m.type.create(y,m.content)}d.push(m)}i.push(t.child(c).copy(le.from(d)))}const a=this.isColSelection()&&this.isRowSelection()?t:i;return new Ae(le.from(a),1,1)}replace(t,n=Ae.empty){const r=t.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){const{$from:a,$to:c}=s[i],d=t.mapping.slice(r);t.replace(d.map(a.pos),d.map(c.pos),i?Ae.empty:n)}const o=ge.findFrom(t.doc.resolve(t.mapping.slice(r).map(this.to)),-1);o&&t.setSelection(o)}replaceWith(t,n){this.replace(t,new Ae(le.from(n),0,0))}forEachCell(t){const n=this.$anchorCell.node(-1),r=P.get(n),s=this.$anchorCell.start(-1),o=r.cellsInRect(r.rectBetween(this.$anchorCell.pos-s,this.$headCell.pos-s));for(let i=0;i<o.length;i++)t(n.nodeAt(o[i]),s+o[i])}isColSelection(){const t=this.$anchorCell.index(-1),n=this.$headCell.index(-1);if(Math.min(t,n)>0)return!1;const r=t+this.$anchorCell.nodeAfter.attrs.rowspan,s=n+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(r,s)==this.$headCell.node(-1).childCount}static colSelection(t,n=t){const r=t.node(-1),s=P.get(r),o=t.start(-1),i=s.findCell(t.pos-o),a=s.findCell(n.pos-o),c=t.node(0);return i.top<=a.top?(i.top>0&&(t=c.resolve(o+s.map[i.left])),a.bottom<s.height&&(n=c.resolve(o+s.map[s.width*(s.height-1)+a.right-1]))):(a.top>0&&(n=c.resolve(o+s.map[a.left])),i.bottom<s.height&&(t=c.resolve(o+s.map[s.width*(s.height-1)+i.right-1]))),new me(t,n)}isRowSelection(){const t=this.$anchorCell.node(-1),n=P.get(t),r=this.$anchorCell.start(-1),s=n.colCount(this.$anchorCell.pos-r),o=n.colCount(this.$headCell.pos-r);if(Math.min(s,o)>0)return!1;const i=s+this.$anchorCell.nodeAfter.attrs.colspan,a=o+this.$headCell.nodeAfter.attrs.colspan;return Math.max(i,a)==n.width}eq(t){return t instanceof me&&t.$anchorCell.pos==this.$anchorCell.pos&&t.$headCell.pos==this.$headCell.pos}static rowSelection(t,n=t){const r=t.node(-1),s=P.get(r),o=t.start(-1),i=s.findCell(t.pos-o),a=s.findCell(n.pos-o),c=t.node(0);return i.left<=a.left?(i.left>0&&(t=c.resolve(o+s.map[i.top*s.width])),a.right<s.width&&(n=c.resolve(o+s.map[s.width*(a.top+1)-1]))):(a.left>0&&(n=c.resolve(o+s.map[a.top*s.width])),i.right<s.width&&(t=c.resolve(o+s.map[s.width*(i.top+1)-1]))),new me(t,n)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(t,n){return new me(t.resolve(n.anchor),t.resolve(n.head))}static create(t,n,r=n){return new me(t.resolve(n),t.resolve(r))}getBookmark(){return new Ta(this.$anchorCell.pos,this.$headCell.pos)}};L.prototype.visible=!1;ge.jsonID("cell",L);var Ta=class Ls{constructor(t,n){this.anchor=t,this.head=n}map(t){return new Ls(t.map(this.anchor),t.map(this.head))}resolve(t){const n=t.resolve(this.anchor),r=t.resolve(this.head);return n.parent.type.spec.tableRole=="row"&&r.parent.type.spec.tableRole=="row"&&n.index()<n.parent.childCount&&r.index()<r.parent.childCount&&er(n,r)?new L(n,r):ge.near(r,1)}};function Na(e){if(!(e.selection instanceof L))return null;const t=[];return e.selection.forEachCell((n,r)=>{t.push(yt.node(r,r+n.nodeSize,{class:"selectedCell"}))}),bt.create(e.doc,t)}function Sa({$from:e,$to:t}){if(e.pos==t.pos||e.pos<t.pos-6)return!1;let n=e.pos,r=t.pos,s=e.depth;for(;s>=0&&!(e.after(s+1)<e.end(s));s--,n++);for(let o=t.depth;o>=0&&!(t.before(o+1)>t.start(o));o--,r--);return n==r&&/row|table/.test(e.node(s).type.spec.tableRole)}function Ea({$from:e,$to:t}){let n,r;for(let s=e.depth;s>0;s--){const o=e.node(s);if(o.type.spec.tableRole==="cell"||o.type.spec.tableRole==="header_cell"){n=o;break}}for(let s=t.depth;s>0;s--){const o=t.node(s);if(o.type.spec.tableRole==="cell"||o.type.spec.tableRole==="header_cell"){r=o;break}}return n!==r&&t.parentOffset===0}function Ra(e,t,n){const r=(t||e).selection,s=(t||e).doc;let o,i;if(r instanceof ui&&(i=r.node.type.spec.tableRole)){if(i=="cell"||i=="header_cell")o=L.create(s,r.from);else if(i=="row"){const a=s.resolve(r.from+1);o=L.rowSelection(a,a)}else if(!n){const a=P.get(r.node),c=r.from+1,d=c+a.map[a.width*a.height-1];o=L.create(s,c+1,d)}}else r instanceof ke&&Sa(r)?o=ke.create(s,r.from):r instanceof ke&&Ea(r)&&(o=ke.create(s,r.$from.start(),r.$from.end()));return o&&(t||(t=e.tr)).setSelection(o),t}var Ma=new ae("fix-tables");function _s(e,t,n,r){const s=e.childCount,o=t.childCount;e:for(let i=0,a=0;i<o;i++){const c=t.child(i);for(let d=a,u=Math.min(s,i+3);d<u;d++)if(e.child(d)==c){a=d+1,n+=c.nodeSize;continue e}r(c,n),a<s&&e.child(a).sameMarkup(c)?_s(e.child(a),c,n+1,r):c.nodesBetween(0,c.content.size,r,n+1),n+=c.nodeSize}}function Os(e,t){let n;const r=(s,o)=>{s.type.spec.tableRole=="table"&&(n=La(e,s,o,n))};return t?t.doc!=e.doc&&_s(t.doc,e.doc,0,r):e.doc.descendants(r),n}function La(e,t,n,r){const s=P.get(t);if(!s.problems)return r;r||(r=e.tr);const o=[];for(let c=0;c<s.height;c++)o.push(0);for(let c=0;c<s.problems.length;c++){const d=s.problems[c];if(d.type=="collision"){const u=t.nodeAt(d.pos);if(!u)continue;const h=u.attrs;for(let f=0;f<h.rowspan;f++)o[d.row+f]+=d.n;r.setNodeMarkup(r.mapping.map(n+1+d.pos),null,Me(h,h.colspan-d.n,d.n))}else if(d.type=="missing")o[d.row]+=d.n;else if(d.type=="overlong_rowspan"){const u=t.nodeAt(d.pos);if(!u)continue;r.setNodeMarkup(r.mapping.map(n+1+d.pos),null,N(j({},u.attrs),{rowspan:u.attrs.rowspan-d.n}))}else if(d.type=="colwidth mismatch"){const u=t.nodeAt(d.pos);if(!u)continue;r.setNodeMarkup(r.mapping.map(n+1+d.pos),null,N(j({},u.attrs),{colwidth:d.colwidth}))}}let i,a;for(let c=0;c<o.length;c++)o[c]&&(i==null&&(i=c),a=c);for(let c=0,d=n+1;c<s.height;c++){const u=t.child(c),h=d+u.nodeSize,f=o[c];if(f>0){let p="cell";u.firstChild&&(p=u.firstChild.type.spec.tableRole);const m=[];for(let g=0;g<f;g++){const y=V(e.schema)[p].createAndFill();y&&m.push(y)}const b=(c==0||i==c-1)&&a==c?d+1:h-1;r.insert(r.mapping.map(b),m)}d=h}return r.setMeta(Ma,{fixTables:!0})}function ce(e){const t=e.selection,n=nn(e),r=n.node(-1),s=n.start(-1),o=P.get(r),i=t instanceof L?o.rectBetween(t.$anchorCell.pos-s,t.$headCell.pos-s):o.findCell(n.pos-s);return N(j({},i),{tableStart:s,map:o,table:r})}function Hs(e,{map:t,tableStart:n,table:r},s){let o=s>0?-1:0;Aa(t,r,s+o)&&(o=s==0||s==t.width?null:0);for(let i=0;i<t.height;i++){const a=i*t.width+s;if(s>0&&s<t.width&&t.map[a-1]==t.map[a]){const c=t.map[a],d=r.nodeAt(c);e.setNodeMarkup(e.mapping.map(n+c),null,Ms(d.attrs,s-t.colCount(c))),i+=d.attrs.rowspan-1}else{const c=o==null?V(r.type.schema).cell:r.nodeAt(t.map[a+o]).type,d=t.positionAt(i,s,r);e.insert(e.mapping.map(n+d),c.createAndFill())}}return e}function _a(e,t){if(!se(e))return!1;if(t){const n=ce(e);t(Hs(e.tr,n,n.left))}return!0}function Oa(e,t){if(!se(e))return!1;if(t){const n=ce(e);t(Hs(e.tr,n,n.right))}return!0}function Ha(e,{map:t,table:n,tableStart:r},s){const o=e.mapping.maps.length;for(let i=0;i<t.height;){const a=i*t.width+s,c=t.map[a],d=n.nodeAt(c),u=d.attrs;if(s>0&&t.map[a-1]==c||s<t.width-1&&t.map[a+1]==c)e.setNodeMarkup(e.mapping.slice(o).map(r+c),null,Me(u,s-t.colCount(c)));else{const h=e.mapping.slice(o).map(r+c);e.delete(h,h+d.nodeSize)}i+=u.rowspan}}function za(e,t){if(!se(e))return!1;if(t){const n=ce(e),r=e.tr;if(n.left==0&&n.right==n.map.width)return!1;for(let s=n.right-1;Ha(r,n,s),s!=n.left;s--){const o=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!o)throw RangeError("No table found");n.table=o,n.map=P.get(o)}t(r)}return!0}function Da(e,t,n){var r;const s=V(t.type.schema).header_cell;for(let o=0;o<e.width;o++)if(((r=t.nodeAt(e.map[o+n*e.width]))==null?void 0:r.type)!=s)return!1;return!0}function zs(e,{map:t,tableStart:n,table:r},s){var o;let i=n;for(let d=0;d<s;d++)i+=r.child(d).nodeSize;const a=[];let c=s>0?-1:0;Da(t,r,s+c)&&(c=s==0||s==t.height?null:0);for(let d=0,u=t.width*s;d<t.width;d++,u++)if(s>0&&s<t.height&&t.map[u]==t.map[u-t.width]){const h=t.map[u],f=r.nodeAt(h).attrs;e.setNodeMarkup(n+h,null,N(j({},f),{rowspan:f.rowspan+1})),d+=f.colspan-1}else{const h=c==null?V(r.type.schema).cell:(o=r.nodeAt(t.map[u+c*t.width]))==null?void 0:o.type,f=h==null?void 0:h.createAndFill();f&&a.push(f)}return e.insert(i,V(r.type.schema).row.create(null,a)),e}function Ia(e,t){if(!se(e))return!1;if(t){const n=ce(e);t(zs(e.tr,n,n.top))}return!0}function Pa(e,t){if(!se(e))return!1;if(t){const n=ce(e);t(zs(e.tr,n,n.bottom))}return!0}function Ba(e,{map:t,table:n,tableStart:r},s){let o=0;for(let d=0;d<s;d++)o+=n.child(d).nodeSize;const i=o+n.child(s).nodeSize,a=e.mapping.maps.length;e.delete(o+r,i+r);const c=new Set;for(let d=0,u=s*t.width;d<t.width;d++,u++){const h=t.map[u];if(!c.has(h)){if(c.add(h),s>0&&h==t.map[u-t.width]){const f=n.nodeAt(h).attrs;e.setNodeMarkup(e.mapping.slice(a).map(h+r),null,N(j({},f),{rowspan:f.rowspan-1})),d+=f.colspan-1}else if(s<t.height&&h==t.map[u+t.width]){const f=n.nodeAt(h),p=f.attrs,m=f.type.create(N(j({},p),{rowspan:f.attrs.rowspan-1}),f.content),b=t.positionAt(s+1,d,n);e.insert(e.mapping.slice(a).map(r+b),m),d+=p.colspan-1}}}}function $a(e,t){if(!se(e))return!1;if(t){const n=ce(e),r=e.tr;if(n.top==0&&n.bottom==n.map.height)return!1;for(let s=n.bottom-1;Ba(r,n,s),s!=n.top;s--){const o=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!o)throw RangeError("No table found");n.table=o,n.map=P.get(n.table)}t(r)}return!0}function vr(e){const t=e.content;return t.childCount==1&&t.child(0).isTextblock&&t.child(0).childCount==0}function Fa({width:e,height:t,map:n},r){let s=r.top*e+r.left,o=s,i=(r.bottom-1)*e+r.left,a=s+(r.right-r.left-1);for(let c=r.top;c<r.bottom;c++){if(r.left>0&&n[o]==n[o-1]||r.right<e&&n[a]==n[a+1])return!0;o+=e,a+=e}for(let c=r.left;c<r.right;c++){if(r.top>0&&n[s]==n[s-e]||r.bottom<t&&n[i]==n[i+e])return!0;s++,i++}return!1}function Cr(e,t){const n=e.selection;if(!(n instanceof L)||n.$anchorCell.pos==n.$headCell.pos)return!1;const r=ce(e),{map:s}=r;if(Fa(s,r))return!1;if(t){const o=e.tr,i={};let a=le.empty,c,d;for(let u=r.top;u<r.bottom;u++)for(let h=r.left;h<r.right;h++){const f=s.map[u*s.width+h],p=r.table.nodeAt(f);if(!(i[f]||!p))if(i[f]=!0,c==null)c=f,d=p;else{vr(p)||(a=a.append(p.content));const m=o.mapping.map(f+r.tableStart);o.delete(m,m+p.nodeSize)}}if(c==null||d==null)return!0;if(o.setNodeMarkup(c+r.tableStart,null,N(j({},Ms(d.attrs,d.attrs.colspan,r.right-r.left-d.attrs.colspan)),{rowspan:r.bottom-r.top})),a.size){const u=c+1+d.content.size,h=vr(d)?c+1:u;o.replaceWith(h+r.tableStart,u+r.tableStart,a)}o.setSelection(new L(o.doc.resolve(c+r.tableStart))),t(o)}return!0}function jr(e,t){const n=V(e.schema);return Ua(({node:r})=>n[r.type.spec.tableRole])(e,t)}function Ua(e){return(t,n)=>{var r;const s=t.selection;let o,i;if(s instanceof L){if(s.$anchorCell.pos!=s.$headCell.pos)return!1;o=s.$anchorCell.nodeAfter,i=s.$anchorCell.pos}else{if(o=Ca(s.$from),!o)return!1;i=(r=Be(s.$from))==null?void 0:r.pos}if(o==null||i==null||o.attrs.colspan==1&&o.attrs.rowspan==1)return!1;if(n){let a=o.attrs;const c=[],d=a.colwidth;a.rowspan>1&&(a=N(j({},a),{rowspan:1})),a.colspan>1&&(a=N(j({},a),{colspan:1}));const u=ce(t),h=t.tr;for(let p=0;p<u.right-u.left;p++)c.push(d?N(j({},a),{colwidth:d&&d[p]?[d[p]]:null}):a);let f;for(let p=u.top;p<u.bottom;p++){let m=u.map.positionAt(p,u.left,u.table);p==u.top&&(m+=o.nodeSize);for(let b=u.left,g=0;b<u.right;b++,g++)b==u.left&&p==u.top||h.insert(f=h.mapping.map(m+u.tableStart,1),e({node:o,row:p,col:b}).createAndFill(c[g]))}h.setNodeMarkup(i,e({node:o,row:u.top,col:u.left}),c[0]),s instanceof L&&h.setSelection(new L(h.doc.resolve(s.$anchorCell.pos),f?h.doc.resolve(f):void 0)),n(h)}return!0}}function Wa(e,t){return function(n,r){if(!se(n))return!1;const s=nn(n);if(s.nodeAfter.attrs[e]===t)return!1;if(r){const o=n.tr;n.selection instanceof L?n.selection.forEachCell((i,a)=>{i.attrs[e]!==t&&o.setNodeMarkup(a,null,N(j({},i.attrs),{[e]:t}))}):o.setNodeMarkup(s.pos,null,N(j({},s.nodeAfter.attrs),{[e]:t})),r(o)}return!0}}function Va(e){return function(t,n){if(!se(t))return!1;if(n){const r=V(t.schema),s=ce(t),o=t.tr,i=s.map.cellsInRect(e=="column"?{left:s.left,top:0,right:s.right,bottom:s.map.height}:e=="row"?{left:0,top:s.top,right:s.map.width,bottom:s.bottom}:s),a=i.map(c=>s.table.nodeAt(c));for(let c=0;c<i.length;c++)a[c].type==r.header_cell&&o.setNodeMarkup(s.tableStart+i[c],r.cell,a[c].attrs);if(o.steps.length==0)for(let c=0;c<i.length;c++)o.setNodeMarkup(s.tableStart+i[c],r.header_cell,a[c].attrs);n(o)}return!0}}function kr(e,t,n){const r=t.map.cellsInRect({left:0,top:0,right:e=="row"?t.map.width:1,bottom:e=="column"?t.map.height:1});for(let s=0;s<r.length;s++){const o=t.table.nodeAt(r[s]);if(o&&o.type!==n.header_cell)return!1}return!0}function Ze(e,t){return t=t||{useDeprecatedLogic:!1},t.useDeprecatedLogic?Va(e):function(n,r){if(!se(n))return!1;if(r){const s=V(n.schema),o=ce(n),i=n.tr,a=kr("row",o,s),c=kr("column",o,s),u=(e==="column"?a:e==="row"?c:!1)?1:0,h=e=="column"?{left:0,top:u,right:1,bottom:o.map.height}:e=="row"?{left:u,top:0,right:o.map.width,bottom:1}:o,f=e=="column"?c?s.cell:s.header_cell:e=="row"?a?s.cell:s.header_cell:s.cell;o.map.cellsInRect(h).forEach(p=>{const m=p+o.tableStart,b=i.doc.nodeAt(m);b&&i.setNodeMarkup(m,f,b.attrs)}),r(i)}return!0}}Ze("row",{useDeprecatedLogic:!0});Ze("column",{useDeprecatedLogic:!0});var Ka=Ze("cell",{useDeprecatedLogic:!0});function Ya(e,t){if(t<0){const n=e.nodeBefore;if(n)return e.pos-n.nodeSize;for(let r=e.index(-1)-1,s=e.before();r>=0;r--){const o=e.node(-1).child(r),i=o.lastChild;if(i)return s-1-i.nodeSize;s-=o.nodeSize}}else{if(e.index()<e.parent.childCount-1)return e.pos+e.nodeAfter.nodeSize;const n=e.node(-1);for(let r=e.indexAfter(-1),s=e.after();r<n.childCount;r++){const o=n.child(r);if(o.childCount)return s+1;s+=o.nodeSize}}return null}function Ar(e){return function(t,n){if(!se(t))return!1;const r=Ya(nn(t),e);if(r==null)return!1;if(n){const s=t.doc.resolve(r);n(t.tr.setSelection(ke.between(s,ka(s))).scrollIntoView())}return!0}}function qa(e,t){const n=e.selection.$anchor;for(let r=n.depth;r>0;r--)if(n.node(r).type.spec.tableRole=="table")return t&&t(e.tr.delete(n.before(r),n.after(r)).scrollIntoView()),!0;return!1}function ct(e,t){const n=e.selection;if(!(n instanceof L))return!1;if(t){const r=e.tr,s=V(e.schema).cell.createAndFill().content;n.forEachCell((o,i)=>{o.content.eq(s)||r.replace(r.mapping.map(i+1),r.mapping.map(i+o.nodeSize-1),new Ae(s,0,0))}),r.docChanged&&t(r)}return!0}function Ga(e){if(!e.size)return null;let{content:t,openStart:n,openEnd:r}=e;for(;t.childCount==1&&(n>0&&r>0||t.child(0).type.spec.tableRole=="table");)n--,r--,t=t.child(0).content;const s=t.child(0),o=s.type.spec.tableRole,i=s.type.schema,a=[];if(o=="row")for(let c=0;c<t.childCount;c++){let d=t.child(c).content;const u=c?0:Math.max(0,n-1),h=c<t.childCount-1?0:Math.max(0,r-1);(u||h)&&(d=Nn(V(i).row,new Ae(d,u,h)).content),a.push(d)}else if(o=="cell"||o=="header_cell")a.push(n||r?Nn(V(i).row,new Ae(t,n,r)).content:t);else return null;return Qa(i,a)}function Qa(e,t){const n=[];for(let s=0;s<t.length;s++){const o=t[s];for(let i=o.childCount-1;i>=0;i--){const{rowspan:a,colspan:c}=o.child(i).attrs;for(let d=s;d<s+a;d++)n[d]=(n[d]||0)+c}}let r=0;for(let s=0;s<n.length;s++)r=Math.max(r,n[s]);for(let s=0;s<n.length;s++)if(s>=t.length&&t.push(le.empty),n[s]<r){const o=V(e).cell.createAndFill(),i=[];for(let a=n[s];a<r;a++)i.push(o);t[s]=t[s].append(le.from(i))}return{height:t.length,width:r,rows:t}}function Nn(e,t){const n=e.createAndFill();return new hi(n).replace(0,n.content.size,t).doc}function Ja({width:e,height:t,rows:n},r,s){if(e!=r){const o=[],i=[];for(let a=0;a<n.length;a++){const c=n[a],d=[];for(let u=o[a]||0,h=0;u<r;h++){let f=c.child(h%c.childCount);u+f.attrs.colspan>r&&(f=f.type.createChecked(Me(f.attrs,f.attrs.colspan,u+f.attrs.colspan-r),f.content)),d.push(f),u+=f.attrs.colspan;for(let p=1;p<f.attrs.rowspan;p++)o[a+p]=(o[a+p]||0)+f.attrs.colspan}i.push(le.from(d))}n=i,e=r}if(t!=s){const o=[];for(let i=0,a=0;i<s;i++,a++){const c=[],d=n[a%t];for(let u=0;u<d.childCount;u++){let h=d.child(u);i+h.attrs.rowspan>s&&(h=h.type.create(N(j({},h.attrs),{rowspan:Math.max(1,s-h.attrs.rowspan)}),h.content)),c.push(h)}o.push(le.from(c))}n=o,t=s}return{width:e,height:t,rows:n}}function Xa(e,t,n,r,s,o,i){const a=e.doc.type.schema,c=V(a);let d,u;if(s>t.width)for(let h=0,f=0;h<t.height;h++){const p=n.child(h);f+=p.nodeSize;const m=[];let b;p.lastChild==null||p.lastChild.type==c.cell?b=d||(d=c.cell.createAndFill()):b=u||(u=c.header_cell.createAndFill());for(let g=t.width;g<s;g++)m.push(b);e.insert(e.mapping.slice(i).map(f-1+r),m)}if(o>t.height){const h=[];for(let m=0,b=(t.height-1)*t.width;m<Math.max(t.width,s);m++){const g=m>=t.width?!1:n.nodeAt(t.map[b+m]).type==c.header_cell;h.push(g?u||(u=c.header_cell.createAndFill()):d||(d=c.cell.createAndFill()))}const f=c.row.create(null,le.from(h)),p=[];for(let m=t.height;m<o;m++)p.push(f);e.insert(e.mapping.slice(i).map(r+n.nodeSize-2),p)}return!!(d||u)}function Tr(e,t,n,r,s,o,i,a){if(i==0||i==t.height)return!1;let c=!1;for(let d=s;d<o;d++){const u=i*t.width+d,h=t.map[u];if(t.map[u-t.width]==h){c=!0;const f=n.nodeAt(h),{top:p,left:m}=t.findCell(h);e.setNodeMarkup(e.mapping.slice(a).map(h+r),null,N(j({},f.attrs),{rowspan:i-p})),e.insert(e.mapping.slice(a).map(t.positionAt(i,m,n)),f.type.createAndFill(N(j({},f.attrs),{rowspan:p+f.attrs.rowspan-i}))),d+=f.attrs.colspan-1}}return c}function Nr(e,t,n,r,s,o,i,a){if(i==0||i==t.width)return!1;let c=!1;for(let d=s;d<o;d++){const u=d*t.width+i,h=t.map[u];if(t.map[u-1]==h){c=!0;const f=n.nodeAt(h),p=t.colCount(h),m=e.mapping.slice(a).map(h+r);e.setNodeMarkup(m,null,Me(f.attrs,i-p,f.attrs.colspan-(i-p))),e.insert(m+f.nodeSize,f.type.createAndFill(Me(f.attrs,0,i-p))),d+=f.attrs.rowspan-1}}return c}function Sr(e,t,n,r,s){let o=n?e.doc.nodeAt(n-1):e.doc;if(!o)throw new Error("No table found");let i=P.get(o);const{top:a,left:c}=r,d=c+s.width,u=a+s.height,h=e.tr;let f=0;function p(){if(o=n?h.doc.nodeAt(n-1):h.doc,!o)throw new Error("No table found");i=P.get(o),f=h.mapping.maps.length}Xa(h,i,o,n,d,u,f)&&p(),Tr(h,i,o,n,c,d,a,f)&&p(),Tr(h,i,o,n,c,d,u,f)&&p(),Nr(h,i,o,n,a,u,c,f)&&p(),Nr(h,i,o,n,a,u,d,f)&&p();for(let m=a;m<u;m++){const b=i.positionAt(m,c,o),g=i.positionAt(m,d,o);h.replace(h.mapping.slice(f).map(b+n),h.mapping.slice(f).map(g+n),new Ae(s.rows[m-a],0,0))}p(),h.setSelection(new L(h.doc.resolve(n+i.positionAt(a,c,o)),h.doc.resolve(n+i.positionAt(u-1,d-1,o)))),t(h)}var Za=ci({ArrowLeft:dt("horiz",-1),ArrowRight:dt("horiz",1),ArrowUp:dt("vert",-1),ArrowDown:dt("vert",1),"Shift-ArrowLeft":ut("horiz",-1),"Shift-ArrowRight":ut("horiz",1),"Shift-ArrowUp":ut("vert",-1),"Shift-ArrowDown":ut("vert",1),Backspace:ct,"Mod-Backspace":ct,Delete:ct,"Mod-Delete":ct});function mt(e,t,n){return n.eq(e.selection)?!1:(t&&t(e.tr.setSelection(n).scrollIntoView()),!0)}function dt(e,t){return(n,r,s)=>{if(!s)return!1;const o=n.selection;if(o instanceof L)return mt(n,r,ge.near(o.$headCell,t));if(e!="horiz"&&!o.empty)return!1;const i=Ds(s,e,t);if(i==null)return!1;if(e=="horiz")return mt(n,r,ge.near(n.doc.resolve(o.head+t),t));{const a=n.doc.resolve(i),c=Rs(a,e,t);let d;return c?d=ge.near(c,1):t<0?d=ge.near(n.doc.resolve(a.before(-1)),-1):d=ge.near(n.doc.resolve(a.after(-1)),1),mt(n,r,d)}}}function ut(e,t){return(n,r,s)=>{if(!s)return!1;const o=n.selection;let i;if(o instanceof L)i=o;else{const c=Ds(s,e,t);if(c==null)return!1;i=new L(n.doc.resolve(c))}const a=Rs(i.$headCell,e,t);return a?mt(n,r,new L(i.$anchorCell,a)):!1}}function ec(e,t){const n=e.state.doc,r=Be(n.resolve(t));return r?(e.dispatch(e.state.tr.setSelection(new L(r))),!0):!1}function tc(e,t,n){if(!se(e.state))return!1;let r=Ga(n);const s=e.state.selection;if(s instanceof L){r||(r={width:1,height:1,rows:[le.from(Nn(V(e.state.schema).cell,n))]});const o=s.$anchorCell.node(-1),i=s.$anchorCell.start(-1),a=P.get(o).rectBetween(s.$anchorCell.pos-i,s.$headCell.pos-i);return r=Ja(r,a.right-a.left,a.bottom-a.top),Sr(e.state,e.dispatch,i,a,r),!0}else if(r){const o=nn(e.state),i=o.start(-1);return Sr(e.state,e.dispatch,i,P.get(o.node(-1)).findCell(o.pos-i),r),!0}else return!1}function nc(e,t){var n;if(t.ctrlKey||t.metaKey)return;const r=Er(e,t.target);let s;if(t.shiftKey&&e.state.selection instanceof L)o(e.state.selection.$anchorCell,t),t.preventDefault();else if(t.shiftKey&&r&&(s=Be(e.state.selection.$anchor))!=null&&((n=fn(e,t))==null?void 0:n.pos)!=s.pos)o(s,t),t.preventDefault();else if(!r)return;function o(c,d){let u=fn(e,d);const h=je.getState(e.state)==null;if(!u||!er(c,u))if(h)u=c;else return;const f=new L(c,u);if(h||!e.state.selection.eq(f)){const p=e.state.tr.setSelection(f);h&&p.setMeta(je,c.pos),e.dispatch(p)}}function i(){e.root.removeEventListener("mouseup",i),e.root.removeEventListener("dragstart",i),e.root.removeEventListener("mousemove",a),je.getState(e.state)!=null&&e.dispatch(e.state.tr.setMeta(je,-1))}function a(c){const d=c,u=je.getState(e.state);let h;if(u!=null)h=e.state.doc.resolve(u);else if(Er(e,d.target)!=r&&(h=fn(e,t),!h))return i();h&&o(h,d)}e.root.addEventListener("mouseup",i),e.root.addEventListener("dragstart",i),e.root.addEventListener("mousemove",a)}function Ds(e,t,n){if(!(e.state.selection instanceof ke))return null;const{$head:r}=e.state.selection;for(let s=r.depth-1;s>=0;s--){const o=r.node(s);if((n<0?r.index(s):r.indexAfter(s))!=(n<0?0:o.childCount))return null;if(o.type.spec.tableRole=="cell"||o.type.spec.tableRole=="header_cell"){const a=r.before(s),c=t=="vert"?n>0?"down":"up":n>0?"right":"left";return e.endOfTextblock(c)?a:null}}return null}function Er(e,t){for(;t&&t!=e.dom;t=t.parentNode)if(t.nodeName=="TD"||t.nodeName=="TH")return t;return null}function fn(e,t){const n=e.posAtCoords({left:t.clientX,top:t.clientY});return n&&n?Be(e.state.doc.resolve(n.pos)):null}var rc=class{constructor(t,n){this.node=t,this.defaultCellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${n}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Sn(t,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!=this.node.type?!1:(this.node=t,Sn(t,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(t){return t.type=="attributes"&&(t.target==this.table||this.colgroup.contains(t.target))}};function Sn(e,t,n,r,s,o){var i;let a=0,c=!0,d=t.firstChild;const u=e.firstChild;if(u){for(let h=0,f=0;h<u.childCount;h++){const{colspan:p,colwidth:m}=u.child(h).attrs;for(let b=0;b<p;b++,f++){const g=s==f?o:m&&m[b],y=g?g+"px":"";if(a+=g||r,g||(c=!1),d)d.style.width!=y&&(d.style.width=y),d=d.nextSibling;else{const v=document.createElement("col");v.style.width=y,t.appendChild(v)}}}for(;d;){const h=d.nextSibling;(i=d.parentNode)==null||i.removeChild(d),d=h}c?(n.style.width=a+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=a+"px")}}var J=new ae("tableColumnResizing");function sc({handleWidth:e=5,cellMinWidth:t=25,defaultCellMinWidth:n=100,View:r=rc,lastColumnResizable:s=!0}={}){const o=new Pe({key:J,state:{init(i,a){var c,d;const u=(d=(c=o.spec)==null?void 0:c.props)==null?void 0:d.nodeViews,h=V(a.schema).table.name;return r&&u&&(u[h]=(f,p)=>new r(f,n,p)),new oc(-1,!1)},apply(i,a){return a.apply(i)}},props:{attributes:i=>{const a=J.getState(i);return a&&a.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(i,a)=>{ic(i,a,e,s)},mouseleave:i=>{lc(i)},mousedown:(i,a)=>{ac(i,a,t,n)}},decorations:i=>{const a=J.getState(i);if(a&&a.activeHandle>-1)return fc(i,a.activeHandle)},nodeViews:{}}});return o}var oc=class gt{constructor(t,n){this.activeHandle=t,this.dragging=n}apply(t){const n=this,r=t.getMeta(J);if(r&&r.setHandle!=null)return new gt(r.setHandle,!1);if(r&&r.setDragging!==void 0)return new gt(n.activeHandle,r.setDragging);if(n.activeHandle>-1&&t.docChanged){let s=t.mapping.map(n.activeHandle,-1);return Tn(t.doc.resolve(s))||(s=-1),new gt(s,n.dragging)}return n}};function ic(e,t,n,r){const s=J.getState(e.state);if(s&&!s.dragging){const o=dc(t.target);let i=-1;if(o){const{left:a,right:c}=o.getBoundingClientRect();t.clientX-a<=n?i=Rr(e,t,"left",n):c-t.clientX<=n&&(i=Rr(e,t,"right",n))}if(i!=s.activeHandle){if(!r&&i!==-1){const a=e.state.doc.resolve(i),c=a.node(-1),d=P.get(c),u=a.start(-1);if(d.colCount(a.pos-u)+a.nodeAfter.attrs.colspan-1==d.width-1)return}Is(e,i)}}}function lc(e){const t=J.getState(e.state);t&&t.activeHandle>-1&&!t.dragging&&Is(e,-1)}function ac(e,t,n,r){var s;const o=(s=e.dom.ownerDocument.defaultView)!=null?s:window,i=J.getState(e.state);if(!i||i.activeHandle==-1||i.dragging)return!1;const a=e.state.doc.nodeAt(i.activeHandle),c=cc(e,i.activeHandle,a.attrs);e.dispatch(e.state.tr.setMeta(J,{setDragging:{startX:t.clientX,startWidth:c}}));function d(h){o.removeEventListener("mouseup",d),o.removeEventListener("mousemove",u);const f=J.getState(e.state);f!=null&&f.dragging&&(uc(e,f.activeHandle,Mr(f.dragging,h,n)),e.dispatch(e.state.tr.setMeta(J,{setDragging:null})))}function u(h){if(!h.which)return d(h);const f=J.getState(e.state);if(f&&f.dragging){const p=Mr(f.dragging,h,n);Lr(e,f.activeHandle,p,r)}}return Lr(e,i.activeHandle,c,r),o.addEventListener("mouseup",d),o.addEventListener("mousemove",u),t.preventDefault(),!0}function cc(e,t,{colspan:n,colwidth:r}){const s=r&&r[r.length-1];if(s)return s;const o=e.domAtPos(t);let a=o.node.childNodes[o.offset].offsetWidth,c=n;if(r)for(let d=0;d<n;d++)r[d]&&(a-=r[d],c--);return a/c}function dc(e){for(;e&&e.nodeName!="TD"&&e.nodeName!="TH";)e=e.classList&&e.classList.contains("ProseMirror")?null:e.parentNode;return e}function Rr(e,t,n,r){const s=n=="right"?-r:r,o=e.posAtCoords({left:t.clientX+s,top:t.clientY});if(!o)return-1;const{pos:i}=o,a=Be(e.state.doc.resolve(i));if(!a)return-1;if(n=="right")return a.pos;const c=P.get(a.node(-1)),d=a.start(-1),u=c.map.indexOf(a.pos-d);return u%c.width==0?-1:d+c.map[u-1]}function Mr(e,t,n){const r=t.clientX-e.startX;return Math.max(n,e.startWidth+r)}function Is(e,t){e.dispatch(e.state.tr.setMeta(J,{setHandle:t}))}function uc(e,t,n){const r=e.state.doc.resolve(t),s=r.node(-1),o=P.get(s),i=r.start(-1),a=o.colCount(r.pos-i)+r.nodeAfter.attrs.colspan-1,c=e.state.tr;for(let d=0;d<o.height;d++){const u=d*o.width+a;if(d&&o.map[u]==o.map[u-o.width])continue;const h=o.map[u],f=s.nodeAt(h).attrs,p=f.colspan==1?0:a-o.colCount(h);if(f.colwidth&&f.colwidth[p]==n)continue;const m=f.colwidth?f.colwidth.slice():hc(f.colspan);m[p]=n,c.setNodeMarkup(i+h,null,N(j({},f),{colwidth:m}))}c.docChanged&&e.dispatch(c)}function Lr(e,t,n,r){const s=e.state.doc.resolve(t),o=s.node(-1),i=s.start(-1),a=P.get(o).colCount(s.pos-i)+s.nodeAfter.attrs.colspan-1;let c=e.domAtPos(s.start(-1)).node;for(;c&&c.nodeName!="TABLE";)c=c.parentNode;c&&Sn(o,c.firstChild,c,r,a,n)}function hc(e){return Array(e).fill(0)}function fc(e,t){var n;const r=[],s=e.doc.resolve(t),o=s.node(-1);if(!o)return bt.empty;const i=P.get(o),a=s.start(-1),c=i.colCount(s.pos-a)+s.nodeAfter.attrs.colspan-1;for(let d=0;d<i.height;d++){const u=c+d*i.width;if((c==i.width-1||i.map[u]!=i.map[u+1])&&(d==0||i.map[u]!=i.map[u-i.width])){const h=i.map[u],f=a+h+o.nodeAt(h).nodeSize-1,p=document.createElement("div");p.className="column-resize-handle",(n=J.getState(e))!=null&&n.dragging&&r.push(yt.node(a+h,a+h+o.nodeAt(h).nodeSize,{class:"column-resize-dragging"})),r.push(yt.widget(f,p))}}return bt.create(e.doc,r)}function pc({allowTableNodeSelection:e=!1}={}){return new Pe({key:je,state:{init(){return null},apply(t,n){const r=t.getMeta(je);if(r!=null)return r==-1?null:r;if(n==null||!t.docChanged)return n;const{deleted:s,pos:o}=t.mapping.mapResult(n);return s?null:o}},props:{decorations:Na,handleDOMEvents:{mousedown:nc},createSelectionBetween(t){return je.getState(t.state)!=null?t.state.selection:null},handleTripleClick:ec,handleKeyDown:Za,handlePaste:tc},appendTransaction(t,n,r){return Ra(r,Os(r,n),e)}})}function _r(e,t,n,r,s,o){let i=0,a=!0,c=t.firstChild;const d=e.firstChild;for(let u=0,h=0;u<d.childCount;u+=1){const{colspan:f,colwidth:p}=d.child(u).attrs;for(let m=0;m<f;m+=1,h+=1){const b=s===h?o:p&&p[m],g=b?`${b}px`:"";i+=b||r,b||(a=!1),c?(c.style.width!==g&&(c.style.width=g),c=c.nextSibling):t.appendChild(document.createElement("col")).style.width=g}}for(;c;){const u=c.nextSibling;c.parentNode.removeChild(c),c=u}a?(n.style.width=`${i}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${i}px`)}class mc{constructor(t,n){this.node=t,this.cellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),_r(t,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!==this.node.type?!1:(this.node=t,_r(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){return t.type==="attributes"&&(t.target===this.table||this.colgroup.contains(t.target))}}function gc(e,t,n,r){let s=0,o=!0;const i=[],a=e.firstChild;if(!a)return{};for(let h=0,f=0;h<a.childCount;h+=1){const{colspan:p,colwidth:m}=a.child(h).attrs;for(let b=0;b<p;b+=1,f+=1){const g=n===f?r:m&&m[b],y=g?`${g}px`:"";s+=g||t,g||(o=!1),i.push(["col",y?{style:`width: ${y}`}:{}])}}const c=o?`${s}px`:"",d=o?"":`${s}px`;return{colgroup:["colgroup",{},...i],tableWidth:c,tableMinWidth:d}}function Or(e,t){return t?e.createChecked(null,t):e.createAndFill()}function xc(e){if(e.cached.tableNodeTypes)return e.cached.tableNodeTypes;const t={};return Object.keys(e.nodes).forEach(n=>{const r=e.nodes[n];r.spec.tableRole&&(t[r.spec.tableRole]=r)}),e.cached.tableNodeTypes=t,t}function bc(e,t,n,r,s){const o=xc(e),i=[],a=[];for(let d=0;d<n;d+=1){const u=Or(o.cell,s);if(u&&a.push(u),r){const h=Or(o.header_cell,s);h&&i.push(h)}}const c=[];for(let d=0;d<t;d+=1)c.push(o.row.createChecked(null,r&&d===0?i:a));return o.table.createChecked(null,c)}function yc(e){return e instanceof L}const ht=({editor:e})=>{const{selection:t}=e.state;if(!yc(t))return!1;let n=0;const r=mi(t.ranges[0].$from,o=>o.type.name==="table");return r==null||r.node.descendants(o=>{if(o.type.name==="table")return!1;["tableCell","tableHeader"].includes(o.type.name)&&(n+=1)}),n===t.ranges.length?(e.commands.deleteTable(),!0):!1},wc=Ne.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,handleWidth:5,cellMinWidth:25,View:mc,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:e,HTMLAttributes:t}){const{colgroup:n,tableWidth:r,tableMinWidth:s}=gc(e,this.options.cellMinWidth);return["table",F(this.options.HTMLAttributes,t,{style:r?`width: ${r}`:`min-width: ${s}`}),n,["tbody",0]]},addCommands(){return{insertTable:({rows:e=3,cols:t=3,withHeaderRow:n=!0}={})=>({tr:r,dispatch:s,editor:o})=>{const i=bc(o.schema,e,t,n);if(s){const a=r.selection.from+1;r.replaceSelectionWith(i).scrollIntoView().setSelection(ke.near(r.doc.resolve(a)))}return!0},addColumnBefore:()=>({state:e,dispatch:t})=>_a(e,t),addColumnAfter:()=>({state:e,dispatch:t})=>Oa(e,t),deleteColumn:()=>({state:e,dispatch:t})=>za(e,t),addRowBefore:()=>({state:e,dispatch:t})=>Ia(e,t),addRowAfter:()=>({state:e,dispatch:t})=>Pa(e,t),deleteRow:()=>({state:e,dispatch:t})=>$a(e,t),deleteTable:()=>({state:e,dispatch:t})=>qa(e,t),mergeCells:()=>({state:e,dispatch:t})=>Cr(e,t),splitCell:()=>({state:e,dispatch:t})=>jr(e,t),toggleHeaderColumn:()=>({state:e,dispatch:t})=>Ze("column")(e,t),toggleHeaderRow:()=>({state:e,dispatch:t})=>Ze("row")(e,t),toggleHeaderCell:()=>({state:e,dispatch:t})=>Ka(e,t),mergeOrSplit:()=>({state:e,dispatch:t})=>Cr(e,t)?!0:jr(e,t),setCellAttribute:(e,t)=>({state:n,dispatch:r})=>Wa(e,t)(n,r),goToNextCell:()=>({state:e,dispatch:t})=>Ar(1)(e,t),goToPreviousCell:()=>({state:e,dispatch:t})=>Ar(-1)(e,t),fixTables:()=>({state:e,dispatch:t})=>(t&&Os(e),!0),setCellSelection:e=>({tr:t,dispatch:n})=>{if(n){const r=L.create(t.doc,e.anchorCell,e.headCell);t.setSelection(r)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:ht,"Mod-Backspace":ht,Delete:ht,"Mod-Delete":ht}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[sc({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],pc({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(e){const t={name:e.name,options:e.options,storage:e.storage};return{tableRole:fi(pi(e,"tableRole",t))}}}),vc=Ne.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:e=>{const t=e.getAttribute("colwidth");return t?[parseInt(t,10)]:null}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:e}){return["td",F(this.options.HTMLAttributes,e),0]}}),Cc=Ne.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:e=>{const t=e.getAttribute("colwidth");return t?[parseInt(t,10)]:null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:e}){return["th",F(this.options.HTMLAttributes,e),0]}}),jc=Ne.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:e}){return["tr",F(this.options.HTMLAttributes,e),0]}}),kc=Ne.create({name:"details",group:"block",content:"block+",atom:!0,addAttributes(){return{"data-summary":{default:""}}},parseHTML(){return[{tag:"details"}]},renderHTML({HTMLAttributes:e,node:t}){return["details",F(e)]},addNodeView(){return wt(Ac)}}),Ac=({node:e})=>l.jsx(en,{children:l.jsxs("details",{children:[l.jsx("summary",{className:"text-gray-11 text-sm",children:e.attrs["data-summary"]}),l.jsx("div",{className:"font-mono pl-4",children:l.jsx(os,{})})]})}),Tc=Ne.create({name:"timestamp-renderer",group:"inline",inline:!0,content:"inline*",atom:!0,addAttributes(){return{class:{default:"timestamp"},"data-timestamp-start":{default:""},"data-timestamp-end":{default:""},"data-timestamp-start-all-day":{default:"false"},"data-timestamp-end-all-day":{default:"false"}}},parseHTML(){return[{tag:"span.timestamp"}]},renderHTML({HTMLAttributes:e,node:t}){return["span",F(e),0]},addNodeView(){return wt(Nc)}}),Nc=({node:e})=>{const t=e.attrs["data-timestamp-start"],n=e.attrs["data-timestamp-end"],r=e.attrs["data-timestamp-start-all-day"]==="true"||e.attrs["data-timestamp-start-all-day"]===!0,{icon:s,label:o}=C.useMemo(()=>{let i="",a=l.jsx(ar,{});const c=lr(t),d=n?lr(n):"",u=zo(),h=c.isSame(u,"day"),f=c.isSame(u.add(1,"day"),"day"),p=c.isSame(u.subtract(1,"day"),"day"),m=c.isSame(u,"year");if(d)c.isSame(d,"day")?h?i=c.format("hh:mm A")+" - "+d.format("hh:mm A")+" today":f?i=c.format("hh:mm A")+" - "+d.format("hh:mm A")+" tomorrow":p?i=c.format("hh:mm A")+" - "+d.format("hh:mm A")+" yesterday":i=c.format("hh:mm A")+" - "+d.format("hh:mm A")+" on Do MMM":r?i=c.format("Do MMM")+" - "+d.format("Do MMM"):i=c.format("hh:mm A [on] Do MMM")+" - "+d.format("hh:mm A [on] Do MMM");else if(r)h?i="Today":f?i="Tomorrow":p?i="Yesterday":m?i=c.format("Do MMMM"):i=c.format("Do MMMM YYYY");else{h?i=c.format("hh:mm A")+" today":f?i=c.format("hh:mm A")+" tomorrow":p?i=c.format("hh:mm A")+" yesterday":m?i=c.format("hh:mm A [on] Do MMM"):i=c.format("hh:mm A [on] Do MMM YYYY");const b=c.hour();b<=11&&b>=5?a=l.jsx(Io,{}):b>11&&b<=16?a=l.jsx(Po,{}):b>16&&b<19?a=l.jsx(Bo,{}):(b>=19||b<=4)&&(a=l.jsx($o,{}))}return{icon:a,label:i}},[t,n]);return l.jsx(en,{as:"span",children:l.jsxs(Dn,{children:[l.jsx(In,{children:l.jsxs(A,{as:"span",className:"bg-accent-3 px-0.5 text-accent-11",children:[l.jsx(ar,{className:"mr-1 -mb-0.5"}),l.jsx(os,{as:"span"})]})}),l.jsx(Pn,{size:"1",className:"rounded-sm dark:bg-gray-4 py-2 px-2",children:l.jsx(Re,{children:l.jsxs(Do,{align:"center",children:[s,l.jsx(A,{as:"span",size:"2",weight:"medium",children:o})]})})})]})})},Sc=C.memo(({messageID:e})=>{const{editor:t}=gi(),n=t==null?void 0:t.getJSON(),r=C.useMemo(()=>{if(!n)return null;let o="";const i=a=>{var c,d;if(o)return o;if(Array.isArray(a))for(const u of a)typeof u=="object"&&i(u);else if((a==null?void 0:a.type)==="link"){const u=(c=a==null?void 0:a.attrs)==null?void 0:c.href;u!=null&&u.startsWith("mailto")||(o=(d=a==null?void 0:a.attrs)==null?void 0:d.href)}else for(const u in a)typeof(a==null?void 0:a[u])=="object"&&i(a==null?void 0:a[u])};return i(n),o},[n]);return r?Lc(r)?l.jsx(Oc,{href:r,messageID:e}):l.jsx(Ec,{href:r,messageID:e}):null}),Ec=({href:e,messageID:t})=>{var a;const{data:n,isLoading:r}=De("raven.api.preview_links.get_preview_link",{urls:JSON.stringify([e])},e?`link_preview_${e}`:null,{revalidateOnFocus:!1,revalidateOnReconnect:!1,shouldRetryOnError:!1}),{call:s}=et("raven.api.preview_links.hide_link_preview"),o=()=>{s({message_id:t})},i=(a=n==null?void 0:n.message)==null?void 0:a[0];if(r)return l.jsx(Rc,{});if(i&&i.site_name&&i.description){const c=i.absolute_image||i.image;return l.jsxs(z,{pt:"2",maxWidth:{md:"580px"},position:"relative",className:"group/linkpreview sm:max-w-[580px] max-w-[356px]",children:[l.jsx(Zr,{asChild:!0,className:"p-0 sm:p-3",children:l.jsxs("a",{href:e,target:"_blank",className:"flex sm:items-center flex-col sm:flex-row sm:gap-4 gap-0 sm:pr-4",children:[c&&l.jsx("img",{src:c,alt:i.title,className:"sm:max-w-[220px] w-full h-full object-cover sm:object-center sm:h-auto sm:-ml-3 sm:-mt-3 sm:-mb-3",style:{display:"block",backgroundColor:"var(--gray-5)"}}),l.jsxs(Re,{className:"gap-1.5 sm:p-0 py-3 px-3",children:[l.jsxs(Re,{className:"sm:gap-1 gap-0.5",children:[l.jsx(A,{weight:"bold",className:"block",size:"2",children:i.title}),l.jsx(A,{size:"1",children:i.site_name})]}),l.jsx(A,{as:"p",size:"1",className:"line-clamp-3",children:i.description})]})]})}),l.jsx("div",{className:"absolute top-4 right-2 z-10 group-hover/linkpreview:visible invisible sm:block hidden",children:l.jsx(Ie,{content:"Hide link preview",children:l.jsx(Te,{size:"1",color:"gray","aria-label":"Hide link preview",className:"bg-black/40 text-white rounded-md",variant:"ghost",onClick:o,children:l.jsx($r,{size:"20"})})})})]})}return null},Rc=()=>l.jsx(z,{pt:"2",maxWidth:{md:"580px"},className:"sm:max-w-[580px] max-w-[356px]",children:l.jsx(Zr,{asChild:!0,className:"p-0 sm:p-3",children:l.jsxs("div",{className:"animate-pulse flex sm:items-center flex-col sm:flex-row sm:gap-4 gap-0",children:[l.jsx("div",{className:"sm:max-w-[220px] w-full h-[160px] sm:h-[120px] bg-gray-200 sm:-ml-3 sm:-mt-3 sm:-mb-3"}),l.jsxs(Re,{className:"gap-1.5 sm:p-0 py-3 px-3 flex-1",children:[l.jsxs(Re,{className:"sm:gap-1 gap-0.5",children:[l.jsx("div",{className:"h-5 bg-gray-200 rounded w-3/4"}),l.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/3"})]}),l.jsxs("div",{className:"space-y-1.5",children:[l.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"}),l.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"}),l.jsx("div",{className:"h-3 bg-gray-200 rounded w-2/3"})]})]})]})})}),Mc=/^((?:https?:)?\/\/)?((?:www|m|music)\.)?((?:youtube\.com|youtu.be|youtube-nocookie\.com))(\/(?:[\w-]+\?v=|embed\/|v\/)?)([\w-]+)(\S+)?$/,Lc=e=>e.match(Mc),Hr=e=>e?"https://www.youtube-nocookie.com/embed/":"https://www.youtube.com/embed/",_c=e=>{if(e.includes("/embed/"))return e;if(e.includes("youtu.be")){const r=e.split("/").pop();return r?`${Hr()}${r}`:null}const n=/(?:v=|shorts\/)([-\w]+)/gm.exec(e);return!n||!n[1]?null:`${Hr()}${n[1]}`},Oc=({href:e,messageID:t})=>{const n=_c(e);return n?l.jsx("div",{"data-youtube-video":!0,className:"pt-2",children:l.jsx("iframe",{width:"480",height:"270",src:n,title:"YouTube video player",frameBorder:"0",allow:"accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share; modestbranding=1",referrerPolicy:"strict-origin-when-cross-origin",allowFullScreen:!0})}):null},Le=xi(ki);Le.register("html",bi);Le.register("css",yi);Le.register("js",wi);Le.register("ts",vi);Le.register("json",Ci);Le.register("python",ji);const Hc=i=>{var a=i,{message:e,user:t,isScrolling:n=!1,showMiniImage:r=!1,showLinkPreview:s=!0}=a,o=ue(a,["message","user","isScrolling","showMiniImage","showLinkPreview"]);const c=Ai({content:e.text,editable:!1,editorProps:{attributes:{class:O("tiptap-renderer")}},enableCoreExtensions:!0,extensions:[Ti.configure({heading:!1,codeBlock:!1,bold:!1,italic:!1,orderedList:{HTMLAttributes:{class:"list-decimal pl-6"}},bulletList:{HTMLAttributes:{class:"list-disc pl-4"}},listItem:{HTMLAttributes:{class:"rt-Text leading-relaxed text-sm"}},paragraph:{HTMLAttributes:{class:"rt-Text text-sm"}},code:{HTMLAttributes:{class:"pt-0.5 px-1 pb-px bg-[var(--gray-a3)] dark:bg-[#0d0d0d] text-[var(--ruby-a11)] dark-[var(--accent-a3)] text text-xs font-mono rounded border border-gray-4 dark:border-gray-6"}}}),Ol.configure({multicolor:!0,HTMLAttributes:{class:"bg-[var(--yellow-6)] dark:bg-[var(--yellow-11)] px-2 py-1"}}),ua,Ni.configure({lowlight:Le}),Hl,ca,Si,wc.configure({HTMLAttributes:{class:"rt-TableRootTable border-l border-r border-t border-gray-4 dark:border-gray-7 my-2"}}).extend({renderHTML({node:d,HTMLAttributes:u}){return["div",{class:"table-wrapper rt-TableRoot rt-r-size-1 rt-variant-ghost"},["table",F(u,d.attrs,{class:"rt-TableRootTable border-l border-r border-t border-gray-4 dark:border-gray-7 my-2"}),0]]}}),jc.configure({HTMLAttributes:{class:"rt-TableRow"}}),Cc.configure({HTMLAttributes:{class:"rt-TableHeader px-2 py-1 bg-accent-2 dark:bg-gray-3 border-r border-b border-gray-4 dark:border-gray-7"}}),vc.configure({HTMLAttributes:{class:"rt-TableCell py-1 px-2 border-r border-gray-4 dark:border-gray-7"}}),fa.configure({HTMLAttributes:{class:r?"w-auto h-16 max-h-16":"w-full max-w-48 sm:max-w-96 mt-1 h-auto"},inline:!0}),wr.extend({name:"userMention",addNodeView(){return wt(Dl)}}).configure({suggestion:{char:"@",pluginKey:new ae("userMention")}}),wr.extend({name:"channelMention",HTMLAttributes:{class:"mention"},addNodeView(){return wt(Il)}}).configure({suggestion:{char:"#",pluginKey:new ae("channelMention")}}),kc,Tc]});return l.jsx(z,N(j({className:O("overflow-x-hidden text-ellipsis",o.className)},o),{children:l.jsxs(Ei.Provider,{value:{editor:c},children:[l.jsx(Ri,{contentEditable:!1,editor:c,readOnly:!0}),s&&l.jsx(Sc,{messageID:e.name})]})}))},Ps=({message:e,onReply:t,onEdit:n,isEmojiPickerOpen:r,setIsEmojiPickerOpen:s,showThreadButton:o=!0,alignToRight:i=!1})=>{var b,g,y;const{currentUser:a}=C.useContext(nt),c=Fo(Li),d=a===(e==null?void 0:e.owner)&&!(e!=null&&e.is_bot_message),u=C.useRef(null),h=v=>{v.preventDefault();var E=new MouseEvent("contextmenu",{bubbles:!0,cancelable:!0,clientX:v.clientX,clientY:v.clientY,screenX:v.screenX,screenY:v.screenY,buttons:2});v.target.dispatchEvent(E)},f=bs(),p=(v,E=!1,R)=>{e&&f(e,v,E,R).catch(T=>{D.error("Could not react to message.",{description:ye(T)})})},m=(y=(g=(b=window.frappe)==null?void 0:b.boot)==null?void 0:g.chat_style)!=null?y:"Simple";return l.jsx(z,{ref:u,className:O("absolute group-hover:visible group-hover:transition-all ease-ease-out-quad group-hover:delay-100 z-50 p-1 shadow-md rounded-md bg-white dark:bg-gray-1 invisible",m==="Left-Right"?i?"-top-10 right-0":"-top-10 left-0":"-top-6 right-4"),children:l.jsxs(w,{gap:"1",children:[c.map(v=>l.jsx(Ue,{className:"text-base",tooltip:`React with ${v}`,"aria-label":`React with ${v}`,onClick:()=>{p(v)},children:v},v)),l.jsx(xs,{isOpen:r,setIsOpen:s,saveReaction:p}),d&&e.message_type==="Text"?l.jsx(Ue,{onClick:n,tooltip:"Edit message","aria-label":"Edit message",children:l.jsx(Ir,{size:"18"})}):l.jsx(Ue,{tooltip:"Reply","aria-label":"Reply to this message",onClick:t,children:l.jsx(Dr,{size:"18"})}),e&&!e.is_thread&&o&&l.jsx(al,{messageID:e.name}),l.jsx(Ue,{"aria-label":"More actions",variant:"soft",tooltip:"More actions",onClick:h,className:Wn,children:l.jsx(Uo,{size:"18"})})]})})},Bs=s=>{var o=s,{message:e,children:t,className:n}=o,r=ue(o,["message","children","className"]);var a,c,d,u,h;const i=Zt(e.owner);return l.jsxs(w,N(j({className:O("p-2 items-start bg-white border border-gray-5 shadow-sm dark:bg-gray-3 dark:border-gray-6 rounded-md overflow-hidden",n)},r),{children:[l.jsxs(w,{gap:"1",direction:"column",className:"border-l-2 pl-2 border-gray-8",children:[l.jsxs(w,{gap:"2",align:"center",children:[l.jsx(A,{as:"span",size:"1",weight:"medium",truncate:!0,children:(a=i==null?void 0:i.full_name)!=null?a:e.owner}),l.jsx(Hn,{orientation:"vertical"}),l.jsx(A,{as:"span",size:"1",color:"gray",children:e.creation&&l.jsx(On,{date:e.creation})})]}),l.jsx(z,{className:"max-w-[75vw]",children:e.message_type==="Poll"?l.jsxs(A,{as:"span",size:"2",className:"line-clamp-2 flex items-center",children:[l.jsx(Wo,{size:"14",className:"inline mr-1"}),"Poll: ",(d=(c=e.content)==null?void 0:c.split(`
`))==null?void 0:d[0]]}):["File","Image"].includes((u=e.message_type)!=null?u:"Text")?l.jsxs(w,{gap:"2",align:"center",children:[e.message_type==="File"&&e.file&&l.jsx(Vr,{ext:Wr(e.file),size:"18"}),e.message_type==="Image"&&l.jsx("img",{src:e.file,alt:`Image sent by ${e.owner}`,height:"30",width:"30",className:"object-cover rounded-md"}),l.jsx(A,{as:"span",size:"2",children:Jt(e.file)})]}):l.jsx(A,{as:"span",size:"2",className:"line-clamp-2 text-ellipsis",children:Vo((h=e.content)!=null?h:"")})})]}),t]}))};function $s(e,t=300,n={}){const r=C.useRef(null),s=C.useCallback(o=>{r.current?(clearTimeout(r.current),r.current=null,e&&e(o)):r.current=setTimeout(()=>{n.onSingleTap&&n.onSingleTap(o),r.current=null},t)},[e,t,n.onSingleTap]);return e?{onClick:s}:{}}const Fs=e=>{const t=C.useRef(null);return C.useEffect(()=>{const n=r=>{t.current&&!t.current.contains(r.target)&&e()};return document.addEventListener("click",n,!0),()=>{document.removeEventListener("click",n,!0)}},[t]),t},Us=({thread:e})=>{const{workspaceID:t}=tt();return l.jsx("div",{className:"mt-2",children:l.jsxs(w,{justify:"between",align:"center",gap:"2",className:"w-fit px-3 py-2 border border-gray-4 rounded-md shadow-[0_20px_30px_-10px_rgba(0,0,0,0.1)]",children:[l.jsx(zc,{thread:e}),l.jsx(be,{size:"1",asChild:!0,color:"gray",variant:"ghost",className:"not-cal w-fit hover:bg-transparent hover:underline cursor-pointer",children:l.jsx(Xr,{to:`/${t}/${e.channel_id}/thread/${e.name}`,children:"View Thread"})})]})})},zc=({thread:e})=>{var n;const{data:t}=De("raven.api.threads.get_number_of_replies",{thread_id:e.name},["thread_reply_count",e.name],{revalidateOnFocus:!1,shouldRetryOnError:!1});return l.jsxs(w,{gap:"1",align:"center",children:[l.jsx(A,{size:"1",className:"font-semibold text-accent-a11",children:(n=t==null?void 0:t.message)!=null?n:0}),l.jsx(A,{size:"1",className:"font-semibold text-accent-a11",children:(t==null?void 0:t.message)===1?"Reply":"Replies"})]})},Dc=({message:e,user:t,isActive:n,isHighlighted:r,onReplyMessageClick:s,onDelete:o,showThreadButton:i,onEdit:a,onReply:c,onForward:d,onViewReaction:u,onAttachToDocument:h})=>{var Se,te,_e;const{name:f,owner:p,is_bot_message:m,bot:b,creation:g,message_reactions:y,is_continuation:v,linked_message:E,replied_message_details:R}=e,{currentUser:T}=C.useContext(nt),H=C.useMemo(()=>typeof R=="string"?JSON.parse(R):R,[R]),M=Xt(),[$,S]=C.useState(!1),B=ls($,M?400:200),[U,X]=C.useState(!1),Z=$s(Oe=>{M||S(!$)}),de=Fs(()=>{M||S(!1)}),q=()=>{M&&S(!0)},Y=()=>{M&&S(!1)},G=((_e=(te=(Se=window.frappe)==null?void 0:Se.boot)==null?void 0:te.chat_style)!=null?_e:"Simple")==="Left-Right"&&T===p&&!m;return l.jsx("div",{className:O("flex py-0.5",G?"justify-end mr-4":"justify-start"),children:l.jsxs(w,{align:"start",gap:"2",children:[!G&&l.jsx(Ic,{message:e,user:t,isActive:n,className:"mt-[5px]"}),l.jsxs(es,{children:[l.jsx(ts,N(j({},Z),{ref:de,onMouseEnter:q,onMouseLeave:Y,className:"group",children:l.jsxs(Re,{gap:"0",align:"end",children:[G&&!v&&l.jsx(z,{className:"text-right pr-1 pb-0.5",children:l.jsx(mn,{timestamp:g})}),l.jsxs(w,{direction:"column",className:O("relative w-fit sm:max-w-[32rem] max-w-[80vw] bg-gray-2 dark:bg-gray-3 p-3 gap-1 rounded-md",r?"bg-yellow-50 hover:bg-yellow-50 dark:bg-yellow-300/20 dark:hover:bg-yellow-300/20":!M&&$?"bg-gray-2 dark:bg-gray-3":""),children:[!v&&!G?l.jsxs(w,{align:"center",gap:"2",children:[l.jsx(Vs,{user:t,userID:p,isActive:n}),l.jsx(mn,{timestamp:g})]}):null,e.is_forwarded===1&&l.jsxs(w,{className:"text-gray-10 text-xs",gap:"1",align:"center",children:[l.jsx(ns,{size:"12"})," forwarded"]}),e.is_pinned===1&&l.jsxs(w,{className:"text-accent-9 text-xs",gap:"1",align:"center",children:[l.jsx(rs,{size:"12"})," Pinned"]}),E&&R&&l.jsx(Bs,{className:"sm:max-w-[32rem] max-w-[80vw] cursor-pointer mb-1",role:"button",onClick:()=>s(E),message:H}),l.jsx(Ks,{message:e,user:t}),e.link_doctype&&e.link_document&&l.jsx(z,{className:O(e.is_continuation?"ml-0.5":"-ml-0.5"),children:l.jsx(is,{doctype:e.link_doctype,docname:e.link_document})}),e.is_edited===1&&l.jsx(A,{size:"1",className:"text-gray-10",children:"(edited)"}),(y==null?void 0:y.length)&&l.jsx(ys,{message:e,message_reactions:y}),e.is_thread===1?l.jsx(Us,{thread:e}):null,(B||U)&&l.jsx(Ps,{message:e,onDelete:o,isEmojiPickerOpen:U,setIsEmojiPickerOpen:X,onEdit:a,onReply:c,onForward:d,showThreadButton:i,onAttachDocument:h,alignToRight:G})]})]})})),l.jsx(gs,{message:e,onDelete:o,showThreadButton:i,onEdit:a,onReply:c,onForward:d,onViewReaction:u,onAttachDocument:h})]})]})})},Ic=o=>{var i=o,{message:e,className:t,user:n,isActive:r}=i,s=ue(i,["message","className","user","isActive"]);return l.jsx(z,N(j({className:O(e.is_continuation?"flex items-center w-[38px] sm:w-[34px]":"",t)},s),{children:e.is_continuation?null:l.jsx(Ws,{userID:e.owner,user:n,isActive:r})}))},Xc=({message:e,setDeleteMessage:t,isHighlighted:n,onReplyMessageClick:r,setEditMessage:s,replyToMessage:o,forwardMessage:i,onAttachDocument:a,setReactionMessage:c,showThreadButton:d=!0})=>{var tr,nr,rr;const{name:u,owner:h,is_bot_message:f,bot:p,creation:m,message_reactions:b,is_continuation:g,linked_message:y,replied_message_details:v}=e,{user:E,isActive:R}=Bc(f&&p?p:h),T=()=>{t(e)},H=()=>{s(e)},M=()=>{o(e)},$=()=>{i(e)},S=()=>{a(e)},B=()=>{c(e)},U=Xt(),[X,Z]=C.useState(!1),de=ls(X,U?400:200),q=()=>{U&&Z(!0)},Y=()=>{U&&Z(!1)},ee=$s(Fc=>{U||Z(!X)}),G=Fs(()=>{U||Z(!1)}),Se=C.useMemo(()=>typeof v=="string"?JSON.parse(v):v,[v]),[te,_e]=C.useState(!1),Oe=(rr=(nr=(tr=window.frappe)==null?void 0:tr.boot)==null?void 0:nr.chat_style)!=null?rr:"Simple";return l.jsx(l.Fragment,{children:Oe==="Left-Right"?l.jsx(Dc,{message:e,user:E,isActive:R,isHighlighted:n,onReplyMessageClick:r,onDelete:T,showThreadButton:d,onEdit:H,onReply:M,onForward:$,onViewReaction:B,onAttachToDocument:S}):l.jsxs(z,{className:"relative",children:[!e.is_continuation&&e.is_thread?l.jsx("div",{className:`absolute 
                        border-l
                        border-b
                        border-gray-5 
                        h-[calc(100%-66px)] 
                        rounded-bl-lg
                        w-6
                        top-[42px] 
                        left-6 z-0`}):null,l.jsxs(es,{modal:!1,children:[l.jsx(ts,N(j({},ee),{ref:G,onMouseEnter:q,onMouseLeave:Y,className:O(`group
                            sm:hover:bg-gray-2
                            active:bg-gray-2
                            sm:hover:transition-all
                            active:hover:transition-all
                            sm:hover:delay-100
                            active:hover:delay-100
                            select-none
                            sm:select-auto
                            sm:dark:hover:bg-gray-3
                            dark:active:bg-gray-4
                            data-[state=open]:bg-accent-2
                            dark:data-[state=open]:bg-gray-4
                            data-[state=open]:shadow-sm
                            transition-colors
                            px-1
                            py-1.5
                            sm:p-1.5
                            rounded-md`,g?"":"py-2.5 sm:py-3",n?"bg-yellow-50 hover:bg-yellow-50 dark:bg-yellow-300/20 dark:hover:bg-yellow-300/20":!U&&X?"bg-gray-2 dark:bg-gray-3":"",te?"bg-gray-2 dark:bg-gray-3":""),children:l.jsxs(w,{className:"gap-2.5 sm:gap-3 items-start",children:[l.jsx(Pc,{message:e,user:E,isActive:R}),l.jsxs(w,{direction:"column",className:"gap-0.5 w-[90%]",justify:"center",children:[g?null:l.jsxs(w,{align:"center",gap:"2",mt:"-1",children:[l.jsx(Vs,{user:E,userID:h,isActive:R}),l.jsx(mn,{timestamp:m})]}),e.is_forwarded===1&&l.jsxs(w,{className:"text-gray-10 text-xs",gap:"1",align:"center",children:[l.jsx(ns,{size:"12"})," forwarded"]}),e.is_pinned===1&&l.jsxs(w,{className:"text-accent-9 text-xs",gap:"1",align:"center",children:[l.jsx(rs,{size:"12"})," Pinned"]}),y&&v&&l.jsx(Bs,{className:"sm:min-w-[32rem] cursor-pointer mb-1",role:"button",onClick:()=>r(y),message:Se}),l.jsx(Ks,{message:e,user:E}),e.link_doctype&&e.link_document&&l.jsx(z,{className:O(e.is_continuation?"ml-0.5":"-ml-0.5"),children:l.jsx(is,{doctype:e.link_doctype,docname:e.link_document})}),e.is_edited===1&&l.jsx(A,{size:"1",className:"text-gray-10",children:"(edited)"}),(b==null?void 0:b.length)&&l.jsx(ys,{message:e,message_reactions:b}),e.is_thread===1?l.jsx(Us,{thread:e}):null]}),(de||te)&&l.jsx(Ps,{message:e,onDelete:T,isEmojiPickerOpen:te,setIsEmojiPickerOpen:_e,onEdit:H,onReply:M,onForward:$,showThreadButton:d,onAttachDocument:S})]})})),l.jsx(gs,{message:e,onDelete:T,showThreadButton:d,onEdit:H,onReply:M,onForward:$,onViewReaction:B,onAttachDocument:S})]})]})})},Pc=o=>{var i=o,{message:e,className:t,user:n,isActive:r}=i,s=ue(i,["message","className","user","isActive"]);return l.jsx(z,N(j({className:O(e.is_continuation?"invisible group-hover:visible flex items-center w-[32px]":"",t)},s),{children:e.is_continuation?l.jsx(z,{className:"-mt-0.5",children:l.jsx(ml,{timestamp:e.creation})}):l.jsx(Ws,{userID:e.owner,user:n,isActive:r})}))},Bc=e=>{const t=Zt(e),n=Gr(e);return{user:t,isActive:n}},Ws=C.memo(({user:e,userID:t,isActive:n=!1})=>{var a,c;const r=(a=e==null?void 0:e.full_name)!=null?a:t,s=(e==null?void 0:e.type)==="Bot",o=C.useMemo(()=>{var d;return Ko((d=e==null?void 0:e.full_name)!=null?d:t)},[e==null?void 0:e.full_name,t]),i=e==null?void 0:e.availability_status;return l.jsx(Yo,{accentColor:o,children:l.jsxs("span",{className:"relative inline-block",children:[l.jsx(qo,{src:e==null?void 0:e.user_image,alt:(c=e==null?void 0:e.full_name)!=null?c:t,loading:"lazy",fallback:Go(r),size:"2",radius:"medium"}),i&&i==="Away"&&l.jsx("span",{className:O("absolute block translate-x-1/2 translate-y-1/2 transform rounded-full","bottom-0.5 right-0.5"),children:l.jsx("span",{className:"block h-2 w-2 rounded-full border border-slate-2 bg-[#FFAA33] shadow-md"})}),i&&i==="Do not disturb"&&l.jsx("span",{className:O("absolute block translate-x-1/2 translate-y-1/2 transform rounded-full","bottom-0.5 right-0.5"),children:l.jsx("span",{className:"block h-2 w-2 rounded-full border border-slate-2 bg-[#D22B2B] shadow-md"})}),i!=="Away"&&i!=="Do not disturb"&&n&&l.jsx("span",{className:O("absolute block translate-x-1/2 translate-y-1/2 transform rounded-full","bottom-0.5 right-0.5"),children:l.jsx("span",{className:"block h-2 w-2 rounded-full border border-slate-2 bg-green-600 shadow-md"})}),s&&l.jsx("span",{className:"absolute block translate-x-1/2 translate-y-1/2 transform rounded-full bottom-0.5 right-0.5",children:l.jsx(Qo,{className:"text-accent-11 dark:text-accent-11",size:"16px"})})]})})}),Vs=C.memo(({user:e,userID:t,isActive:n})=>{const{isBot:r,fullName:s,userImage:o,availabilityStatus:i,customStatus:a}=C.useMemo(()=>{var c,d;return{fullName:(c=e==null?void 0:e.full_name)!=null?c:t,availabilityStatus:e==null?void 0:e.availability_status,customStatus:e==null?void 0:e.custom_status,userImage:(d=e==null?void 0:e.user_image)!=null?d:"",isBot:(e==null?void 0:e.type)==="Bot"}},[e,t]);return l.jsxs(Dn,{children:[l.jsx(In,{children:l.jsxs(A,{className:"text-gray-12 flex items-center gap-1",weight:"medium",size:"2",children:[s," ",r&&l.jsx(xt,{color:"gray",className:"font-semibold px-1 py-0",children:"Bot"})]})}),l.jsx(Pn,{size:"1",children:l.jsxs(Re,{children:[l.jsxs(w,{gap:"2",align:"center",children:[l.jsx(zn,{src:o,alt:s,size:"4",isBot:r}),l.jsxs(w,{direction:"column",children:[l.jsxs(w,{gap:"3",align:"center",children:[l.jsx(A,{className:"text-gray-12",weight:"bold",size:"3",children:s}),i&&i!=="Invisible"&&l.jsx(w,{className:"text-gray-10 text-xs flex gap-1 items-center",children:Qr(i)}),!i&&n&&l.jsxs(w,{gap:"1",align:"center",children:[l.jsx(Jr,{color:"green",size:"8"}),l.jsx(A,{className:"text-gray-10",size:"1",children:"Online"})]})]}),e&&!r&&l.jsx(ws,{userID:e.name}),a?l.jsx(A,{className:"text-gray-11",size:"1",children:a}):e&&!r&&l.jsx(A,{className:"text-gray-11",size:"1",children:e==null?void 0:e.name})]})]}),l.jsx($c,{userID:t})]})})]})}),$c=({userID:e})=>{const{call:t}=C.useContext(rt),n=En(),{workspaceID:r}=tt(),s=()=>{e&&t.post("raven.api.raven_channel.create_direct_message_channel",{user_id:e}).then(o=>{n(`/${r}/${o==null?void 0:o.message}`)}).catch(o=>{D.error("Could not create a DM channel",{description:ye(o)})})};return l.jsxs(be,{variant:"soft",className:"not-cal",size:"1",onClick:s,children:[l.jsx(Jo,{size:"14"})," Message"]})},Ks=s=>{var o=s,{message:e,user:t,forceHideLinkPreview:n=!1}=o,r=ue(o,["message","user","forceHideLinkPreview"]);return l.jsxs(z,N(j({},r),{children:[e.text?l.jsx(Hc,{message:N(j({},e),{message_type:"Text"}),user:t,showLinkPreview:n?!1:!e.hide_link_preview}):null,e.message_type==="Image"&&l.jsx(wl,{message:e,user:t}),e.message_type==="File"&&l.jsx(vl,{message:e,user:t}),e.message_type==="Poll"&&l.jsx(Tl,{message:e,user:t})]}))},Zc=e=>{const{channels:t,dm_channels:n,error:r,isLoading:s}=C.useContext(Xo);return{channel:C.useMemo(()=>{if(e){const i=t==null?void 0:t.find(c=>c.name===e);if(i)return{channelData:i,type:"channel"};const a=n==null?void 0:n.find(c=>c.name===e);return a?{channelData:a,type:"dm"}:void 0}else return},[e,t]),error:r,isLoading:s}};export{mn as D,Ol as H,fa as I,aa as L,Ws as M,Bs as R,ga as S,Hc as T,Vs as U,Ks as a,wr as b,da as c,Tc as d,ml as e,Xc as f,zl as g,Zc as u};
