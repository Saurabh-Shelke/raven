import{r,j as e,aX as P,S as x,x as S,aY as b,aZ as y,c as _,i as C,at as E,b as L,m as M,a_ as N,o as B,a$ as U,E as $,b0 as z,b1 as H,b2 as I,aC as R,n as V,$ as w,ac as Y}from"./index-81db420b.js";import{D as A}from"./DoctypeLinkRenderer-5c845fcf.js";import{u as O}from"./useDoctypeMeta-749cfb81.js";import{P as X,S as Z,a as q}from"./SettingsContentContainer-c8f50a15.js";const G=s=>{const[t,a]=r.useState(""),[n,i]=r.useState("");return e.jsxs(P,{columns:"2",gap:"4",children:[e.jsxs(x,{children:[e.jsx(S,{size:"3",className:"not-cal",children:"Configure"}),e.jsx(b,{label:"Select a DocType",doctype:"DocType",filters:[["issingle","=",0],["istable","=",0]],value:t,setValue:a}),t&&e.jsx(K,{doctype:t,docname:n})]}),t&&e.jsx(se,{doctype:t,docname:n,setDocname:i})]})},J=["Section Break","Column Break","Tab Break","HTML","Table","Table MultiSelect","Button","Image","Fold","Heading","Table","Table MultiSelect"],K=({doctype:s,docname:t})=>{const{doc:a,mutate:n}=O(s),{previewFields:i,eligibleFields:d}=r.useMemo(()=>{var u,h,m;const c=(h=(u=a==null?void 0:a.fields)==null?void 0:u.filter(o=>!J.includes(o.fieldtype)&&o.fieldname))!=null?h:[];return{previewFields:(m=c==null?void 0:c.filter(o=>o.in_preview))!=null?m:[],eligibleFields:c}},[a]);return a?e.jsx(Q,{doctype:s,docname:t,eligibleFields:d,previewFields:i,mutateMeta:n}):null},Q=({doctype:s,docname:t,eligibleFields:a,previewFields:n,mutateMeta:i})=>{const[d,c]=r.useState(""),j=r.useMemo(()=>{const l=d.toLowerCase();return a.filter(p=>{var g;return(g=p.fieldname)==null?void 0:g.toLowerCase().includes(l)})},[a,d]),[u,h]=r.useState(n.map(l=>{var p;return(p=l.fieldname)!=null?p:""})),[m,o]=r.useState(!1),F=l=>{h(l),o(!0)},{mutate:D}=y(),{call:T,loading:f,error:v}=_("raven.api.document_link.update_preview_fields"),k=()=>{T({doctype:s,fields:u}).then(()=>{w.success("Fields updated"),o(!1),i(),D(`raven.api.document_link.get_preview_data?doctype=${encodeURIComponent(s)}&docname=${encodeURIComponent(t)}`)}).catch(l=>{w.error(Y(l))})};return e.jsxs(x,{children:[n.length===0&&e.jsx("div",{children:e.jsxs(C,{size:"2",children:["No fields have been selected for preview, hence we would show all mandatory fields of ",s," in the preview."]})}),e.jsxs(E,{align:"center",pt:"2",children:[e.jsx(L,{placeholder:"Search fields",className:"w-full",size:"2",value:d,onChange:l=>c(l.target.value),children:e.jsx(M,{children:e.jsx(N,{})})}),e.jsx(B,{className:"not-cal",type:"button",onClick:k,disabled:!m||f,children:f?e.jsxs(e.Fragment,{children:[e.jsx(U,{})," Updating..."]}):"Update and Preview"})]}),v&&e.jsx($,{error:v}),e.jsx(W,{eligibleFields:j,selectedFields:u,setSelectedFields:F})]})},W=({eligibleFields:s,selectedFields:t,setSelectedFields:a})=>e.jsx(z,{className:"h-[60vh]",children:e.jsx(H,{defaultValue:t,onValueChange:a,gap:"1",size:"1",children:s.map(n=>e.jsx(ee,{field:n},n.fieldname))})}),ee=({field:s})=>{var t;return e.jsxs(I,{value:(t=s.fieldname)!=null?t:"",children:[e.jsx(C,{children:s.label}),e.jsx(R,{children:s.fieldtype})]})},se=({doctype:s,docname:t,setDocname:a})=>{const{db:n}=r.useContext(V);return r.useEffect(()=>{n.getLastDoc(s).then(i=>{a(i.name)})},[s]),e.jsxs(x,{children:[e.jsx(S,{size:"3",className:"not-cal",children:"Preview"}),e.jsx(b,{label:"Select a Document",doctype:s,value:t,setValue:a}),t&&e.jsx(A,{doctype:s,docname:t})]})},te=()=>e.jsx(X,{children:e.jsxs(Z,{children:[e.jsx(q,{title:"Document Previews",description:"Customise how document links are displayed in the chat. You can add/remove fields to be displayed in the preview."}),e.jsx(G,{})]})}),ie=te;export{ie as Component};
