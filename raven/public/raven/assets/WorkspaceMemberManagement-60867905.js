var ae=Object.defineProperty;var A=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var T=(a,n,s)=>n in a?ae(a,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[n]=s,_=(a,n)=>{for(var s in n||(n={}))ne.call(n,s)&&T(a,s,n[s]);if(A)for(var s of A(n))re.call(n,s)&&T(a,s,n[s]);return a};import{r as d,as as te,j as e,S as w,aw as W,ax as F,ay as L,az as v,aA as g,b as ce,m as le,a_ as oe,aB as M,at as j,a0 as U,i as u,aW as R,aG as ie,W as de,U as xe,E as y,a3 as ue,co as je,bu as me,aZ as H,ag as he,ah as fe,q as ge,b6 as Me,aj as _e,bq as pe,ak as S,cp as we,ad as q,cq as I,b8 as P,a2 as Y,a4 as G,o as C,b4 as ve,a6 as V,K as J,a7 as Ce,aq as K,ar as Z,e as k,c as be,l as Ne,au as ye,_ as B,bv as D,bw as $,by as E,J as N,b0 as O,cr as Se,$ as m,ac as z}from"./index-81db420b.js";import{T as Q}from"./index-a6c096df.js";import{T as ke}from"./TableLoader-47d8c4ae.js";import{u as ze}from"./useGetUserRecords-beb6efeb.js";const Ae=({currentMembers:a,onChange:n})=>{const{users:s}=d.useContext(te),[r,t]=d.useState(""),c=(l,i,b)=>{const p=a.filter(f=>f.user!==l);p.push({user:l,is_admin:b&&i?1:0,is_member:i?1:0}),n(p)},o=d.useMemo(()=>s.filter(l=>l.full_name.toLowerCase().includes(r.toLowerCase())),[s,r]),h=a.reduce((l,i)=>(l[i.user]={is_admin:!!i.is_admin,is_member:!!i.is_member},l),{});return e.jsxs(w,{children:[e.jsx(Te,{onSearch:t}),e.jsx(w,{className:"max-h-[600px] overflow-y-auto transition-height duration-300",children:e.jsx(Q,{style:{height:"540px"},data:o,components:{Table:l=>e.jsx(W,_({size:"1"},l)),TableHead:F,TableBody:L,TableRow:l=>e.jsx(v,_({className:"hover:bg-gray-2"},l))},fixedHeaderContent:()=>e.jsxs(v,{children:[e.jsx(g,{className:"w-[50%]",children:"User"}),e.jsx(g,{className:"w-[25%]",children:"Member"}),e.jsx(g,{className:"w-[25%]",children:"Admin"})]}),itemContent:(l,i)=>e.jsx(Re,{member:i,membership:h[i.name],onMemberChange:c},i.name)})})]})},Te=({onSearch:a})=>{const[n,s]=d.useState("");return d.useEffect(()=>{const r=setTimeout(()=>{a(n)},250);return()=>clearTimeout(r)},[n]),e.jsx(ce,{placeholder:"Search",value:n,onChange:r=>s(r.target.value),children:e.jsx(le,{children:e.jsx(oe,{})})})},Re=({member:a,onMemberChange:n,membership:s})=>{var r,t;return e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-[50%]",onClick:()=>n(a.name,!(s!=null&&s.is_member),s==null?void 0:s.is_admin),children:e.jsx(j,{justify:"between",children:e.jsxs(j,{align:"center",children:[e.jsx(U,{size:"2",loading:"eager",src:a.user_image,alt:(r=a.full_name)!=null?r:a.name}),e.jsx(u,{as:"span",weight:"medium",children:(t=a.full_name)!=null?t:a.name})]})})}),e.jsx(M,{className:"w-[25%]",children:e.jsx("div",{className:"flex h-full justify-start items-center px-2",children:e.jsx(R,{name:`member-${a.name}`,checked:s==null?void 0:s.is_member,onCheckedChange:c=>n(a.name,!!c,s==null?void 0:s.is_admin)})})}),e.jsx(M,{className:"w-[25%]",children:e.jsx("div",{className:"flex h-full justify-start items-center px-2",children:e.jsx(R,{checked:s==null?void 0:s.is_admin,disabled:!(s!=null&&s.is_member),onCheckedChange:c=>n(a.name,s==null?void 0:s.is_member,!!c)})})})]})},Be=d.lazy(()=>ie(()=>import("./AddWorkspaceMemberModalContent-ffe0f7d4.js"),["assets/AddWorkspaceMemberModalContent-ffe0f7d4.js","assets/index-81db420b.js","assets/index-27ae9ec0.css","assets/MultipleUserCombobox-3792d0b5.js","assets/index-a6c096df.js","assets/TableLoader-47d8c4ae.js","assets/Skeleton-9de30e70.js","assets/useGetUserRecords-beb6efeb.js"])),X=a=>de("raven.api.workspaces.fetch_workspace_members",{workspace:a},["workspace_members",a],{revalidateOnFocus:!1,errorRetryCount:2}),Je=({workspaceID:a})=>{const{data:n,isLoading:s,error:r}=X(a),{currentUser:t}=d.useContext(xe),c=d.useMemo(()=>{var o;return(o=n==null?void 0:n.message.some(h=>h.user===t&&h.is_admin))!=null?o:!1},[n,t]);return e.jsxs(w,{children:[e.jsxs(j,{justify:"end",children:[e.jsx(Le,{workspaceID:a}),e.jsx(qe,{workspaceID:a})]}),s&&!r&&e.jsx(ke,{columns:2}),e.jsx(y,{error:r}),n&&e.jsx(De,{members:n.message,isAdmin:c,workspaceID:a})]})},De=({members:a,isAdmin:n,workspaceID:s})=>{const r=ze();return e.jsx(Q,{useWindowScroll:!0,data:a,components:{Table:t=>e.jsx(W,_({variant:"surface",className:"rounded-sm"},t)),TableHead:F,TableBody:L,TableRow:t=>e.jsx(v,_({className:"group hover:bg-gray-2 dark:hover:bg-gray-3 [&:has([data-state='open'])]:bg-gray-2 dark:[&:has([data-state='open'])]:bg-gray-3"},t))},fixedHeaderContent:()=>e.jsxs(v,{children:[e.jsx(g,{children:"Name"}),e.jsx(g,{children:"Joined"}),n?e.jsx(g,{}):null]}),itemContent:(t,c)=>e.jsx($e,{users:r,member:c,isAdmin:n,workspaceID:s})})},$e=({users:a,member:n,isAdmin:s,workspaceID:r})=>{var c,o;const t=a[n.user];return e.jsxs(e.Fragment,{children:[e.jsx(M,{children:e.jsxs(j,{align:"center",children:[e.jsx(U,{src:t==null?void 0:t.user_image,alt:(c=t==null?void 0:t.full_name)!=null?c:n.user,size:"2"}),e.jsx(u,{as:"span",children:(o=t==null?void 0:t.full_name)!=null?o:n.user}),n.is_admin?e.jsx(ue,{content:"Admin",children:e.jsx(u,{as:"span",className:"h-full flex items-center",children:e.jsx(je,{fontSize:18,color:"#FFC53D"})})}):null]})}),e.jsx(M,{children:e.jsx(u,{as:"span",className:"flex items-center h-full",children:me(n.creation).format("Do MMMM YYYY")})}),s?e.jsx(M,{align:"center",children:e.jsx(Ee,{member:n,workspaceID:r})}):null]})},Ee=({member:a,workspaceID:n})=>{const{mutate:s}=H(),r=()=>{s(["workspace_members",n])};return e.jsx("div",{className:"flex items-center gap-2 justify-center h-full",children:e.jsxs(he,{children:[e.jsx(fe,{children:e.jsx(ge,{variant:"ghost",color:"gray",size:"3",children:e.jsx(Me,{fontSize:16})})}),e.jsxs(_e,{className:"min-w-36",children:[a.is_admin?e.jsx(Fe,{memberID:a.name,onUpdate:r}):e.jsx(We,{memberID:a.name,onUpdate:r}),e.jsx(Oe,{memberID:a.name,onUpdate:r})]})]})})},Oe=({memberID:a,onUpdate:n})=>{const{deleteDoc:s}=pe(),r=()=>{s("Raven Workspace Member",a).then(()=>{n(),m.success("Member removed")}).catch(t=>{m.error("Failed to remove member",{description:z(t),duration:4e3})})};return e.jsxs(S,{onClick:r,color:"red",children:[e.jsx(we,{fontSize:16}),"Remove Member"]})},We=({memberID:a,onUpdate:n})=>{const{updateDoc:s}=q(),r=()=>{s("Raven Workspace Member",a,{is_admin:!0}).then(()=>{n(),m.success("Success")}).catch(t=>{m.error("Failed to make add admin",{description:z(t),duration:4e3})})};return e.jsxs(S,{onClick:r,children:[e.jsx(I,{fontSize:16}),"Make Admin"]})},Fe=({memberID:a,onUpdate:n})=>{const{updateDoc:s}=q(),r=()=>{s("Raven Workspace Member",a,{is_admin:!1}).then(()=>{n(),m.success("Success")}).catch(t=>{m.error("Failed to remove admin",{description:z(t),duration:4e3})})};return e.jsxs(S,{onClick:r,children:[e.jsx(I,{fontSize:16}),"Remove Admin"]})},Le=({workspaceID:a})=>{const[n,{off:s},r]=P(),{data:t,isLoading:c,error:o}=X(a);return e.jsxs(Y,{open:n,onOpenChange:r,children:[e.jsx(G,{children:e.jsxs(C,{className:"not-cal",color:"gray",size:"2",variant:"soft",type:"button",children:[e.jsx(ve,{fontSize:16})," Manage Members"]})}),e.jsxs(V,{className:J(Ce,"w-full max-w-2xl"),children:[e.jsx(K,{children:"Manage Members"}),e.jsx(Z,{children:"Add or remove members from your workspace."}),c&&e.jsx(k,{}),e.jsx(y,{error:o}),t&&e.jsx(Ue,{workspaceID:a,onClose:s,members:t.message})]})]})},Ue=({workspaceID:a,onClose:n,members:s})=>{const[r,t]=d.useState(s.map(x=>({user:x.user,is_admin:x!=null&&x.is_admin?1:0,is_member:1}))),[c,o]=d.useState(!1),h=x=>{o(!0),t(x)},{mutate:l}=H(),[i,b]=d.useState([]),{call:p,loading:f,error:ee}=be("raven.api.workspaces.update_workspace_members"),se=()=>{p({workspace:a,members:r}).then(x=>{m.success("Members updated"),l(["workspace_members",a]),x.errors?b(x.errors):n()})};return e.jsxs(w,{className:"pt-4",children:[e.jsx(y,{error:ee}),i.length>0&&e.jsx(Ne,{children:i.map(x=>e.jsx(u,{children:x},x))}),e.jsx(Ae,{currentMembers:r,onChange:h}),e.jsxs(j,{justify:"between",pt:"4",className:"h-full",children:[e.jsx(He,{members:r}),e.jsxs(j,{children:[e.jsx(ye,{children:e.jsx(C,{size:"2",variant:"soft",type:"button",color:"gray",disabled:f,children:"Cancel"})}),e.jsxs(C,{size:"2",type:"button",onClick:se,disabled:!c||f,children:[f?e.jsx(k,{className:"text-white"}):null,f?B("Saving"):B("Save")]})]})]})]})},He=({members:a})=>{const{admins:n,memberIDs:s}=d.useMemo(()=>{const r=a.filter(c=>c.is_member).sort((c,o)=>c.user.localeCompare(o.user));return{admins:r.filter(c=>c.is_admin),memberIDs:r}},[a]);return e.jsxs(j,{align:"center",children:[e.jsxs(D,{children:[e.jsx($,{children:e.jsxs(u,{as:"span",size:"2",className:"text-gray-11 h-full flex items-center underline underline-offset-4 decoration-gray-8",children:[s.length," members"]})}),e.jsxs(E,{className:"w-72",children:[e.jsx(u,{size:"2",weight:"medium",children:"Members"}),e.jsx(N,{className:"my-2",size:"4"}),e.jsx(O,{className:"max-h-64 w-full",children:e.jsx("ul",{children:s.map(r=>e.jsx("li",{children:e.jsx(u,{as:"span",size:"2",color:"gray",className:"h-full flex items-center",children:r.user})},r.user))})})]})]}),e.jsx(N,{orientation:"vertical"}),e.jsxs(D,{children:[e.jsx($,{children:e.jsxs(u,{as:"span",size:"2",className:"text-gray-11 h-full flex items-center underline underline-offset-4 decoration-gray-8",children:[n.length," admins"]})}),e.jsxs(E,{className:"w-72",children:[e.jsx(u,{size:"2",weight:"medium",children:"Admins"}),e.jsx(N,{className:"my-2",size:"4"}),e.jsx(O,{className:"max-h-64 w-full",children:e.jsx("ul",{children:n.map(r=>e.jsx("li",{children:e.jsx(u,{as:"span",size:"2",color:"gray",className:"h-full flex items-center",children:r.user})},r.user))})})]})]})]})},qe=({workspaceID:a})=>{const[n,{off:s},r]=P();return e.jsxs(Y,{open:n,onOpenChange:r,children:[e.jsx(G,{children:e.jsxs(C,{size:"2",variant:"soft",type:"button",className:"not-cal",children:[e.jsx(Se,{fontSize:16}),"Add Members"]})}),e.jsxs(V,{className:J("w-full static"),children:[e.jsx(K,{children:"Add Members"}),e.jsx(Z,{children:"Add members to your workspace."}),e.jsx(d.Suspense,{fallback:e.jsx(k,{}),children:e.jsx(Be,{workspaceID:a,onClose:s})})]})]})};export{Je as W,X as u};
