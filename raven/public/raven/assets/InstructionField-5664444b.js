var k=Object.defineProperty,F=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var p=Object.getOwnPropertySymbols;var w=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var g=(s,n,a)=>n in s?k(s,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[n]=a,j=(s,n)=>{for(var a in n||(n={}))w.call(n,a)&&g(s,a,n[a]);if(p)for(var a of p(n))T.call(n,a)&&g(s,a,n[a]);return s},_=(s,n)=>F(s,R(n));var C=(s,n)=>{var a={};for(var t in s)w.call(s,t)&&n.indexOf(t)<0&&(a[t]=s[t]);if(s!=null&&p)for(var t of p(s))n.indexOf(t)<0&&T.call(s,t)&&(a[t]=s[t]);return a};import{aN as m,j as e,S as x,a as I,i as u,aT as P,aW as Y,aM as J,r as f,bW as W,bX as S,J as q,aw as B,ax as H,az as z,aA as D,ay as A,aB as N,a3 as L,bG as O,W as G,p as h,at as b,L as E,bd as M,d as X,bs as K,am as Q,an as Z,o as y,ap as U,E as ee,aE as se,aF as ae,aC as ne,bx as te,$ as ie}from"./index-81db420b.js";const me=({allowUsingTemplate:s,instructionRequired:n,autoFocus:a})=>{const{watch:t,control:i}=m(),r=t("dynamic_instructions");return e.jsxs(x,{gap:"4",children:[e.jsxs(I,{direction:"column",gap:"2",children:[e.jsx(u,{as:"label",size:"2",children:e.jsxs(I,{gap:"2",children:[e.jsx(P,{control:i,name:"dynamic_instructions",render:({field:o})=>e.jsx(Y,{checked:!!o.value,onCheckedChange:c=>o.onChange(c?1:0)})}),"Dynamic Instructions"]})}),e.jsxs(J,{size:"2",children:["Dynamic Instructions allow you to embed Jinja tags in your instruction to the bot.",e.jsx("br",{}),e.jsx("br",{}),"Instructions would be different based on the user who is calling the bot or the data in your system as they are computed every time the bot is called."]})]}),r?e.jsx(oe,{autoFocus:a,instructionRequired:n,allowUsingTemplate:s}):e.jsx(V,{autoFocus:a,instructionRequired:n,allowUsingTemplate:s})]})},re=[{variable:"first_name",description:"The first name of the user"},{variable:"full_name",description:"The full name of the user"},{variable:"email",description:"The email of the user"},{variable:"user_id",description:"The ID of the user"},{variable:"company",description:"The default company in the system"},{variable:"employee_id",description:"The ID of the employee"},{variable:"employee_company",description:"The company of the employee (value in Employee DocType)"},{variable:"department",description:"The department of the employee"}],oe=({allowUsingTemplate:s,instructionRequired:n,autoFocus:a})=>{const[t,i]=f.useState("editor");return e.jsxs(x,{gap:"4",children:[e.jsxs(W,{defaultValue:"editor",value:t,onValueChange:i,children:[e.jsx(S,{value:"editor",children:"Editor"}),e.jsx(S,{value:"preview",children:"Preview"})]}),t==="editor"?e.jsx(V,{className:"w-full",allowUsingTemplate:s,autoFocus:a,instructionRequired:n}):e.jsx(de,{}),e.jsx(q,{className:"w-full"}),e.jsxs(u,{size:"2",children:["Here are some variables you can use in your instruction. Simply copy by clicking on the variable.",e.jsx("br",{}),"You can also use standard Jinja variables available in the system."]}),e.jsxs(B,{variant:"surface",children:[e.jsx(H,{children:e.jsxs(z,{children:[e.jsx(D,{children:"Variable"}),e.jsx(D,{children:"Description"})]})}),e.jsx(A,{children:re.map(r=>e.jsx(ce,{variable:r.variable,description:r.description},r.variable))})]})]})},ce=({variable:s,description:n,withoutJinja:a=!1})=>e.jsxs(z,{children:[e.jsx(N,{children:e.jsx(le,{text:s,withoutJinja:a})}),e.jsx(N,{children:n})]}),le=({text:s,withoutJinja:n=!1})=>{const[a,t]=f.useState(""),i=r=>{r.preventDefault(),window.navigator.clipboard.writeText(n?s:"{{ "+s+" }}").then(()=>{t("Copied!"),setTimeout(()=>{t("")},1e3)}).catch(()=>{ie.error("Failed to copy to clipboard")})};return e.jsx(L,{content:a,open:a!=="",onOpenChange:r=>{r&&(t("Copy to clipboard"),setTimeout(()=>{t("")},1e3))},children:e.jsx(O,{role:"button",onClick:i,"aria-label":"Copy to clipboard",className:"cursor-pointer",children:s})})},de=()=>{const{watch:s}=m(),n=s("instruction"),{data:a}=G("raven.api.ai_features.get_instruction_preview",{instruction:n});return e.jsx(h,{className:"border-2 px-2 py-1 rounded-md bg-gray-3",children:a?e.jsx(u,{size:"2",className:"whitespace-pre-wrap",children:a.message}):null})},V=t=>{var i=t,{allowUsingTemplate:s,instructionRequired:n}=i,a=C(i,["allowUsingTemplate","instructionRequired"]);var v;const{register:r,watch:o,formState:{errors:c}}=m(),d=o("dynamic_instructions"),l=d?"You are an assistant running on an ERP. The current user's name is {{ first_name }} and the current company is {{ company }}.":"You are an assistant running on an ERP. You can answer questions about the company.";return e.jsxs(x,{children:[e.jsxs(h,{children:[e.jsxs(b,{justify:"between",children:[e.jsx(E,{htmlFor:"instruction",isRequired:!0,children:"Instruction"}),s&&e.jsx(ue,{})]}),e.jsx(M,j(_(j({id:"instruction"},r("instruction",{required:n?"Instruction is required":!1,validate:$=>!d&&$.includes("{{")?"You cannot include Jinja tags without enabling dynamic instructions.":!0})),{rows:10,resize:"vertical",placeholder:l,"aria-invalid":c.instruction?"true":"false"}),a))]}),c.instruction&&e.jsx(X,{size:"2",children:(v=c.instruction)==null?void 0:v.message})]})},ue=()=>{const{setValue:s,getValues:n,watch:a}=m(),t=a("dynamic_instructions"),{data:i,error:r}=K("Raven Bot Instruction Template",{fields:["template_name","dynamic_instructions","instruction"],filters:t?void 0:[["dynamic_instructions","=",0]]}),[o,c]=f.useState(""),d=l=>{l==="replace"?s("instruction",o):s("instruction",n("instruction")+o)};return e.jsxs(Q,{onOpenChange:()=>c(""),children:[e.jsx(Z,{children:e.jsx(y,{variant:"ghost",size:"1",className:"not-cal font-medium",children:"Import from Template"})}),e.jsx(U,{width:"300px",className:"z-50",children:e.jsxs(x,{gap:"6",children:[e.jsx(ee,{error:r}),e.jsxs(h,{children:[e.jsx(E,{htmlFor:"template",children:"Select a template"}),i&&i.length===0&&e.jsx(u,{size:"2",color:"gray",children:"No templates found"}),e.jsx(se,{columns:"1",name:"template",value:o,onValueChange:c,className:"max-h-96 overflow-y-auto",gap:"2",children:i==null?void 0:i.map(l=>e.jsx(ae,{value:l.instruction,className:"px-3 py-3",children:e.jsxs(b,{width:"100%",children:[e.jsx(u,{children:l.template_name}),l.dynamic_instructions?e.jsx(h,{children:e.jsxs(ne,{color:"purple",children:[e.jsx(te,{})," Dynamic"]})}):null]})},l.name))})]}),e.jsxs(b,{justify:"end",children:[e.jsx(y,{type:"button",color:"gray",variant:"soft",onClick:()=>d("replace"),disabled:!o,children:"Replace"}),e.jsx(y,{type:"button",variant:"soft",disabled:!o,onClick:()=>d("append"),children:"Add"})]})]})})]})};export{me as I,ce as V};
