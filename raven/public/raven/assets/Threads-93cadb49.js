import{j as e,cT as R,a0 as W,cU as Z,r as d,bg as _,N as q,K as N,a as x,b7 as D,i as j,b$ as J,p as F,aC as Q,cV as X,n as K,cW as ee,E as se,cX as ae,cY as re,b as ne,m as te,a_ as ce,cZ as ie,aI as le,aJ as oe,aK as de,aL as O,a3 as he,q as ue,c_ as xe,$ as U,c$ as me,g as pe,Q as je,x as ge,bi as fe,bj as ve,bk as v,bn as b,R as be}from"./index-81db420b.js";import{P as ye}from"./PageHeader-4d13375f.js";import{u as Ne,M as _e,U as we,a as ke}from"./useCurrentChannelData-5d20df6c.js";import{u as Se}from"./useGetUserRecords-beb6efeb.js";import{u as w}from"./useDebounce-02f398f3.js";import"./index-a9edd0f4.js";import"./useRavenSettings-a6b6461e.js";import"./preferences-0e1c8796.js";import"./DoctypeLinkRenderer-5c845fcf.js";import"./useDoctypeMeta-749cfb81.js";const Ce=({participants:s})=>{if(s.length===0)return null;const a=Object.keys(s).length,i=Math.min(a-3,9);return e.jsxs("div",{className:"flex items-center -space-x-1 rtl:space-x-reverse animate-fadein",children:[s.map((r,l)=>{var t,h;const n=R(r.user_id);if(l<3)return e.jsx(W,{src:(t=n==null?void 0:n.user_image)!=null?t:void 0,alt:(h=n==null?void 0:n.full_name)!=null?h:r.user_id,radius:"full",variant:"solid",className:"border border-gray-2"},r.user_id)}),a>3&&e.jsx("span",{className:"inline-block",children:e.jsx(Z,{fallback:`${i}+`,size:"1",variant:"soft",color:"gray",radius:"full",className:"border border-slate-4 text-[10px]"})})]})},Ie=({thread:s,unreadCount:a})=>{const i=R(s.owner),r=Se(),{channel:l}=Ne(s.channel_id),n=l==null?void 0:l.channelData,t=d.useMemo(()=>{var p,o;if(n)return n.is_direct_message?{channelIcon:"",channelName:`DM with ${(o=(p=r[n.peer_user_id])==null?void 0:p.full_name)!=null?o:n.peer_user_id}`}:{channelIcon:n.type,channelName:n.channel_name}},[n,r]),{workspaceID:h}=_();return e.jsx(q,{to:`/${h}/threads/${s.name}`,tabIndex:0,className:({isActive:p})=>N("group block hover:bg-gray-2 dark:hover:bg-gray-4 px-4 py-4 border-b border-gray-4 overflow-hidden","focus:outline-none focus-visible:ring-2 focus-visible:ring-accent-8 focus-visible:ring-inset",p&&"bg-gray-3 dark:bg-gray-3"),children:({isActive:p})=>{var o,m;return e.jsxs("div",{className:"flex w-full justify-between items-center gap-2",children:[e.jsxs(x,{direction:"column",gap:"2",children:[e.jsxs(x,{gap:"2",align:"center",children:[e.jsxs(x,{gap:"1",align:"center",justify:"center",children:[(t==null?void 0:t.channelIcon)&&e.jsx(D,{type:t==null?void 0:t.channelIcon,size:"14"}),e.jsx(j,{as:"span",size:"1",className:"font-semibold",children:t==null?void 0:t.channelName})]}),e.jsx(j,{as:"span",size:"1",color:"gray",children:e.jsx(J,{date:s.creation})})]}),e.jsxs(x,{gap:"3",children:[e.jsx(_e,{userID:s.owner,user:i,isActive:!1}),e.jsxs(x,{direction:"column",gap:"0.5",justify:"center",children:[e.jsx(F,{children:e.jsx(we,{user:i,userID:s.owner,isActive:!1})}),e.jsx(ke,{message:s,user:i,forceHideLinkPreview:!0})]})]}),e.jsxs(x,{align:"center",gap:"2",className:"pl-11",children:[e.jsx(Ce,{participants:(o=s.participants)!=null?o:[]}),e.jsxs(j,{as:"div",size:"1",className:"font-medium text-accent-a11",children:[(m=s.reply_count)!=null?m:0," ",s.reply_count&&s.reply_count===1?"Reply":"Replies"]})]})]}),a>0&&e.jsx(Q,{variant:"soft",className:"font-bold",size:"2",children:a})]})}})},y=5,k=({aiThreads:s,content:a,channel:i,endpoint:r="raven.api.threads.get_all_threads",onlyShowUnread:l})=>{var L,P,M,$,E;const{workspaceID:n}=_(),{data:t}=X(),h=d.useMemo(()=>t==null?void 0:t.message.reduce((c,u)=>(c[u.name]=u.unread_count,c),{}),[t]),{call:p}=d.useContext(K),{data:o,size:m,isLoading:G,setSize:C,error:I}=ee((c,u)=>{if(u&&!u.message.length)return null;const Y=c*y;return[r,{is_ai_thread:s,workspace:n,content:a,channel_id:i,startAfter:Y,onlyShowUnread:l}]},c=>p.get(r,{is_ai_thread:c[1].is_ai_thread,workspace:c[1].workspace,content:c[1].content,channel_id:c[1].channel_id,start_after:c[1].startAfter,limit:y,only_show_unread:c[1].onlyShowUnread}),{revalidateOnFocus:!1,revalidateIfStale:!0}),z=((P=(L=o==null?void 0:o[0])==null?void 0:L.message)==null?void 0:P.length)===0,g=G||m>0&&o&&typeof o[m-1]=="undefined",T=z||o&&(($=(M=o[o.length-1])==null?void 0:M.message)==null?void 0:$.length)<y,H=(E=o==null?void 0:o.flatMap(c=>c.message))!=null?E:[],f=d.useRef(null),A=d.useCallback(()=>{!T&&!g&&C(m+1)},[T,g,C,m]);return d.useEffect(()=>{const c=new IntersectionObserver(u=>{u[0].isIntersecting&&A()},{threshold:.1});return f.current&&c.observe(f.current),()=>c.disconnect()},[A]),I?e.jsx(se,{error:I}):z?e.jsx(ze,{isFiltered:l}):e.jsxs("ul",{className:"list-none",role:"list",children:[H.map(c=>{var u;return e.jsx("li",{role:"listitem",children:e.jsx(Ie,{thread:c,unreadCount:(u=h==null?void 0:h[c.name])!=null?u:0})},c.name)}),e.jsx("div",{ref:f,className:"h-4"}),g&&e.jsx(ae,{text:"Loading more threads..."})]})},ze=({isFiltered:s=!1})=>{const a=d.useMemo(()=>s?{title:"You're all caught up",description:"There are no unread threads to show. Clear the filter to see all threads."}:{title:"No threads yet",description:"Threads help keep conversations organized. Reply to any message to start a new thread or use the thread icon on messages to join existing discussions."},[s]);return e.jsxs(x,{direction:"column",align:"center",justify:"center",className:"h-[400px] px-6 text-center",children:[e.jsx("div",{className:"text-gray-8 mb-4",children:e.jsx(re,{size:48})}),e.jsx(j,{size:"5",weight:"medium",className:"mb-2",children:a.title}),e.jsx(j,{as:"p",size:"2",color:"gray",className:"max-w-[400px]",children:a.description})]})},S=({search:s,setSearch:a})=>e.jsx("div",{children:e.jsx(ne,{placeholder:"Search threads...",value:s,onChange:i=>a(i.target.value),className:"sm:min-w-64",children:e.jsx(te,{children:e.jsx(ce,{size:16})})})}),V=({channel:s,setChannel:a})=>{const{channels:i}=ie();return e.jsx("div",{children:e.jsxs(le,{value:s,onValueChange:a,children:[e.jsx(oe,{placeholder:"Channel / DM",className:"sm:min-w-48"}),e.jsxs(de,{className:"z-50",children:[e.jsx(O,{value:"all",children:"Any Channel"}),i.map(r=>e.jsx(O,{value:r.name,children:e.jsxs("div",{className:"gap-1 items-center flex overflow-hidden",children:[e.jsx(D,{type:r.type}),e.jsx(j,{style:{maxWidth:"20ch"},className:"text-ellipsis whitespace-break-spaces line-clamp-1 pb-0.5",children:r.channel_name})]})},r.name))]})]})})},B=({onlyShowUnread:s,setOnlyShowUnread:a})=>{const i=()=>{const l=s;a(!s),l?U.info("Viewing all threads",{position:"bottom-center",duration:800}):U.info("Viewing only unread threads",{position:"bottom-center",duration:800})},r=s?"Showing only unread threads":"Showing all threads";return e.jsx(he,{content:"Filter unread threads",children:e.jsx(ue,{variant:s?"solid":"soft","aria-label":r,title:r,onClick:i,children:e.jsx(xe,{size:16})})})},Te=s=>{const[a,i]=d.useState(""),r=w(a,250),[l,n]=d.useState("all"),[t,h]=me(!0,"raven-participating-threads-only-show-unread");return e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2 justify-between p-2 border-b border-gray-4",children:[e.jsx(S,{search:a,setSearch:i}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(V,{channel:l,setChannel:n}),e.jsx(B,{onlyShowUnread:t,setOnlyShowUnread:h})]})]}),e.jsx("div",{className:"h-[calc(100vh-10rem)] overflow-y-auto",children:e.jsx(k,{content:r,channel:l,onlyShowUnread:t})})]})},Ae=s=>{const[a,i]=d.useState(""),r=w(a,250),[l,n]=d.useState(!1);return e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2 justify-between p-2 border-b border-gray-4",children:[e.jsx(S,{search:a,setSearch:i}),e.jsx("div",{className:"flex gap-2",children:e.jsx(B,{onlyShowUnread:l,setOnlyShowUnread:n})})]}),e.jsx("div",{className:"h-[calc(100vh-10rem)] overflow-y-auto",children:e.jsx(k,{content:r,aiThreads:1,onlyShowUnread:l})})]})},Le=s=>{const[a,i]=d.useState(""),r=w(a,250),[l,n]=d.useState("all");return e.jsxs("div",{children:[e.jsxs("div",{className:"flex gap-2 justify-between p-2 border-b border-gray-4",children:[e.jsx(S,{search:a,setSearch:i}),e.jsx("div",{className:"flex gap-2",children:e.jsx(V,{channel:l,setChannel:n})})]}),e.jsx("div",{className:"h-[calc(100vh-10rem)] overflow-y-auto",children:e.jsx(k,{content:r,endpoint:"raven.api.threads.get_other_threads",channel:l})})]})},Pe=()=>{const{workspaceID:s,threadID:a}=_();return e.jsxs(x,{direction:"column",gap:"0",children:[e.jsx(ye,{children:e.jsxs(x,{align:"center",gap:"3",className:"h-8",children:[e.jsx(pe,{to:`/${s}`,className:"block bg-transparent hover:bg-transparent active:bg-transparent sm:hidden",children:e.jsx(je,{size:"24",className:"block text-gray-12"})}),e.jsx(ge,{size:"5",children:"Threads"})]})}),e.jsxs("div",{className:"flex gap-0",children:[e.jsx(F,{className:N("w-full sm:w-[50%] pt-12 border-r border-gray-4",a?"hidden sm:block":"block"),children:e.jsxs(fe,{defaultValue:"Participating",children:[e.jsxs(ve,{className:"px-4",children:[e.jsx(v,{value:"Participating",children:"Participating"}),e.jsx(v,{value:"Other",children:"Other"}),e.jsx(v,{value:"AI Threads",children:"AI Agents"})]}),e.jsx(b,{value:"Participating",children:e.jsx(Te,{})}),e.jsx(b,{value:"Other",className:"h-[calc(100vh-6rem)] overflow-y-auto",children:e.jsx(Le,{})}),e.jsx(b,{value:"AI Threads",className:"h-[calc(100vh-6rem)] overflow-y-auto",children:e.jsx(Ae,{})})]})}),e.jsx("div",{className:N("h-screen w-full sm:w-[50%]",a?"block":"hidden"),children:e.jsx(be,{})})]})]})},Ge=Pe;export{Ge as Component};
