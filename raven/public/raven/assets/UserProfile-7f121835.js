var X=Object.defineProperty,P=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,q=Object.prototype.propertyIsEnumerable;var y=(s,t,a)=>t in s?X(s,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[t]=a,v=(s,t)=>{for(var a in t||(t={}))T.call(t,a)&&y(s,a,t[a]);if(_)for(var a of _(t))q.call(t,a)&&y(s,a,t[a]);return s},S=(s,t)=>P(s,ee(t));var V=(s,t)=>{var a={};for(var r in s)T.call(s,r)&&t.indexOf(r)<0&&(a[r]=s[r]);if(s!=null&&_)for(var r of _(s))t.indexOf(r)<0&&q.call(s,r)&&(a[r]=s[r]);return a};import{c as J,T as f,j as e,V as se,_ as l,a as c,E as Y,i as D,Y as ae,o as O,Z as te,e as Z,$ as g,r as N,p as K,a0 as ne,a1 as le,a2 as re,a3 as Q,a4 as ie,q as A,a5 as ce,a6 as oe,a7 as W,a8 as ue,a9 as de,aa as me,ab as ge,ac as he,u as je,ad as xe,M as pe,ae as be,af as _e,L as $,S as ve,b as B,d as G,J as H,ag as Se,ah as Ne,ai as d,aj as fe,ak as m,al as we,m as Ie,am as Ce,an as ke,ao as Ue,ap as $e}from"./index-81db420b.js";import{U as De}from"./UploadImageModal-375ec61c.js";import Oe from"./EmojiPicker-289a24eb.js";import{P as Ae,S as Fe,a as Re}from"./SettingsContentContainer-c8f50a15.js";import"./AddCustomEmojiDialog-15ed8490.js";const Ee=({onClose:s})=>{const{call:t,loading:a,error:r}=J("raven.api.raven_users.update_raven_user"),{mutate:h}=f(),i=()=>{t({user_image:""}).then(()=>{g.success("Profile picture removed."),h(),s()})};return e.jsxs(e.Fragment,{children:[e.jsx(se,{children:l("Remove Image")}),e.jsxs(c,{direction:"column",gap:"2",children:[e.jsx(Y,{error:r}),e.jsx(D,{children:l("Are you sure you want to remove this image?")})]}),e.jsxs(c,{gap:"3",mt:"4",justify:"end",children:[e.jsx(ae,{children:e.jsx(O,{variant:"soft",color:"gray",children:l("Cancel")})}),e.jsx(te,{children:e.jsxs(O,{variant:"solid",color:"red",onClick:i,disabled:a,children:[a&&e.jsx(Z,{}),a?l("Removing"):l("Remove")]})})]})]})},ze=h=>{var i=h,{icon:s,accept:t={"image/*":[".jpeg",".jpg",".png"]},maxFileSize:a}=i,r=V(i,["icon","accept","maxFileSize"]);var j;const{call:w}=J("raven.api.raven_users.update_raven_user"),{myProfile:n,mutate:I}=f(),[u,o]=N.useState(!1),[C,k]=N.useState(!1),U=x=>{x&&w({user_image:x}).then(()=>{g(l("Image uploaded successfully.")),I(),o(!1)}).catch(p=>{g("There was an error while uploading the image.",{description:he(p)})})};return e.jsx(c,{direction:"column",gap:"3",children:e.jsxs(K,{className:"relative",children:[n!=null&&n.user_image?e.jsx("img",{src:n==null?void 0:n.user_image,alt:"User Image",className:"object-cover h-44 w-44 rounded-xl"}):e.jsx(ne,{alt:n==null?void 0:n.full_name,size:"9",fallback:le(n==null?void 0:n.full_name),className:"h-44 w-44"}),e.jsx(Le,{open:u,setOpen:o,uploadImage:U,userID:(j=n==null?void 0:n.name)!=null?j:""}),(n==null?void 0:n.user_image)&&e.jsx(Me,{open:C,setOpen:k})]})})},Le=({open:s,setOpen:t,uploadImage:a,userID:r})=>e.jsxs(re,{open:s,onOpenChange:t,children:[e.jsx(Q,{content:"Upload Image",side:"right",children:e.jsx(ie,{children:e.jsx(A,{type:"button","aria-label":"upload image",size:"1",className:"absolute -right-2 -bottom-1 rounded-md shadow-md",children:e.jsx(ce,{size:"12"})})})}),e.jsx(oe,{className:W,children:e.jsx(De,{uploadImage:a,doctype:"Raven User",docname:r,fieldname:"user_image"})})]}),Me=({open:s,setOpen:t})=>{const a=()=>{t(!1)};return e.jsxs(ue,{open:s,onOpenChange:t,children:[e.jsx(Q,{content:"Remove Image",side:"right",children:e.jsx(de,{children:e.jsx(A,{type:"button","aria-label":"remove image",size:"1",className:"absolute -right-2 bottom-6 rounded-md bg-white dark:bg-slate-4 shadow-md",children:e.jsx(me,{size:"12",color:"tomato"})})})}),e.jsx(ge,{className:W,children:e.jsx(Ee,{onClose:a})})]})},ye=()=>{const{myProfile:s,mutate:t}=f();return s?e.jsx(Te,{myProfile:s}):null},Te=({myProfile:s})=>{var p,F,R,E,z,L;const{mutate:t}=f(),a=je({defaultValues:{full_name:(p=s==null?void 0:s.full_name)!=null?p:"",user_image:(F=s==null?void 0:s.user_image)!=null?F:"",availability_status:(R=s==null?void 0:s.availability_status)!=null?R:"",custom_status:(E=s==null?void 0:s.custom_status)!=null?E:""}}),{register:r,handleSubmit:h,formState:{errors:i}}=a,{updateDoc:w,loading:n,error:I}=xe(),[u,o]=N.useState((z=s==null?void 0:s.availability_status)!=null?z:""),C=b=>{var M;w("Raven User",(M=s==null?void 0:s.name)!=null?M:null,{full_name:b.full_name,availability_status:u,custom_status:b.custom_status}).then(()=>{g.success(l("Profile updated")),t()}).catch(()=>{g.error(l("Profile update failed"))})},[k,U]=N.useState(!1),j=b=>{a.setValue("custom_status",`${a.getValues("custom_status")} ${b}`)},x=pe();return e.jsx(Ae,{children:e.jsx(be,S(v({},a),{children:e.jsx("form",{onSubmit:h(C),children:e.jsxs(Fe,{children:[e.jsx(Re,{title:l("Profile"),description:l("Manage your Raven profile"),actions:e.jsxs(O,{type:"submit",disabled:n,children:[n&&e.jsx(Z,{}),n?l("Saving"):l("Save")]})}),e.jsx(_e,{className:"p-0 align-middle justify-center",children:e.jsxs(c,{direction:"column",gap:"0",children:[e.jsx(K,{className:"flex justify-center items-center bg-slate-2 dark:bg-slate-3 py-6",children:e.jsx(ze,{})}),e.jsx(Y,{error:I}),e.jsxs(c,{gap:"4",direction:"column",className:"py-4 px-6 dark:bg-slate-2",children:[e.jsxs(c,{justify:"between",align:"center",children:[e.jsx($,{htmlFor:"full_name",isRequired:!0,children:l("Full Name")}),e.jsxs(ve,{gap:"1",children:[e.jsx(B,S(v({autoFocus:!0,maxLength:140,className:"w-48 sm:w-96",id:"full_name",placeholder:"Full Name"},r("full_name",{maxLength:{value:140,message:l("Name cannot be more than {0} characters.",[140])},required:l("Name is required")})),{"aria-invalid":i.full_name?"true":"false"})),(i==null?void 0:i.full_name)&&e.jsx(G,{children:(L=i.full_name)==null?void 0:L.message})]})]}),e.jsx(H,{className:"w-full bg-slate-4"}),e.jsxs(c,{justify:"between",align:"center",children:[e.jsx($,{htmlFor:"availability_status",children:l("Availability Status")}),e.jsxs(Se,{children:[e.jsx(Ne,{children:e.jsx(c,{gap:"2",align:"center",className:"text-sm px-2 py-1 border border-gray-7 rounded w-48 sm:w-96",children:u?d(u):e.jsx(D,{color:"gray",children:l("Set Availability")})})}),e.jsxs(fe,{variant:"soft",children:[e.jsx(m,{className:"flex justify-normal gap-2",color:"gray",onClick:()=>o("Available"),children:d("Available")}),e.jsx(m,{className:"flex justify-normal gap-2",color:"gray",onClick:()=>o("Away"),children:d("Away")}),e.jsx(m,{className:"flex justify-normal gap-2",color:"gray",onClick:()=>o("Do not disturb"),children:d("Do not disturb")}),e.jsx(m,{className:"flex justify-normal gap-2",color:"gray",onClick:()=>o("Invisible"),children:d("Invisible")}),e.jsxs(m,{className:"flex justify-normal gap-2",color:"gray",onClick:()=>o(""),children:[e.jsx(we,{fontSize:"0.7rem"})," ",l("Reset")]})]})]})]}),e.jsx(H,{className:"w-full bg-slate-4"}),e.jsxs(c,{justify:"between",align:"center",children:[e.jsxs(c,{direction:"column",gap:"0",children:[e.jsx($,{htmlFor:"custom_status",children:l("Custom Status")}),x&&e.jsx(D,{size:"1",color:"gray",style:{lineHeight:"0.8"},children:l("Share what you are up to")})]}),e.jsx(c,{align:"center",gap:"3",children:e.jsxs(c,{direction:"column",gap:"1",children:[e.jsx(B,S(v({id:"custom_status",placeholder:"e.g. Out of Office",maxLength:140},r("custom_status",{maxLength:{value:140,message:l("Status cannot be more than {} characters.",["140"])}})),{className:"w-48 sm:w-96","aria-invalid":i.custom_status?"true":"false",children:e.jsx(Ie,{side:"right",children:e.jsxs(Ce,{children:[e.jsx(ke,{children:e.jsx(A,{type:"button",className:"rounded-full",onClick:()=>U(!k),variant:"ghost",color:"gray",children:e.jsx(Ue,{size:"18"})})}),e.jsx($e,{className:"p-0",children:e.jsx(Oe,{onSelect:j})})]})})})),i.custom_status&&e.jsx(G,{children:i.custom_status.message})]})})]})]})]})})]})})}))})},Ye=ye;export{Ye as Component};
