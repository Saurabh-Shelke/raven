var S=Object.defineProperty,T=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var h=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var C=(s,n,i)=>n in s?S(s,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[n]=i,m=(s,n)=>{for(var i in n||(n={}))b.call(n,i)&&C(s,i,n[i]);if(h)for(var i of h(n))$.call(n,i)&&C(s,i,n[i]);return s},f=(s,n)=>T(s,W(n));var R=(s,n)=>{var i={};for(var r in s)b.call(s,r)&&n.indexOf(r)<0&&(i[r]=s[r]);if(s!=null&&h)for(var r of h(s))n.indexOf(r)<0&&$.call(s,r)&&(i[r]=s[r]);return i};import{r as g,j as e,c8 as A,W as N,p as O,c9 as I,af as D,E as q,aX as z,a as p,aC as G,i as j,x as H,a3 as U,q as E,ca as X,cb as J,cc as K,cd as Q,ce as V,cf as Y,ag as Z,ah as ee,cg as se,aj as re,ak as d,ch as ie,ci as L,cj as M,ck as ne,cl as B,n as oe,at as te,cm as ae,cn as le,$ as u,ac as ce}from"./index-81db420b.js";import{u as P}from"./useDoctypeMeta-749cfb81.js";var pe="AspectRatio",F=g.forwardRef((s,n)=>{const o=s,{ratio:i=1/1,style:r}=o,a=R(o,["ratio","style"]);return e.jsx("div",{style:{position:"relative",width:"100%",paddingBottom:`${100/i}%`},"data-radix-aspect-ratio-wrapper":"",children:e.jsx(A.div,f(m({},a),{ref:n,style:f(m({},r),{position:"absolute",top:0,right:0,bottom:0,left:0})}))})});F.displayName=pe;var de=F;const xe=de,he=(s,n)=>{const{data:i,error:r,isLoading:a,mutate:o}=N("raven.api.document_link.get_preview_data",{doctype:s,docname:n},void 0,{shouldRetryOnError:!1});return{data:i==null?void 0:i.message,error:r,isLoading:a,mutate:o}},_e=({doctype:s,docname:n})=>{const{data:i,error:r,isLoading:a,mutate:o}=he(s,n),l=g.useMemo(()=>{if(i&&i.raven_document_link)return i.raven_document_link;const c=s.toLowerCase().split(" ").join("-");return`${window.location.origin}/app/${c}/${n}`},[i,s,n]);return e.jsx(O,{className:"max-w-[550px] min-w-[75px] py-2",children:a?e.jsx(I,{className:"w-96 h-32 rounded-md"}):r?e.jsx(D,{children:e.jsx(q,{error:r})}):e.jsx(je,{data:i,doctype:s,docname:n,route:l,mutate:o})})},je=({data:s,doctype:n,route:i,docname:r,mutate:a})=>{var k,v;const o=t=>{const _=["preview_image","preview_title","id","raven_document_link"];return Object.keys(t).reduce((y,w)=>(_.includes(w)||(y[w]=t[w]),y),{})},l=()=>{u.promise(()=>x(i),{loading:"Copying link...",success:"Link copied!",error:"Failed to copy link"})},c=t=>{u.promise(()=>x(s[t]),{loading:`Copying ${t}...`,success:`${t} copied!`,error:`Failed to copy ${t}`,duration:1e3})},x=t=>navigator.clipboard.writeText(t);return e.jsx(D,{children:e.jsxs(z,{gap:"2",children:[e.jsxs(p,{justify:"between",align:"start",children:[e.jsxs(p,{gap:"2",align:"center",width:"100%",children:[(s==null?void 0:s.preview_image)&&e.jsx(O,{width:"12%",className:"pl-0.5",children:e.jsx(xe,{ratio:1/1,children:e.jsx("img",{src:s.preview_image,alt:s==null?void 0:s.preview_title,style:{objectFit:"cover",width:"100%",height:"100%",backgroundColor:"var(--gray-5)",borderRadius:"var(--radius-4)"}})})}),e.jsxs(z,{gap:"1",width:"100%",children:[e.jsxs(p,{gap:"1",children:[e.jsx(G,{variant:"surface",children:n}),e.jsx(j,{size:"2",color:"gray",className:"cursor-copy",onClick:()=>c("ID"),children:s==null?void 0:s.id})]}),e.jsx(H,{as:"h3",size:"3",className:"leading-4 pl-0.5 my-0",children:(k=s==null?void 0:s.preview_title)!=null?k:r})]})]}),e.jsxs(p,{gap:"3",align:"center",children:[e.jsx(U,{content:"Open in new tab",delayDuration:800,children:e.jsx(E,{size:"1",title:"Open in new tab","aria-label":"Open in new tab",color:"gray",asChild:!0,variant:"ghost",children:e.jsx("a",{href:i,target:"_blank",children:e.jsx(X,{size:"18"})})})}),e.jsx(ue,{doctype:n,docname:r,onCopyLinkClick:l,mutate:a})]})]}),e.jsx(J,{size:"2",className:"gap-1 pl-0.5",children:s&&((v=Object.keys(o(s)))==null?void 0:v.map((t,_)=>e.jsxs(K,{align:"center",children:[e.jsx(Q,{minWidth:"88px",className:"font-medium pr-2",children:t}),e.jsx(V,{children:typeof s[t]=="string"?Y(s[t]):s[t]})]},t)))})]})})},ue=({doctype:s,docname:n,onCopyLinkClick:i,mutate:r})=>e.jsxs(Z,{children:[e.jsx(ee,{children:e.jsx(E,{size:"1",title:"More actions","aria-label":"More actions",color:"gray",variant:"ghost",children:e.jsx(se,{size:"20"})})}),e.jsxs(re,{children:[e.jsx(d,{onSelect:i,children:e.jsxs(p,{gap:"2",align:"center",pr:"4",children:[e.jsx(ie,{size:"16"}),"Copy Link"]})}),e.jsx(me,{doctype:s,docname:n}),e.jsx(ge,{doctype:s,docname:n,mutate:r})]})]}),ge=({doctype:s,docname:n,mutate:i})=>{var l;const{doc:r}=P(s),[a,o]=g.useState(!1);return!r||!(r!=null&&r.__workflow_docs)||(r==null?void 0:r.__workflow_docs.length)===0?null:e.jsxs(L,{open:a,onOpenChange:o,children:[e.jsx(M,{children:e.jsxs(p,{gap:"2",align:"center",children:[e.jsx(ne,{size:"16"}),"Workflow"]})}),e.jsx(B,{children:e.jsx(we,{doctype:s,docname:n,workflow:(l=r==null?void 0:r.__workflow_docs)==null?void 0:l[0],mutate:i})})]})},we=({doctype:s,docname:n,mutate:i})=>{const{data:r,mutate:a}=N("frappe.model.workflow.get_transitions",{doc:{doctype:s,name:n}},`workflow.get_transitions.${s}.${n}`,{revalidateIfStale:!1,revalidateOnFocus:!1,shouldRetryOnError:!1}),{call:o}=g.useContext(oe),l=c=>{o.post("frappe.model.workflow.apply_workflow",{doc:{doctype:s,name:n},action:c}).then(()=>{i(),a(),u.success("Workflow transition applied successfully")}).catch(x=>{u.error("Failed to apply workflow transition",{description:ce(x)})})};return(r==null?void 0:r.message.length)===0?e.jsx(d,{disabled:!0,children:"No transitions available"}):e.jsx(e.Fragment,{children:r==null?void 0:r.message.map(c=>e.jsxs(d,{onClick:()=>l(c.action),children:[e.jsx(j,{size:"2",weight:"medium",children:c.action}),e.jsxs(te,{gap:"1",children:[e.jsx(j,{size:"1",className:"font-light",children:c.state}),e.jsx(ae,{size:"16",opacity:.7}),e.jsx(j,{size:"1",className:"font-light",children:c.next_state})]})]},c.name))})},me=({doctype:s,docname:n})=>{var a;const{doc:i}=P(s),r=o=>{let l=`doctype=${encodeURIComponent(s)}&name=${encodeURIComponent(n)}`;o&&(l+=`&format=${o}`),l+="&trigger_print=0",window.open(`/printview?${l}`,"_blank")};return e.jsxs(L,{children:[e.jsx(M,{children:e.jsxs(p,{gap:"2",align:"center",children:[e.jsx(le,{size:"16"}),"Print"]})}),e.jsxs(B,{children:[(a=i==null?void 0:i.__print_formats)==null?void 0:a.map(o=>e.jsx(d,{onClick:()=>r(o.name),children:o.name},o.name)),e.jsx(d,{onClick:()=>r(),children:"Standard"})]})]})};export{_e as D};
