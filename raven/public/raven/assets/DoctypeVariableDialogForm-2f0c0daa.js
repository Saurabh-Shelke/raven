var W=Object.defineProperty,J=Object.defineProperties;var Q=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var R=(i,t,s)=>t in i?W(i,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[t]=s,f=(i,t)=>{for(var s in t||(t={}))K.call(t,s)&&R(i,s,t[s]);if(P)for(var s of P(t))G.call(t,s)&&R(i,s,t[s]);return i},y=(i,t)=>J(i,Q(t));import{u as U,j as e,ae as X,S as m,at as p,au as Z,o as T,aN as w,r as g,p as x,L as _,aT as k,aI as N,aJ as M,aK as I,aL as b,bb as ee,aC as se,d as D,i as S,aW as $,b as V,aM as F,bd as B,n as ne,W as ie,cv as z,cw as H,cx as te,am as re,an as le,ap as ae,m as oe,a_ as ce,b0 as de}from"./index-81db420b.js";import{u as C}from"./useDoctypeMeta-749cfb81.js";import{b as q}from"./validations-18aa1769.js";const we=({doctype:i,onAdd:t,defaultValues:s})=>{const r=U({defaultValues:y(f({},s),{child_table_name:s!=null&&s.child_table_name?s==null?void 0:s.child_table_name:i})}),{handleSubmit:a}=r,h=n=>{n.child_table_name===i?t(y(f({},n),{child_table_name:""})):t(n)};return e.jsx("form",{onSubmit:a(h),children:e.jsx(X,y(f({},r),{children:e.jsxs(m,{gap:"4",className:"max-h-[75vh] overflow-y-auto px-0.5",children:[e.jsxs(m,{gap:"4",children:[e.jsxs(p,{children:[e.jsx(he,{doctype:i}),e.jsx(xe,{doctype:i})]}),e.jsx(pe,{}),e.jsx(p,{children:e.jsx(je,{doctype:i})})]}),e.jsxs(p,{justify:"end",children:[e.jsx(Z,{children:e.jsx(T,{variant:"soft",color:"gray",children:"Close"})}),e.jsx(T,{type:"button",onClick:a(h),children:"Add"})]})]})}))})},he=({doctype:i})=>{const{control:t,setValue:s}=w(),{doc:r}=C(i),a=g.useMemo(()=>{var n;return r?(n=r.fields)==null?void 0:n.filter(c=>c.fieldtype==="Table"||c.fieldtype==="Table MultiSelect"):[]},[r]),h=()=>{s("fieldname",""),s("description",""),s("options",""),s("type","string"),s("required",0)};return e.jsxs(x,{width:"50%",children:[e.jsx(_,{isRequired:!0,htmlFor:"child_table_name",children:"DocType"}),e.jsx(k,{control:t,name:"child_table_name",rules:{onChange:h},render:({field:n})=>e.jsxs(N,{required:!0,value:n.value,onValueChange:n.onChange,disabled:(a==null?void 0:a.length)===0,children:[e.jsx(M,{className:"w-full"}),e.jsxs(I,{children:[e.jsx(b,{value:i,children:i}),a==null?void 0:a.map(c=>{var l,d;return e.jsxs(b,{value:(l=c.fieldname)!=null?l:"",children:[(d=c.options)!=null?d:""," (",c.fieldname,")"]},c.fieldname)})]})]})})]})},ue=["Autocomplete","Check","Code","Currency","Data","Date","Datetime","Float","HTML Editor","Markdown Editor","Int","JSON","Select","Text","Text Editor","Time","Phone","Percent","Long Text","Small Text","Rating","Link","Dynamic Link"],xe=({doctype:i})=>{const{control:t,watch:s,setValue:r}=w(),a=s("child_table_name"),{field:{value:h,onChange:n}}=ee({control:t,name:"fieldname",rules:{required:"Field is required"}}),{doc:c}=C(i),l=g.useMemo(()=>{var u,j;if(i===a)return i;let o=(j=(u=c==null?void 0:c.fields)==null?void 0:u.find(v=>v.fieldname===a))==null?void 0:j.options;return o||i},[c,i,a]),d=o=>{var L,Y,A,E,O;n((L=o.fieldname)!=null?L:"");let u=(A=(Y=o.label)!=null?Y:o.fieldname)!=null?A:"",j="",v="string";o.fieldtype==="Select"&&(j=(E=o.options)!=null?E:""),q(["Int","Rating"],o.fieldtype)&&(v="integer"),q(["Float","Currency","Percent"],o.fieldtype)&&(v="number"),o.fieldtype==="Percent"&&(u=`${o.label} in percentage (between 0 and 100)`),o.fieldtype==="Check"&&(v="boolean"),o.fieldtype==="Date"&&(u=`${o.label} in YYYY-MM-DD format`),o.fieldtype==="Datetime"&&(u=`${o.label} in YYYY-MM-DD HH:mm:ss format`),o.fieldtype==="Time"&&(u=`${o.label} in HH:mm:ss format`),r("description",u),r("options",j),r("type",v),r("required",(O=o.reqd)!=null?O:0)};return e.jsx(me,{doctype:l,value:h,onFieldSelect:d})},me=({doctype:i,value:t,onFieldSelect:s})=>{const{doc:r}=C(i),a=g.useMemo(()=>{var n;return r?(n=r.fields)==null?void 0:n.filter(c=>q(ue,c.fieldtype)):[]},[r]),h=n=>{s(a==null?void 0:a.find(c=>c.fieldname===n))};return e.jsxs(x,{width:"50%",children:[e.jsx(_,{isRequired:!0,htmlFor:"fieldname",children:"Field"}),e.jsxs(N,{value:t,onValueChange:h,required:!0,children:[e.jsx(M,{placeholder:"Select Field",className:"w-full",name:"fieldname"}),e.jsx(I,{children:a==null?void 0:a.map(n=>{var c;return e.jsxs(b,{value:(c=n.fieldname)!=null?c:"",children:[n.label," (",n.fieldname,") ",e.jsx(se,{size:"1",color:"gray",children:n.fieldtype})]},n.fieldname)})})]})]})},pe=()=>{var h,n,c;const{control:i,register:t,formState:{errors:s},watch:r}=w(),a=r("do_not_ask_ai");return e.jsxs(m,{gap:"4",children:[e.jsxs(p,{children:[e.jsx(x,{width:"50%",children:e.jsxs(m,{gap:"4",children:[e.jsxs(m,{children:[e.jsxs(x,{children:[e.jsx(_,{isRequired:!0,children:"Variable Type"}),e.jsx(k,{control:i,name:"type",rules:{required:"Type is required"},render:({field:l})=>e.jsxs(N,{required:!0,value:l.value,onValueChange:d=>l.onChange(d),children:[e.jsx(M,{placeholder:"Select a variable type",className:"w-full"}),e.jsxs(I,{children:[e.jsx(b,{value:"string",children:"String"}),e.jsx(b,{value:"integer",children:"Integer"}),e.jsx(b,{value:"number",children:"Number"}),e.jsx(b,{value:"boolean",children:"Boolean"})]})]})})]}),s.type&&e.jsx(D,{children:(h=s.type)==null?void 0:h.message})]}),e.jsx(x,{children:e.jsx(k,{control:i,name:"required",render:({field:l})=>e.jsx(S,{as:"label",size:"2",children:e.jsxs(p,{children:[e.jsx($,{checked:!!l.value,onCheckedChange:d=>l.onChange(d?1:0)}),"Required"]})})})}),e.jsx(x,{children:e.jsx(k,{control:i,name:"do_not_ask_ai",render:({field:l})=>e.jsx(S,{as:"label",size:"2",children:e.jsxs(p,{children:[e.jsx($,{checked:!!l.value,onCheckedChange:d=>l.onChange(d?1:0)}),"Do not ask AI to fill this field?"]})})})})]})}),e.jsx(x,{width:"50%",children:e.jsxs(m,{gap:"1",children:[e.jsxs(x,{children:[e.jsx(_,{htmlFor:"default_value",isRequired:!!a,children:"Default Value"}),e.jsx(V,f({},t("default_value",{required:a?"Default value is required if AI is not asked to fill this field":!1})))]}),s.default_value&&e.jsx(D,{children:(n=s.default_value)==null?void 0:n.message}),e.jsx(F,{children:"You can specify a default value for this variable. If the AI does not fill this field, then the default value will be used."})]})})]}),e.jsxs(m,{gap:"1",children:[e.jsxs(x,{children:[e.jsx(_,{htmlFor:"description",isRequired:!0,children:"Description"}),e.jsx(B,y(f({},t("description",{required:!0})),{placeholder:"Enter a description for this variable"}))]}),s.description&&e.jsx(D,{children:(c=s.description)==null?void 0:c.message}),e.jsx(F,{children:"This is used to describe what this variable is used for. A better description will help the AI Bot perform better."})]})]})},je=({doctype:i})=>{var l;const{register:t,watch:s,formState:{errors:r}}=w(),a=s("fieldname"),h=s("child_table_name"),{doc:n}=C(i),c=g.useMemo(()=>{var o,u;if(i===h)return i;let d=(u=(o=n==null?void 0:n.fields)==null?void 0:o.find(j=>j.fieldname===h))==null?void 0:u.options;return d||i},[n,i,h,a]);return e.jsxs(m,{gap:"1",width:"100%",children:[e.jsxs(x,{width:"100%",children:[e.jsx(_,{htmlFor:"options",children:"Options"}),e.jsx(B,y(f({},t("options")),{rows:5,placeholder:"Add options separated by a new line."}))]}),r.options&&e.jsx(D,{children:(l=r.options)==null?void 0:l.message}),e.jsxs(F,{children:["You can limit the values that the bot can fill in this field by adding options.",e.jsx("br",{}),"This helps the bot to make less mistakes."]}),e.jsx(x,{pt:"2",children:a&&e.jsx(fe,{doctype:c,fieldname:a})})]})},fe=({doctype:i,fieldname:t})=>{const{doc:s}=C(i),r=g.useMemo(()=>{var l,d,o;return s&&(o=(d=(l=s.fields)==null?void 0:l.find(u=>u.fieldtype==="Link"&&u.fieldname===t))==null?void 0:d.options)!=null?o:""},[s,t]),{setValue:a}=w(),{db:h}=g.useContext(ne),{data:n}=ie("frappe.desk.reportview.get_count",{doctype:r,limit:21},r?void 0:null),c=()=>{h.getDocList(r,{fields:["name"]}).then(l=>{a("options",l.map(d=>d.name).join(`
`))})};return!r||!n||(n==null?void 0:n.message)===0?null:(n==null?void 0:n.message)===21?e.jsx(z,{className:"block",size:"1",children:e.jsxs(p,{align:"center",width:"100%",justify:"between",children:[e.jsxs(H,{weight:"medium",children:["Quickly import ",r,"s?"]}),e.jsx(x,{children:e.jsx(be,{doctype:r})})]})}):e.jsx(z,{className:"block",size:"1",children:e.jsxs(p,{align:"center",width:"100%",justify:"between",children:[e.jsxs(H,{children:["There are only ",n==null?void 0:n.message," options in ",r,".",e.jsx("br",{}),"Do you want to autofill these as options?"]}),e.jsx(x,{children:e.jsx(T,{type:"button",variant:"surface",className:"not-cal",onClick:c,children:"Auto Fill Options"})})]})})},be=({doctype:i})=>{var c;const[t,s]=g.useState(""),{data:r}=te(i,t,void 0,15),{setValue:a,getValues:h}=w(),n=l=>{const d=h("options")||"";let o=[];if(d?o=d.split(`
`):o=[],!o.includes(l)){const u=[...o,l];a("options",u.join(`
`))}};return e.jsxs(re,{children:[e.jsx(le,{children:e.jsxs(T,{type:"button",variant:"surface",className:"not-cal",children:["Select ",i,"s"]})}),e.jsx(ae,{width:"360px",children:e.jsxs(m,{children:[e.jsx(V,{value:t,onChange:l=>s(l.target.value),children:e.jsx(oe,{side:"left",children:e.jsx(ce,{})})}),e.jsx(de,{style:{height:360},children:(c=r==null?void 0:r.message)==null?void 0:c.slice(0,15).map(l=>e.jsxs(m,{gap:"0",role:"button",className:"hover:bg-gray-2 px-2 py-1.5 rounded-md cursor-pointer",onClick:()=>n(l.value),children:[e.jsx(S,{size:"2",weight:"medium",children:l.value}),l.description&&e.jsx(S,{size:"1",weight:"light",children:l.description})]},l.value))})]})})]})};export{we as D,ue as V,me as a};
